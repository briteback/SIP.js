/*!
 * 
 *  SIP version 0.8.2
 *  Copyright (c) 2014-2017 Junction Networks, Inc <http://www.onsip.com>
 *  Homepage: http://sipjs.com
 *  License: http://sipjs.com/license/
 * 
 * 
 *  ~~~SIP.js contains substantial portions of JsSIP under the following license~~~
 *  Homepage: http://jssip.net
 *  Copyright (c) 2012-2013 José Luis Millán - Versatica <http://www.versatica.com>
 * 
 *  Permission is hereby granted, free of charge, to any person obtaining
 *  a copy of this software and associated documentation files (the
 *  "Software"), to deal in the Software without restriction, including
 *  without limitation the rights to use, copy, modify, merge, publish,
 *  distribute, sublicense, and/or sell copies of the Software, and to
 *  permit persons to whom the Software is furnished to do so, subject to
 *  the following conditions:
 * 
 *  The above copyright notice and this permission notice shall be
 *  included in all copies or substantial portions of the Software.
 * 
 *  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 *  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 *  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 *  NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
 *  LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 *  OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
 *  WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 * 
 *  ~~~ end JsSIP license ~~~
 * 
 * 
 * 
 * 
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.SIP=t():e.SIP=t()}(this,function(){return function(e){function t(s){if(i[s])return i[s].exports;var r=i[s]={i:s,l:!1,exports:{}};return e[s].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var i={};return t.m=e,t.c=i,t.d=function(e,i,s){t.o(e,i)||Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:s})},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=13)}([function(e,t){e.exports=require("util")},function(e,t){e.exports=require("events")},function(e,t,i){function s(e,t,i){if(this instanceof s==!1)throw new TypeError("Classes can't be function-called");this._options=e||{},this._isServer=!!t,this._inflate=null,this._deflate=null,this.params=null,this._maxPayload=i||0}var r=i(54),n=[8,9,10,11,12,13,14,15];s.extensionName="permessage-deflate",s.prototype.offer=function(){var e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:null==this._options.clientMaxWindowBits&&(e.client_max_window_bits=!0),e},s.prototype.accept=function(e){e=this.normalizeParams(e);var t;return t=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params=t,t},s.prototype.cleanup=function(){this._inflate&&(this._inflate.writeInProgress?this._inflate.pendingClose=!0:(this._inflate.close&&this._inflate.close(),this._inflate=null)),this._deflate&&(this._deflate.writeInProgress?this._deflate.pendingClose=!0:(this._deflate.close&&this._deflate.close(),this._deflate=null))},s.prototype.acceptAsServer=function(e){var t={};if(!e.some(function(e){if(t={},(!1!==this._options.serverNoContextTakeover||!e.server_no_context_takeover)&&(!1!==this._options.serverMaxWindowBits||!e.server_max_window_bits)&&!("number"==typeof this._options.serverMaxWindowBits&&"number"==typeof e.server_max_window_bits&&this._options.serverMaxWindowBits>e.server_max_window_bits)&&("number"!=typeof this._options.clientMaxWindowBits||e.client_max_window_bits))return(this._options.serverNoContextTakeover||e.server_no_context_takeover)&&(t.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(t.client_no_context_takeover=!0),!1!==this._options.clientNoContextTakeover&&e.client_no_context_takeover&&(t.client_no_context_takeover=!0),"number"==typeof this._options.serverMaxWindowBits?t.server_max_window_bits=this._options.serverMaxWindowBits:"number"==typeof e.server_max_window_bits&&(t.server_max_window_bits=e.server_max_window_bits),"number"==typeof this._options.clientMaxWindowBits?t.client_max_window_bits=this._options.clientMaxWindowBits:!1!==this._options.clientMaxWindowBits&&"number"==typeof e.client_max_window_bits&&(t.client_max_window_bits=e.client_max_window_bits),!0},this))throw new Error("Doesn't support the offered configuration");return t},s.prototype.acceptAsClient=function(e){var t=e[0];if(null!=this._options.clientNoContextTakeover&&!1===this._options.clientNoContextTakeover&&t.client_no_context_takeover)throw new Error('Invalid value for "client_no_context_takeover"');if(null!=this._options.clientMaxWindowBits){if(!1===this._options.clientMaxWindowBits&&t.client_max_window_bits)throw new Error('Invalid value for "client_max_window_bits"');if("number"==typeof this._options.clientMaxWindowBits&&(!t.client_max_window_bits||t.client_max_window_bits>this._options.clientMaxWindowBits))throw new Error('Invalid value for "client_max_window_bits"')}return t},s.prototype.normalizeParams=function(e){return e.map(function(e){return Object.keys(e).forEach(function(t){var i=e[t];if(i.length>1)throw new Error("Multiple extension parameters for "+t);switch(i=i[0],t){case"server_no_context_takeover":case"client_no_context_takeover":if(!0!==i)throw new Error("invalid extension parameter value for "+t+" ("+i+")");e[t]=!0;break;case"server_max_window_bits":case"client_max_window_bits":if("string"==typeof i&&(i=parseInt(i,10),!~n.indexOf(i)))throw new Error("invalid extension parameter value for "+t+" ("+i+")");if(!this._isServer&&!0===i)throw new Error("Missing extension parameter value for "+t);e[t]=i;break;default:throw new Error("Not defined extension parameter ("+t+")")}},this),e},this)},s.prototype.decompress=function(e,t,i){function s(e){o(),i(e)}function n(e){if(void 0!==h._maxPayload&&null!==h._maxPayload&&h._maxPayload>0&&(l+=e.length)>h._maxPayload)return u=[],o(),void i({type:1009});u.push(e)}function o(){h._inflate&&(h._inflate.removeListener("error",s),h._inflate.removeListener("data",n),h._inflate.writeInProgress=!1,(t&&h.params[a+"_no_context_takeover"]||h._inflate.pendingClose)&&(h._inflate.close&&h._inflate.close(),h._inflate=null))}var a=this._isServer?"client":"server";if(!this._inflate){var c=this.params[a+"_max_window_bits"];this._inflate=r.createInflateRaw({windowBits:"number"==typeof c?c:15})}this._inflate.writeInProgress=!0;var h=this,u=[],l=0;this._inflate.on("error",s).on("data",n),this._inflate.write(e),t&&this._inflate.write(new Buffer([0,0,255,255])),this._inflate.flush(function(){o(),i(null,Buffer.concat(u))})},s.prototype.compress=function(e,t,i){function s(e){o(),i(e)}function n(e){u.push(e)}function o(){h._deflate&&(h._deflate.removeListener("error",s),h._deflate.removeListener("data",n),h._deflate.writeInProgress=!1,(t&&h.params[a+"_no_context_takeover"]||h._deflate.pendingClose)&&(h._deflate.close&&h._deflate.close(),h._deflate=null))}var a=this._isServer?"server":"client";if(!this._deflate){var c=this.params[a+"_max_window_bits"];this._deflate=r.createDeflateRaw({flush:r.Z_SYNC_FLUSH,windowBits:"number"==typeof c?c:15,memLevel:this._options.memLevel||8})}this._deflate.writeInProgress=!0;var h=this,u=[];this._deflate.on("error",s).on("data",n),this._deflate.write(e),this._deflate.flush(function(){o();var e=Buffer.concat(u);t&&(e=e.slice(0,e.length-4)),i(null,e)})},e.exports=s},function(e,t){e.exports=require("crypto")},function(e,t,i){"use strict";function s(e,t,i){if(this instanceof s==!1)return new s(e,t,i);D.call(this),t&&!Array.isArray(t)&&"object"==typeof t&&(i=t,t=null),"string"==typeof t&&(t=[t]),Array.isArray(t)||(t=[]),this._socket=null,this._ultron=null,this._closeReceived=!1,this.bytesReceived=0,this.readyState=null,this.supports={},this.extensions={},this._binaryType="nodebuffer",Array.isArray(e)?c.apply(this,e.concat(i)):h.apply(this,[e,t,i])}function r(e,t,i){this.type="message",this.data=e,this.target=i,this.binary=t}function n(e,t,i){this.type="close",this.wasClean=void 0===e||1e3===e,this.code=e,this.reason=t,this.target=i}function o(e){this.type="open",this.target=e}function a(e,t,i){var s=t;return t&&(e&&443!=i||!e&&80!=i)&&(s=s+":"+i),s}function c(e,t,i,r){r=new y({protocolVersion:N,protocol:null,extensions:{},maxPayload:0}).merge(r),this.protocol=r.value.protocol,this.protocolVersion=r.value.protocolVersion,this.extensions=r.value.extensions,this.supports.binary="hixie-76"!==this.protocolVersion,this.upgradeReq=e,this.readyState=s.CONNECTING,this._isServer=!0,this.maxPayload=r.value.maxPayload,"hixie-76"===r.value.protocolVersion?u.call(this,b,R,t,i):u.call(this,A,C,t,i)}function h(e,t,i){if(8!==(i=new y({origin:null,protocolVersion:N,host:null,headers:null,protocol:t.join(","),agent:null,pfx:null,key:null,passphrase:null,cert:null,ca:null,ciphers:null,rejectUnauthorized:null,perMessageDeflate:!0,localAddress:null}).merge(i)).value.protocolVersion&&13!==i.value.protocolVersion)throw new Error("unsupported protocol version");var r=g.parse(e),n="ws+unix:"===r.protocol;if(!r.host&&!n)throw new Error("invalid url");var o,c="wss:"===r.protocol||"https:"===r.protocol,h=c?_:T,l=r.port||(c?443:80),d=r.auth,p={};i.value.perMessageDeflate&&(o=new I(!0!==typeof i.value.perMessageDeflate?i.value.perMessageDeflate:{},!1),p[I.extensionName]=o.offer()),this._isServer=!1,this.url=e,this.protocolVersion=i.value.protocolVersion,this.supports.binary="hixie-76"!==this.protocolVersion;var m=new Buffer(i.value.protocolVersion+"-"+Date.now()).toString("base64"),E=v.createHash("sha1");E.update(m+"258EAFA5-E914-47DA-95CA-C5AB0DC85B11");var S=E.digest("base64"),R=i.value.agent,b=a(c,r.hostname,l),D={port:l,host:r.hostname,headers:{Connection:"Upgrade",Upgrade:"websocket",Host:b,"Sec-WebSocket-Version":i.value.protocolVersion,"Sec-WebSocket-Key":m}};if(d&&(D.headers.Authorization="Basic "+new Buffer(d).toString("base64")),i.value.protocol&&(D.headers["Sec-WebSocket-Protocol"]=i.value.protocol),i.value.host&&(D.headers.Host=i.value.host),i.value.headers)for(var x in i.value.headers)i.value.headers.hasOwnProperty(x)&&(D.headers[x]=i.value.headers[x]);Object.keys(p).length&&(D.headers["Sec-WebSocket-Extensions"]=w.format(p)),(i.isDefinedAndNonNull("pfx")||i.isDefinedAndNonNull("key")||i.isDefinedAndNonNull("passphrase")||i.isDefinedAndNonNull("cert")||i.isDefinedAndNonNull("ca")||i.isDefinedAndNonNull("ciphers")||i.isDefinedAndNonNull("rejectUnauthorized"))&&(i.isDefinedAndNonNull("pfx")&&(D.pfx=i.value.pfx),i.isDefinedAndNonNull("key")&&(D.key=i.value.key),i.isDefinedAndNonNull("passphrase")&&(D.passphrase=i.value.passphrase),i.isDefinedAndNonNull("cert")&&(D.cert=i.value.cert),i.isDefinedAndNonNull("ca")&&(D.ca=i.value.ca),i.isDefinedAndNonNull("ciphers")&&(D.ciphers=i.value.ciphers),i.isDefinedAndNonNull("rejectUnauthorized")&&(D.rejectUnauthorized=i.value.rejectUnauthorized),R||(R=new h.Agent(D))),D.path=r.path||"/",R&&(D.agent=R),n&&(D.socketPath=r.pathname),i.value.localAddress&&(D.localAddress=i.value.localAddress),i.value.origin&&(i.value.protocolVersion<13?D.headers["Sec-WebSocket-Origin"]=i.value.origin:D.headers.Origin=i.value.origin);var O=this,U=h.request(D);U.on("error",function(e){O.emit("error",e),f.call(O,e)}),U.once("response",function(e){var t;O.emit("unexpected-response",U,e)||(t=new Error("unexpected server response ("+e.statusCode+")"),U.abort(),O.emit("error",t)),f.call(O,t)}),U.once("upgrade",function(e,t,r){if(O.readyState===s.CLOSED)return O.emit("close"),O.removeAllListeners(),void t.end();var n=e.headers["sec-websocket-accept"];if(void 0===n||n!==S)return O.emit("error","invalid server key"),O.removeAllListeners(),void t.end();var a=e.headers["sec-websocket-protocol"],c=(i.value.protocol||"").split(/, */),h=null;if(!i.value.protocol&&a?h="server sent a subprotocol even though none requested":i.value.protocol&&!a?h="server sent no subprotocol even though requested":a&&-1===c.indexOf(a)&&(h="server responded with an invalid protocol"),h)return O.emit("error",h),O.removeAllListeners(),void t.end();a&&(O.protocol=a);var l=w.parse(e.headers["sec-websocket-extensions"]);if(o&&l[I.extensionName]){try{o.accept(l[I.extensionName])}catch(e){return O.emit("error","invalid extension parameter"),O.removeAllListeners(),void t.end()}O.extensions[I.extensionName]=o}u.call(O,A,C,t,r),U.removeAllListeners(),U=null,R=null}),U.end(),this.readyState=s.CONNECTING}function u(e,t,i,r){function n(e){c||h.readyState===s.CLOSED||(c=!0,i.removeListener("data",n),a.on("data",o),r&&r.length>0&&(o(r),r=null),e&&o(e))}function o(e){h.bytesReceived+=e.length,h._receiver.add(e)}var a=this._ultron=new S(i),c=!1,h=this;i.setTimeout(0),i.setNoDelay(!0),this._receiver=new e(this.extensions,this.maxPayload),this._socket=i,a.on("end",f.bind(this)),a.on("close",f.bind(this)),a.on("error",f.bind(this)),a.on("data",n),process.nextTick(n),h._receiver.ontext=function(e,t){t=t||{},h.emit("message",e,t)},h._receiver.onbinary=function(e,t){(t=t||{}).binary=!0,h.emit("message",e,t)},h._receiver.onping=function(e,t){t=t||{},h.pong(e,{mask:!h._isServer,binary:!0===t.binary},!0),h.emit("ping",e,t)},h._receiver.onpong=function(e,t){h.emit("pong",e,t||{})},h._receiver.onclose=function(e,t,i){i=i||{},h._closeReceived=!0,h.close(e,t)},h._receiver.onerror=function(e,t){h.close(void 0!==t?t:1002,""),h.emit("error",e instanceof Error?e:new Error(e))},this._sender=new t(i,this.extensions),this._sender.on("error",function(e){h.close(1002,""),h.emit("error",e)}),this.readyState=s.OPEN,this.emit("open")}function l(e){e._queue=e._queue||[]}function d(e){var t=e._queue;if(void 0!==t){delete e._queue;for(var i=0,s=t.length;i<s;++i)t[i]()}}function p(e,t,i,r){t.on("data",function(t){e.readyState===s.OPEN?(i.fin=!1,e._sender.send(t,i)):"function"==typeof r?r(new Error("not opened")):(delete e._queue,e.emit("error",new Error("not opened")))}),t.on("end",function(){e.readyState===s.OPEN?(i.fin=!0,e._sender.send(null,i),"function"==typeof r&&r(null)):"function"==typeof r?r(new Error("not opened")):(delete e._queue,e.emit("error",new Error("not opened")))})}function f(e){if(this.readyState!==s.CLOSED){if(this.readyState=s.CLOSED,clearTimeout(this._closeTimer),this._closeTimer=null,!e&&this._closeReceived||(this._closeCode=1006),this.emit("close",this._closeCode||1e3,this._closeMessage||""),this._socket){this._ultron&&this._ultron.destroy(),this._socket.on("error",function(){try{this.destroy()}catch(e){}});try{e?this._socket.destroy():this._socket.end()}catch(e){}this._socket=null,this._ultron=null}this._sender&&(this._sender.removeAllListeners(),this._sender=null),this._receiver&&(this._receiver.cleanup(),this._receiver=null),this.extensions[I.extensionName]&&this.extensions[I.extensionName].cleanup(),this.extensions=null,this.removeAllListeners(),this.on("error",function(){}),delete this._queue}}/*!
 * ws: a node.js websocket client
 * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>
 * MIT Licensed
 */
var g=i(5),m=i(0),T=i(6),_=i(49),v=i(3),E=i(50),S=i(51),y=i(7),C=i(8),A=i(11),R=i(58),b=i(59),w=i(12),I=i(2),D=i(1).EventEmitter,N=13;m.inherits(s,D),["CONNECTING","OPEN","CLOSING","CLOSED"].forEach(function(e,t){s.prototype[e]=s[e]=t}),s.prototype.close=function(e,t){if(this.readyState!==s.CLOSED)if(this.readyState!==s.CONNECTING)if(this.readyState!==s.CLOSING){var i=this;try{this.readyState=s.CLOSING,this._closeCode=e,this._closeMessage=t;var r=!this._isServer;this._sender.close(e,t,r,function(e){e&&i.emit("error",e),i._closeReceived&&i._isServer?i.terminate():(clearTimeout(i._closeTimer),i._closeTimer=setTimeout(f.bind(i,!0),3e4))})}catch(e){this.emit("error",e)}}else this._closeReceived&&this._isServer&&this.terminate();else this.readyState=s.CLOSED},s.prototype.pause=function(){if(this.readyState!==s.OPEN)throw new Error("not opened");return this._socket.pause()},s.prototype.ping=function(e,t,i){if(this.readyState!==s.OPEN){if(!0===i)return;throw new Error("not opened")}void 0===(t=t||{}).mask&&(t.mask=!this._isServer),this._sender.ping(e,t)},s.prototype.pong=function(e,t,i){if(this.readyState!==s.OPEN){if(!0===i)return;throw new Error("not opened")}void 0===(t=t||{}).mask&&(t.mask=!this._isServer),this._sender.pong(e,t)},s.prototype.resume=function(){if(this.readyState!==s.OPEN)throw new Error("not opened");return this._socket.resume()},s.prototype.send=function(e,t,i){if("function"==typeof t&&(i=t,t={}),this.readyState===s.OPEN)if(e||(e=""),this._queue){n=this;this._queue.push(function(){n.send(e,t,i)})}else{(t=t||{}).fin=!0,void 0===t.binary&&(t.binary=e instanceof ArrayBuffer||e instanceof Buffer||e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array),void 0===t.mask&&(t.mask=!this._isServer),void 0===t.compress&&(t.compress=!0),this.extensions[I.extensionName]||(t.compress=!1);var r="function"==typeof E.Readable?E.Readable:E.Stream;if(e instanceof r){l(this);var n=this;p(this,e,t,function(e){process.nextTick(function(){d(n)}),"function"==typeof i&&i(e)})}else this._sender.send(e,t,i)}else{if("function"!=typeof i)throw new Error("not opened");i(new Error("not opened"))}},s.prototype.stream=function(e,t){function i(n,o){try{if(r.readyState!==s.OPEN)throw new Error("not opened");e.fin=!0===o,r._sender.send(n,e),o?d(r):process.nextTick(t.bind(null,null,i))}catch(e){"function"==typeof t?t(e):(delete r._queue,r.emit("error",e))}}"function"==typeof e&&(t=e,e={});var r=this;if("function"!=typeof t)throw new Error("callback must be provided");if(this.readyState===s.OPEN)this._queue?this._queue.push(function(){r.stream(e,t)}):(void 0===(e=e||{}).mask&&(e.mask=!this._isServer),void 0===e.compress&&(e.compress=!0),this.extensions[I.extensionName]||(e.compress=!1),l(this),process.nextTick(t.bind(null,null,i)));else{if("function"!=typeof t)throw new Error("not opened");t(new Error("not opened"))}},s.prototype.terminate=function(){if(this.readyState!==s.CLOSED)if(this._socket){this.readyState=s.CLOSING;try{this._socket.end()}catch(e){return void f.call(this,!0)}this._closeTimer&&clearTimeout(this._closeTimer),this._closeTimer=setTimeout(f.bind(this,!0),3e4)}else this.readyState===s.CONNECTING&&f.call(this,!0)},Object.defineProperty(s.prototype,"bufferedAmount",{get:function(){var e=0;return this._socket&&(e=this._socket.bufferSize||0),e}}),Object.defineProperty(s.prototype,"binaryType",{get:function(){return this._binaryType},set:function(e){if("arraybuffer"!==e&&"nodebuffer"!==e)throw new SyntaxError('unsupported binaryType: must be either "nodebuffer" or "arraybuffer"');this._binaryType=e}}),["open","error","close","message"].forEach(function(e){Object.defineProperty(s.prototype,"on"+e,{get:function(){var t=this.listeners(e)[0];return t?t._listener?t._listener:t:void 0},set:function(t){this.removeAllListeners(e),this.addEventListener(e,t)}})}),s.prototype.addEventListener=function(e,t){function i(e,i){i.binary&&"arraybuffer"===this.binaryType&&(e=new Uint8Array(e).buffer),t.call(h,new r(e,!!i.binary,h))}function s(e,i){t.call(h,new n(e,i,h))}function a(e){e.type="error",e.target=h,t.call(h,e)}function c(){t.call(h,new o(h))}var h=this;"function"==typeof t&&("message"===e?(i._listener=t,this.on(e,i)):"close"===e?(s._listener=t,this.on(e,s)):"error"===e?(a._listener=t,this.on(e,a)):"open"===e?(c._listener=t,this.on(e,c)):this.on(e,t))},e.exports=s,e.exports.buildHostHeader=a},function(e,t){e.exports=require("url")},function(e,t){e.exports=require("http")},function(e,t,i){/*!
 * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>
 * MIT Licensed
 */
var s=i(52);e.exports=function(e){var t={},i=this.value={};Object.keys(e).forEach(function(s){t[s]=e[s],Object.defineProperty(i,s,{get:function(){return t[s]},configurable:!1,enumerable:!0})}),this.reset=function(){return Object.keys(e).forEach(function(i){t[i]=e[i]}),this},this.merge=function(e,i){if(e=e||{},"[object Array]"===Object.prototype.toString.call(i)){for(var s=[],r=0,n=i.length;r<n;++r){var o=i[r];o in e||s.push(o)}if(s.length>0)throw s.length>1?new Error("options "+s.slice(0,s.length-1).join(", ")+" and "+s[s.length-1]+" must be defined"):new Error("option "+s[0]+" must be defined")}return Object.keys(e).forEach(function(i){i in t&&(t[i]=e[i])}),this},this.copy=function(t){var s={};return Object.keys(e).forEach(function(e){-1!==t.indexOf(e)&&(s[e]=i[e])}),s},this.read=function(e,t){if("function"==typeof t){var i=this;s.readFile(e,function(e,s){if(e)return t(e);var r=JSON.parse(s);i.merge(r),t()})}else{var r=JSON.parse(s.readFileSync(e));this.merge(r)}return this},this.isDefined=function(e){return void 0!==i[e]},this.isDefinedAndNonNull=function(e){return void 0!==i[e]&&null!==i[e]},Object.freeze(i),Object.freeze(this)}},function(e,t,i){function s(e,t){if(this instanceof s==!1)throw new TypeError("Classes can't be function-called");c.EventEmitter.call(this),this._socket=e,this.extensions=t||{},this.firstFragment=!0,this.compress=!1,this.messageHandlers=[],this.processing=!1}function r(e,t){this[t]=(65280&e)>>8,this[t+1]=255&e}function n(e,t){this[t]=(4278190080&e)>>24,this[t+1]=(16711680&e)>>16,this[t+2]=(65280&e)>>8,this[t+3]=255&e}function o(e){for(var t=new Uint8Array(e.buffer||e),i=e.byteLength||e.length,s=e.byteOffset||0,r=new Buffer(i),n=0;n<i;++n)r[n]=t[s+n];return r}function a(){return u.randomBytes(4)}/*!
 * ws: a node.js websocket client
 * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>
 * MIT Licensed
 */
var c=i(1),h=i(0),u=i(3),l=(c.EventEmitter,i(9)),d=i(10),p=i(2);h.inherits(s,c.EventEmitter),s.prototype.close=function(e,t,i,s){if(void 0!==e&&("number"!=typeof e||!l.isValidErrorCode(e)))throw new Error("first argument must be a valid error code number");e=e||1e3;var n=new Buffer(2+(t?Buffer.byteLength(t):0));r.call(n,e,0),n.length>2&&n.write(t,2);var o=this;this.messageHandlers.push(function(){o.frameAndSend(8,n,!0,i),"function"==typeof s&&s()}),this.flush()},s.prototype.ping=function(e,t){var i=t&&t.mask,s=this;this.messageHandlers.push(function(){s.frameAndSend(9,e||"",!0,i)}),this.flush()},s.prototype.pong=function(e,t){var i=t&&t.mask,s=this;this.messageHandlers.push(function(){s.frameAndSend(10,e||"",!0,i)}),this.flush()},s.prototype.send=function(e,t,i){var s=!t||!1!==t.fin,r=t&&t.mask,n=t&&t.compress,o=t&&t.binary?2:1;!1===this.firstFragment?(o=0,n=!1):(this.firstFragment=!1,this.compress=n),s&&(this.firstFragment=!0);var a=this.compress,c=this;this.messageHandlers.push(function(){e&&a?(c.processing=!0,c.applyExtensions(e,s,a,function(e,t){e?"function"==typeof i?i(e):c.emit("error",e):(c.frameAndSend(o,t,s,r,n,i),c.processing=!1,c.flush())})):c.frameAndSend(o,e,s,r,n,i)}),this.flush()},s.prototype.frameAndSend=function(e,t,i,s,c,h){var u=!1;if(t){Buffer.isBuffer(t)||(u=!0,!t||void 0===t.byteLength&&void 0===t.buffer?("number"==typeof t&&(t=t.toString()),t=new Buffer(t)):t=o(t));var l=t.length,p=s?6:2,f=l;l>=65536?(p+=8,f=127):l>125&&(p+=2,f=126);var g=l<32768||s&&!u,m=g?l+p:p,T=new Buffer(m);switch(T[0]=i?128|e:e,c&&(T[0]|=64),f){case 126:r.call(T,l,2);break;case 127:n.call(T,0,2),n.call(T,l,6)}if(s){T[1]=128|f;var _=a();if(T[p-4]=_[0],T[p-3]=_[1],T[p-2]=_[2],T[p-1]=_[3],g){d.mask(t,_,T,p,l);try{this._socket.write(T,"binary",h)}catch(e){"function"==typeof h?h(e):this.emit("error",e)}}else{d.mask(t,_,t,0,l);try{this._socket.write(T,"binary"),this._socket.write(t,"binary",h)}catch(e){"function"==typeof h?h(e):this.emit("error",e)}}}else if(T[1]=f,g){t.copy(T,p);try{this._socket.write(T,"binary",h)}catch(e){"function"==typeof h?h(e):this.emit("error",e)}}else try{this._socket.write(T,"binary"),this._socket.write(t,"binary",h)}catch(e){"function"==typeof h?h(e):this.emit("error",e)}}else try{this._socket.write(new Buffer([e|(i?128:0),0|(s?128:0)].concat(s?[0,0,0,0]:[])),"binary",h)}catch(e){"function"==typeof h?h(e):this.emit("error",e)}},s.prototype.flush=function(){for(;!this.processing&&this.messageHandlers.length;)this.messageHandlers.shift()()},s.prototype.applyExtensions=function(e,t,i,s){(e.buffer||e)instanceof ArrayBuffer&&(e=o(e)),this.extensions[p.extensionName].compress(e,t,s)},e.exports=s},function(e,t){/*!
 * ws: a node.js websocket client
 * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>
 * MIT Licensed
 */
e.exports={isValidErrorCode:function(e){return e>=1e3&&e<=1011&&1004!=e&&1005!=e&&1006!=e||e>=3e3&&e<=4999},1e3:"normal",1001:"going away",1002:"protocol error",1003:"unsupported data",1004:"reserved",1005:"reserved for extensions",1006:"reserved for extensions",1007:"inconsistent or invalid data",1008:"policy violation",1009:"message too big",1010:"extension handshake missing",1011:"an unexpected condition prevented the request from being fulfilled"}},function(e,t,i){"use strict";/*!
 * ws: a node.js websocket client
 * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>
 * MIT Licensed
 */
var s;try{s=i(!function(){var e=new Error('Cannot find module "bufferutil"');throw e.code="MODULE_NOT_FOUND",e}())}catch(e){s=i(53)}e.exports=s.BufferUtil||s},function(e,t,i){function s(e,t){if(this instanceof s==!1)throw new TypeError("Classes can't be function-called");"number"==typeof e&&(t=e,e={});var i=-1;this.fragmentedBufferPool=new u(1024,function(e,t){return e.used+t},function(e){return i=i>=0?Math.ceil((i+e.used)/2):e.used});var r=-1;this.unfragmentedBufferPool=new u(1024,function(e,t){return e.used+t},function(e){return r=r>=0?Math.ceil((r+e.used)/2):e.used}),this.extensions=e||{},this.maxPayload=t||0,this.currentPayloadLength=0,this.state={activeFragmentedOperation:null,lastFragment:!1,masked:!1,opcode:0,fragmentedOperation:!1},this.overflow=[],this.headerBuffer=new Buffer(10),this.expectOffset=0,this.expectBuffer=null,this.expectHandler=null,this.currentMessage=[],this.currentMessageLength=0,this.messageHandlers=[],this.expectHeader(2,this.processPacket),this.dead=!1,this.processing=!1,this.onerror=function(){},this.ontext=function(){},this.onbinary=function(){},this.onclose=function(){},this.onping=function(){},this.onpong=function(){}}function r(e){return(this[e]<<8)+this[e+1]}function n(e){return(this[e]<<24)+(this[e+1]<<16)+(this[e+2]<<8)+this[e+3]}function o(e,t,i,s){switch(e){default:t.copy(i,s,0,e);break;case 16:i[s+15]=t[15];case 15:i[s+14]=t[14];case 14:i[s+13]=t[13];case 13:i[s+12]=t[12];case 12:i[s+11]=t[11];case 11:i[s+10]=t[10];case 10:i[s+9]=t[9];case 9:i[s+8]=t[8];case 8:i[s+7]=t[7];case 7:i[s+6]=t[6];case 6:i[s+5]=t[5];case 5:i[s+4]=t[4];case 4:i[s+3]=t[3];case 3:i[s+2]=t[2];case 2:i[s+1]=t[1];case 1:i[s]=t[0]}}function a(e){var t={};for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t}/*!
 * ws: a node.js websocket client
 * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>
 * MIT Licensed
 */
i(0);var c=i(55),h=i(9),u=i(57),l=i(10),d=i(2);e.exports=s,s.prototype.add=function(e){if(!this.dead){var t=e.length;if(0!=t)if(null!=this.expectBuffer){var i=Math.min(t,this.expectBuffer.length-this.expectOffset);for(o(i,e,this.expectBuffer,this.expectOffset),this.expectOffset+=i,i<t&&this.overflow.push(e.slice(i));this.expectBuffer&&this.expectOffset==this.expectBuffer.length;){var s=this.expectBuffer;this.expectBuffer=null,this.expectOffset=0,this.expectHandler.call(this,s)}}else this.overflow.push(e)}},s.prototype.cleanup=function(){this.dead=!0,this.overflow=null,this.headerBuffer=null,this.expectBuffer=null,this.expectHandler=null,this.unfragmentedBufferPool=null,this.fragmentedBufferPool=null,this.state=null,this.currentMessage=null,this.onerror=null,this.ontext=null,this.onbinary=null,this.onclose=null,this.onping=null,this.onpong=null},s.prototype.expectHeader=function(e,t){if(0!=e){this.expectBuffer=this.headerBuffer.slice(this.expectOffset,this.expectOffset+e),this.expectHandler=t;for(var i=e;i>0&&this.overflow.length>0;){var s=this.overflow.pop();i<s.length&&this.overflow.push(s.slice(i));var r=Math.min(s.length,i);o(r,s,this.expectBuffer,this.expectOffset),this.expectOffset+=r,i-=r}}else t(null)},s.prototype.expectData=function(e,t){if(0!=e){this.expectBuffer=this.allocateFromPool(e,this.state.fragmentedOperation),this.expectHandler=t;for(var i=e;i>0&&this.overflow.length>0;){var s=this.overflow.pop();i<s.length&&this.overflow.push(s.slice(i));var r=Math.min(s.length,i);o(r,s,this.expectBuffer,this.expectOffset),this.expectOffset+=r,i-=r}}else t(null)},s.prototype.allocateFromPool=function(e,t){return(t?this.fragmentedBufferPool:this.unfragmentedBufferPool).get(e)},s.prototype.processPacket=function(e){if(this.extensions[d.extensionName]){if(0!=(48&e[0]))return void this.error("reserved fields (2, 3) must be empty",1002)}else if(0!=(112&e[0]))return void this.error("reserved fields must be empty",1002);this.state.lastFragment=128==(128&e[0]),this.state.masked=128==(128&e[1]);var t=64==(64&e[0]),i=15&e[0];if(0===i){if(t)return void this.error("continuation frame cannot have the Per-message Compressed bits",1002);if(this.state.fragmentedOperation=!0,this.state.opcode=this.state.activeFragmentedOperation,1!=this.state.opcode&&2!=this.state.opcode)return void this.error("continuation frame cannot follow current opcode",1002)}else{if(i<3&&null!=this.state.activeFragmentedOperation)return void this.error("data frames after the initial data frame must have opcode 0",1002);if(i>=8&&t)return void this.error("control frames cannot have the Per-message Compressed bits",1002);this.state.compressed=t,this.state.opcode=i,!1===this.state.lastFragment?(this.state.fragmentedOperation=!0,this.state.activeFragmentedOperation=i):this.state.fragmentedOperation=!1}var s=p[this.state.opcode];void 0===s?this.error("no handler for opcode "+this.state.opcode,1002):s.start.call(this,e)},s.prototype.endPacket=function(){this.dead||(this.state.fragmentedOperation?this.state.lastFragment&&this.fragmentedBufferPool.reset(!0):this.unfragmentedBufferPool.reset(!0),this.expectOffset=0,this.expectBuffer=null,this.expectHandler=null,this.state.lastFragment&&this.state.opcode===this.state.activeFragmentedOperation&&(this.state.activeFragmentedOperation=null),this.currentPayloadLength=0,this.state.lastFragment=!1,this.state.opcode=null!=this.state.activeFragmentedOperation?this.state.activeFragmentedOperation:0,this.state.masked=!1,this.expectHeader(2,this.processPacket))},s.prototype.reset=function(){this.dead||(this.state={activeFragmentedOperation:null,lastFragment:!1,masked:!1,opcode:0,fragmentedOperation:!1},this.fragmentedBufferPool.reset(!0),this.unfragmentedBufferPool.reset(!0),this.expectOffset=0,this.expectBuffer=null,this.expectHandler=null,this.overflow=[],this.currentMessage=[],this.currentMessageLength=0,this.messageHandlers=[],this.currentPayloadLength=0)},s.prototype.unmask=function(e,t,i){return null!=e&&null!=t&&l.unmask(t,e),i?t:null!=t?t.toString("utf8"):""},s.prototype.error=function(e,t){if(!this.dead)return this.reset(),"string"==typeof e?this.onerror(new Error(e),t):e.constructor==Error?this.onerror(e,t):this.onerror(new Error("An error occured"),t),this},s.prototype.flush=function(){if(!this.processing&&!this.dead){var e=this.messageHandlers.shift();if(e){this.processing=!0;var t=this;e(function(){t.processing=!1,t.flush()})}}},s.prototype.applyExtensions=function(e,t,i,s){var r=this;i?this.extensions[d.extensionName].decompress(e,t,function(e,t){r.dead||(e?s(new Error("invalid compressed data")):s(null,t))}):s(null,e)},s.prototype.maxPayloadExceeded=function(e){if(void 0===this.maxPayload||null===this.maxPayload||this.maxPayload<1)return!1;var t=this.currentPayloadLength+e;return t<this.maxPayload?(this.currentPayloadLength=t,!1):(this.error("payload cannot exceed "+this.maxPayload+" bytes",1009),this.messageBuffer=[],this.cleanup(),!0)};var p={1:{start:function(e){var t=this,i=127&e[1];if(i<126){if(t.maxPayloadExceeded(i))return void t.error("Maximumpayload exceeded in compressed text message. Aborting...",1009);p[1].getData.call(t,i)}else 126==i?t.expectHeader(2,function(e){var i=r.call(e,0);t.maxPayloadExceeded(i)?t.error("Maximumpayload exceeded in compressed text message. Aborting...",1009):p[1].getData.call(t,i)}):127==i&&t.expectHeader(8,function(e){if(0==n.call(e,0)){var i=n.call(e,4);t.maxPayloadExceeded(i)?t.error("Maximumpayload exceeded in compressed text message. Aborting...",1009):p[1].getData.call(t,n.call(e,4))}else t.error("packets with length spanning more than 32 bit is currently not supported",1008)})},getData:function(e){var t=this;t.state.masked?t.expectHeader(4,function(i){var s=i;t.expectData(e,function(e){p[1].finish.call(t,s,e)})}):t.expectData(e,function(e){p[1].finish.call(t,null,e)})},finish:function(e,t){var i=this,s=this.unmask(e,t,!0)||new Buffer(0),r=a(this.state);this.messageHandlers.push(function(e){i.applyExtensions(s,r.lastFragment,r.compressed,function(t,s){if(t)return 1009===t.type?i.error("Maximumpayload exceeded in compressed text message. Aborting...",1009):i.error(t.message,1007);if(null!=s){if(!(0==i.maxPayload||i.maxPayload>0&&i.currentMessageLength+s.length<i.maxPayload))return i.currentMessage=null,i.currentMessage=[],i.currentMessageLength=0,void i.error(new Error("Maximum payload exceeded. maxPayload: "+i.maxPayload),1009);i.currentMessage.push(s),i.currentMessageLength+=s.length}if(r.lastFragment){var n=Buffer.concat(i.currentMessage);if(i.currentMessage=[],i.currentMessageLength=0,!c(n))return void i.error("invalid utf8 sequence",1007);i.ontext(n.toString("utf8"),{masked:r.masked,buffer:n})}e()})}),this.flush(),this.endPacket()}},2:{start:function(e){var t=this,i=127&e[1];if(i<126){if(t.maxPayloadExceeded(i))return void t.error("Max payload exceeded in compressed text message. Aborting...",1009);p[2].getData.call(t,i)}else 126==i?t.expectHeader(2,function(e){var i=r.call(e,0);t.maxPayloadExceeded(i)?t.error("Max payload exceeded in compressed text message. Aborting...",1009):p[2].getData.call(t,i)}):127==i&&t.expectHeader(8,function(e){if(0==n.call(e,0)){var i=n.call(e,4,!0);t.maxPayloadExceeded(i)?t.error("Max payload exceeded in compressed text message. Aborting...",1009):p[2].getData.call(t,i)}else t.error("packets with length spanning more than 32 bit is currently not supported",1008)})},getData:function(e){var t=this;t.state.masked?t.expectHeader(4,function(i){var s=i;t.expectData(e,function(e){p[2].finish.call(t,s,e)})}):t.expectData(e,function(e){p[2].finish.call(t,null,e)})},finish:function(e,t){var i=this,s=this.unmask(e,t,!0)||new Buffer(0),r=a(this.state);this.messageHandlers.push(function(e){i.applyExtensions(s,r.lastFragment,r.compressed,function(t,s){if(t)return 1009===t.type?i.error("Max payload exceeded in compressed binary message. Aborting...",1009):i.error(t.message,1007);if(null!=s){if(!(0==i.maxPayload||i.maxPayload>0&&i.currentMessageLength+s.length<i.maxPayload))return i.currentMessage=null,i.currentMessage=[],i.currentMessageLength=0,void i.error(new Error("Maximum payload exceeded"),1009);i.currentMessage.push(s),i.currentMessageLength+=s.length}if(r.lastFragment){var n=Buffer.concat(i.currentMessage);i.currentMessage=[],i.currentMessageLength=0,i.onbinary(n,{masked:r.masked,buffer:n})}e()})}),this.flush(),this.endPacket()}},8:{start:function(e){var t=this;if(0!=t.state.lastFragment){var i=127&e[1];i<126?p[8].getData.call(t,i):t.error("control frames cannot have more than 125 bytes of data",1002)}else t.error("fragmented close is not supported",1002)},getData:function(e){var t=this;t.state.masked?t.expectHeader(4,function(i){var s=i;t.expectData(e,function(e){p[8].finish.call(t,s,e)})}):t.expectData(e,function(e){p[8].finish.call(t,null,e)})},finish:function(e,t){var i=this;t=i.unmask(e,t,!0);var s=a(this.state);this.messageHandlers.push(function(){if(t&&1==t.length)i.error("close packets with data must be at least two bytes long",1002);else{var e=t&&t.length>1?r.call(t,0):1e3;if(h.isValidErrorCode(e)){var n="";if(t&&t.length>2){var o=t.slice(2);if(!c(o))return void i.error("invalid utf8 sequence",1007);n=o.toString("utf8")}i.onclose(e,n,{masked:s.masked}),i.reset()}else i.error("invalid error code",1002)}}),this.flush()}},9:{start:function(e){var t=this;if(0!=t.state.lastFragment){var i=127&e[1];i<126?p[9].getData.call(t,i):t.error("control frames cannot have more than 125 bytes of data",1002)}else t.error("fragmented ping is not supported",1002)},getData:function(e){var t=this;t.state.masked?t.expectHeader(4,function(i){var s=i;t.expectData(e,function(e){p[9].finish.call(t,s,e)})}):t.expectData(e,function(e){p[9].finish.call(t,null,e)})},finish:function(e,t){var i=this;t=this.unmask(e,t,!0);var s=a(this.state);this.messageHandlers.push(function(e){i.onping(t,{masked:s.masked,binary:!0}),e()}),this.flush(),this.endPacket()}},10:{start:function(e){var t=this;if(0!=t.state.lastFragment){var i=127&e[1];i<126?p[10].getData.call(t,i):t.error("control frames cannot have more than 125 bytes of data",1002)}else t.error("fragmented pong is not supported",1002)},getData:function(e){var t=this;this.state.masked?this.expectHeader(4,function(i){var s=i;t.expectData(e,function(e){p[10].finish.call(t,s,e)})}):this.expectData(e,function(e){p[10].finish.call(t,null,e)})},finish:function(e,t){var i=this;t=i.unmask(e,t,!0);var s=a(this.state);this.messageHandlers.push(function(e){i.onpong(t,{masked:s.masked,binary:!0}),e()}),this.flush(),this.endPacket()}}}},function(e,t,i){var s=i(0);t.parse=function(e){var t={};return(e=e||"").split(",").forEach(function(e){var i=e.split(";"),s=i.shift().trim(),r=t[s]=t[s]||[],n={};i.forEach(function(e){var t=e.trim().split("="),i=t[0],s=t[1];void 0===s?s=!0:('"'===s[0]&&(s=s.slice(1)),'"'===s[s.length-1]&&(s=s.slice(0,s.length-1))),(n[i]=n[i]||[]).push(s)}),r.push(n)}),t},t.format=function(e){return Object.keys(e).map(function(t){var i=e[t];return s.isArray(i)||(i=[i]),i.map(function(e){return[t].concat(Object.keys(e).map(function(t){var i=e[t];return s.isArray(i)||(i=[i]),i.map(function(e){return!0===e?t:t+"="+e}).join("; ")})).join("; ")}).join(", ")}).join(", ")}},function(e,t,i){"use strict";e.exports=i(14)(i(45))},function(e,t,i){"use strict";e.exports=function(e){var t=i(15),s=t.version,r=t.title,n=Object.defineProperties({},{version:{get:function(){return s}},name:{get:function(){return r}}});return i(16)(n,e),n.LoggerFactory=i(17)(e.console),n.EventEmitter=i(18)(),n.C=i(19)(n.name,n.version),n.Exceptions=i(20),n.Timers=i(21)(e.timers),n.Transport=e.Transport(n,e.WebSocket),i(22)(n),i(23)(n),i(24)(n),i(25)(n),i(26)(n),i(27)(n),i(29)(n),i(30)(n),n.SessionDescriptionHandler=i(31)(n.EventEmitter),i(32)(n),i(33)(n),i(34)(n,e),i(36)(n),i(37)(n,e),i(39)(n),n.DigestAuthentication=i(40)(n.Utils),n.Grammar=i(41)(n),n.WebRTC={Modifiers:i(43)(n),Simple:i(44)(n)},n}},function(e,t){e.exports={name:"sip.js",title:"SIP.js",description:"A simple, intuitive, and powerful JavaScript signaling library",version:"0.8.2",main:"dist/sip.min.js",browser:{"./src/environment.js":"./src/environment_browser.js"},homepage:"http://sipjs.com",author:"OnSIP <developer@onsip.com> (http://sipjs.com/aboutus/)",contributors:[{url:"https://github.com/onsip/SIP.js/blob/master/THANKS.md"}],repository:{type:"git",url:"https://github.com/onsip/SIP.js.git"},keywords:["sip","websocket","webrtc","library","javascript"],devDependencies:{eslint:"^4.9.0","eslint-loader":"^1.9.0","jasmine-core":"^2.8.0",karma:"^1.7.1","karma-cli":"^1.0.1","karma-jasmine":"^1.1.0","karma-jasmine-html-reporter":"^0.2.2","karma-mocha-reporter":"^2.2.5","karma-phantomjs-launcher":"^1.0.4",pegjs:"^0.10.0","pegjs-loader":"^0.5.4","uglifyjs-webpack-plugin":"^1.0.1",webpack:"^3.8.1"},engines:{node:">=4.0"},license:"MIT",scripts:{build:"webpack --progress && cp dist/sip.js dist/sip-$npm_package_version.js && cp dist/sip.min.js  dist/sip-$npm_package_version.min.js",browserTest:"sleep 2 && open http://0.0.0.0:9876/debug.html & karma start --reporters kjhtml --no-single-run",commandLineTest:"karma start --reporters mocha --browsers PhantomJS --single-run",buildAndTest:"npm run build && npm run commandLineTest"},dependencies:{ws:"^1.0.1"},optionalDependencies:{promiscuous:"^0.6.0"}}},function(e,t,i){"use strict";e.exports=function(e,t){var i;i={Promise:t.Promise,defer:function(){var e={};return e.promise=new i.Promise(function(t,i){e.resolve=t,e.reject=i}),e},reducePromises:function(t,i){return t.reduce(function(e,t){return e=e.then(t)},e.Utils.Promise.resolve(i))},augment:function(e,t,i,s){var r,n;n=t.prototype;for(r in n)(s||void 0===e[r])&&(e[r]=n[r]);t.apply(e,i)},optionsOverride:function(e,t,i,s,r,n){s&&e[i]&&r.warn(i+" is deprecated, please use "+t+" instead"),e[t]&&e[i]&&r.warn(t+" overriding "+i),e[t]=e[t]||e[i]||n},str_utf8_length:function(e){return encodeURIComponent(e).replace(/%[A-F\d]{2}/g,"U").length},generateFakeSDP:function(e){if(e){var t=e.indexOf("o="),i=e.indexOf("\r\n",t);return"v=0\r\n"+e.slice(t,i)+"\r\ns=-\r\nt=0 0\r\nc=IN IP4 0.0.0.0"}},isFunction:function(e){return void 0!==e&&"[object Function]"===Object.prototype.toString.call(e)},isDecimal:function(e){return!isNaN(e)&&parseFloat(e)===parseInt(e,10)},createRandomToken:function(e,t){var i,s="";for(t=t||32,i=0;i<e;i++)s+=(Math.random()*t|0).toString(t);return s},newTag:function(){return e.Utils.createRandomToken(e.UA.C.TAG_LENGTH)},newUUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},hostType:function(t){if(t)return-1!==(t=e.Grammar.parse(t,"host"))?t.host_type:void 0},normalizeTarget:function(t,i){var s,r,n;if(t){if(t instanceof e.URI)return t;if("string"==typeof t){switch((s=t.split("@")).length){case 1:if(!i)return;r=t,n=i;break;case 2:r=s[0],n=s[1];break;default:r=s.slice(0,s.length-1).join("@"),n=s[s.length-1]}return r=r.replace(/^(sips?|tel):/i,""),/^[\-\.\(\)]*\+?[0-9\-\.\(\)]+$/.test(r)&&(r=r.replace(/[\-\.\(\)]/g,"")),t=e.C.SIP+":"+e.Utils.escapeUser(r)+"@"+n,e.URI.parse(t)}}else;},escapeUser:function(e){return encodeURIComponent(decodeURIComponent(e)).replace(/%3A/gi,":").replace(/%2B/gi,"+").replace(/%3F/gi,"?").replace(/%2F/gi,"/")},headerize:function(e){var t,i={"Call-Id":"Call-ID",Cseq:"CSeq","Min-Se":"Min-SE",Rack:"RAck",Rseq:"RSeq","Www-Authenticate":"WWW-Authenticate"},s=e.toLowerCase().replace(/_/g,"-").split("-"),r="",n=s.length;for(t=0;t<n;t++)0!==t&&(r+="-"),r+=s[t].charAt(0).toUpperCase()+s[t].substring(1);return i[r]&&(r=i[r]),r},sipErrorCause:function(t){var i;for(i in e.C.SIP_ERROR_CAUSES)if(-1!==e.C.SIP_ERROR_CAUSES[i].indexOf(t))return e.C.causes[i];return e.C.causes.SIP_FAILURE_CODE},getReasonPhrase:function(t,i){return i||e.C.REASON_PHRASE[t]||""},getReasonHeaderValue:function(t,i){return i=e.Utils.getReasonPhrase(t,i),"SIP ;cause="+t+' ;text="'+i+'"'},getCancelReason:function(t,i){if(t&&t<200||t>699)throw new TypeError("Invalid status_code: "+t);if(t)return e.Utils.getReasonHeaderValue(t,i)},buildStatusLine:function(e,t){if(e=e||null,t=t||null,!e||e<100||e>699)throw new TypeError("Invalid status_code: "+e);if(t&&"string"!=typeof t&&!(t instanceof String))throw new TypeError("Invalid reason_phrase: "+t);return t=i.getReasonPhrase(e,t),"SIP/2.0 "+e+" "+t+"\r\n"},getRandomTestNetIP:function(){return"192.0.2."+function(e,t){return Math.floor(Math.random()*(t-e+1)+e)}(1,254)},calculateMD5:function(e){function t(e,t){return e<<t|e>>>32-t}function i(e,t){var i,s,r,n,o;return r=2147483648&e,n=2147483648&t,i=1073741824&e,s=1073741824&t,o=(1073741823&e)+(1073741823&t),i&s?2147483648^o^r^n:i|s?1073741824&o?3221225472^o^r^n:1073741824^o^r^n:o^r^n}function s(e,t,i){return e&t|~e&i}function r(e,t,i){return e&i|t&~i}function n(e,t,i){return e^t^i}function o(e,t,i){return t^(e|~i)}function a(e,r,n,o,a,c,h){return e=i(e,i(i(s(r,n,o),a),h)),i(t(e,c),r)}function c(e,s,n,o,a,c,h){return e=i(e,i(i(r(s,n,o),a),h)),i(t(e,c),s)}function h(e,s,r,o,a,c,h){return e=i(e,i(i(n(s,r,o),a),h)),i(t(e,c),s)}function u(e,s,r,n,a,c,h){return e=i(e,i(i(o(s,r,n),a),h)),i(t(e,c),s)}function l(e){var t,i="",s="";for(t=0;t<=3;t++)i+=(s="0"+(e>>>8*t&255).toString(16)).substr(s.length-2,2);return i}var d,p,f,g,m,T,_,v,E,S=[];for(S=function(e){for(var t,i=e.length,s=i+8,r=16*((s-s%64)/64+1),n=Array(r-1),o=0,a=0;a<i;)o=a%4*8,n[t=(a-a%4)/4]=n[t]|e.charCodeAt(a)<<o,a++;return t=(a-a%4)/4,o=a%4*8,n[t]=n[t]|128<<o,n[r-2]=i<<3,n[r-1]=i>>>29,n}(e=function(e){e=e.replace(/\r\n/g,"\n");for(var t="",i=0;i<e.length;i++){var s=e.charCodeAt(i);s<128?t+=String.fromCharCode(s):s>127&&s<2048?(t+=String.fromCharCode(s>>6|192),t+=String.fromCharCode(63&s|128)):(t+=String.fromCharCode(s>>12|224),t+=String.fromCharCode(s>>6&63|128),t+=String.fromCharCode(63&s|128))}return t}(e)),T=1732584193,_=4023233417,v=2562383102,E=271733878,d=0;d<S.length;d+=16)p=T,f=_,g=v,m=E,_=u(_=u(_=u(_=u(_=h(_=h(_=h(_=h(_=c(_=c(_=c(_=c(_=a(_=a(_=a(_=a(_,v=a(v,E=a(E,T=a(T,_,v,E,S[d+0],7,3614090360),_,v,S[d+1],12,3905402710),T,_,S[d+2],17,606105819),E,T,S[d+3],22,3250441966),v=a(v,E=a(E,T=a(T,_,v,E,S[d+4],7,4118548399),_,v,S[d+5],12,1200080426),T,_,S[d+6],17,2821735955),E,T,S[d+7],22,4249261313),v=a(v,E=a(E,T=a(T,_,v,E,S[d+8],7,1770035416),_,v,S[d+9],12,2336552879),T,_,S[d+10],17,4294925233),E,T,S[d+11],22,2304563134),v=a(v,E=a(E,T=a(T,_,v,E,S[d+12],7,1804603682),_,v,S[d+13],12,4254626195),T,_,S[d+14],17,2792965006),E,T,S[d+15],22,1236535329),v=c(v,E=c(E,T=c(T,_,v,E,S[d+1],5,4129170786),_,v,S[d+6],9,3225465664),T,_,S[d+11],14,643717713),E,T,S[d+0],20,3921069994),v=c(v,E=c(E,T=c(T,_,v,E,S[d+5],5,3593408605),_,v,S[d+10],9,38016083),T,_,S[d+15],14,3634488961),E,T,S[d+4],20,3889429448),v=c(v,E=c(E,T=c(T,_,v,E,S[d+9],5,568446438),_,v,S[d+14],9,3275163606),T,_,S[d+3],14,4107603335),E,T,S[d+8],20,1163531501),v=c(v,E=c(E,T=c(T,_,v,E,S[d+13],5,2850285829),_,v,S[d+2],9,4243563512),T,_,S[d+7],14,1735328473),E,T,S[d+12],20,2368359562),v=h(v,E=h(E,T=h(T,_,v,E,S[d+5],4,4294588738),_,v,S[d+8],11,2272392833),T,_,S[d+11],16,1839030562),E,T,S[d+14],23,4259657740),v=h(v,E=h(E,T=h(T,_,v,E,S[d+1],4,2763975236),_,v,S[d+4],11,1272893353),T,_,S[d+7],16,4139469664),E,T,S[d+10],23,3200236656),v=h(v,E=h(E,T=h(T,_,v,E,S[d+13],4,681279174),_,v,S[d+0],11,3936430074),T,_,S[d+3],16,3572445317),E,T,S[d+6],23,76029189),v=h(v,E=h(E,T=h(T,_,v,E,S[d+9],4,3654602809),_,v,S[d+12],11,3873151461),T,_,S[d+15],16,530742520),E,T,S[d+2],23,3299628645),v=u(v,E=u(E,T=u(T,_,v,E,S[d+0],6,4096336452),_,v,S[d+7],10,1126891415),T,_,S[d+14],15,2878612391),E,T,S[d+5],21,4237533241),v=u(v,E=u(E,T=u(T,_,v,E,S[d+12],6,1700485571),_,v,S[d+3],10,2399980690),T,_,S[d+10],15,4293915773),E,T,S[d+1],21,2240044497),v=u(v,E=u(E,T=u(T,_,v,E,S[d+8],6,1873313359),_,v,S[d+15],10,4264355552),T,_,S[d+6],15,2734768916),E,T,S[d+13],21,1309151649),v=u(v,E=u(E,T=u(T,_,v,E,S[d+4],6,4149444226),_,v,S[d+11],10,3174756917),T,_,S[d+2],15,718787259),E,T,S[d+9],21,3951481745),T=i(T,p),_=i(_,f),v=i(v,g),E=i(E,m);return(l(T)+l(_)+l(v)+l(E)).toLowerCase()}},e.Utils=i}},function(e,t,i){"use strict";var s={error:0,warn:1,log:2,debug:3};e.exports=function(e){function t(e,t,i){this.logger=e,this.category=t,this.label=i}var i=function(){var e,t=2,i=!0,r=null;this.loggers={},e=this.getLogger("sip.loggerfactory"),Object.defineProperties(this,{builtinEnabled:{get:function(){return i},set:function(t){"boolean"==typeof t?i=t:e.error('invalid "builtinEnabled" parameter value: '+JSON.stringify(t))}},level:{get:function(){return t},set:function(i){i>=0&&i<=3?t=i:i>3?t=3:s.hasOwnProperty(i)?t=s[i]:e.error('invalid "level" parameter value: '+JSON.stringify(i))}},connector:{get:function(){return r},set:function(t){null===t||""===t||void 0===t?r=null:"function"==typeof t?r=t:e.error('invalid "connector" parameter value: '+JSON.stringify(t))}}})};return i.prototype.print=function(t,i,s,r){if("string"==typeof r){var n=[new Date,i];s&&n.push(s),r=n.concat(r).join(" | ")}t.call(e,r)},Object.keys(s).forEach(function(r){t.prototype[r]=function(e){this.logger[r](this.category,this.label,e)},i.prototype[r]=function(t,i,n){this.level>=s[r]&&(this.builtinEnabled&&this.print(e[r],t,i,n),this.connector&&this.connector(r,t,i,n))}}),i.prototype.getLogger=function(e,i){var s;return i&&3===this.level?new t(this,e,i):this.loggers[e]?this.loggers[e]:(s=new t(this,e),this.loggers[e]=s,s)},i}},function(e,t,i){"use strict";var s=i(1).EventEmitter;e.exports=function(){function e(){s.call(this)}return e.prototype=Object.create(s.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),e}},function(e,t,i){"use strict";e.exports=function(e,t){return{USER_AGENT:e+"/"+t,SIP:"sip",SIPS:"sips",causes:{CONNECTION_ERROR:"Connection Error",REQUEST_TIMEOUT:"Request Timeout",SIP_FAILURE_CODE:"SIP Failure Code",INTERNAL_ERROR:"Internal Error",BUSY:"Busy",REJECTED:"Rejected",REDIRECTED:"Redirected",UNAVAILABLE:"Unavailable",NOT_FOUND:"Not Found",ADDRESS_INCOMPLETE:"Address Incomplete",INCOMPATIBLE_SDP:"Incompatible SDP",AUTHENTICATION_ERROR:"Authentication Error",DIALOG_ERROR:"Dialog Error",WEBRTC_NOT_SUPPORTED:"WebRTC Not Supported",WEBRTC_ERROR:"WebRTC Error",CANCELED:"Canceled",NO_ANSWER:"No Answer",EXPIRES:"Expires",NO_ACK:"No ACK",NO_PRACK:"No PRACK",USER_DENIED_MEDIA_ACCESS:"User Denied Media Access",BAD_MEDIA_DESCRIPTION:"Bad Media Description",RTP_TIMEOUT:"RTP Timeout"},supported:{UNSUPPORTED:"none",SUPPORTED:"supported",REQUIRED:"required"},SIP_ERROR_CAUSES:{REDIRECTED:[300,301,302,305,380],BUSY:[486,600],REJECTED:[403,603],NOT_FOUND:[404,604],UNAVAILABLE:[480,410,408,430],ADDRESS_INCOMPLETE:[484],INCOMPATIBLE_SDP:[488,606],AUTHENTICATION_ERROR:[401,407]},ACK:"ACK",BYE:"BYE",CANCEL:"CANCEL",INFO:"INFO",INVITE:"INVITE",MESSAGE:"MESSAGE",NOTIFY:"NOTIFY",OPTIONS:"OPTIONS",REGISTER:"REGISTER",UPDATE:"UPDATE",SUBSCRIBE:"SUBSCRIBE",REFER:"REFER",PRACK:"PRACK",REASON_PHRASE:{100:"Trying",180:"Ringing",181:"Call Is Being Forwarded",182:"Queued",183:"Session Progress",199:"Early Dialog Terminated",200:"OK",202:"Accepted",204:"No Notification",300:"Multiple Choices",301:"Moved Permanently",302:"Moved Temporarily",305:"Use Proxy",380:"Alternative Service",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",410:"Gone",412:"Conditional Request Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Unsupported URI Scheme",417:"Unknown Resource-Priority",420:"Bad Extension",421:"Extension Required",422:"Session Interval Too Small",423:"Interval Too Brief",428:"Use Identity Header",429:"Provide Referrer Identity",430:"Flow Failed",433:"Anonymity Disallowed",436:"Bad Identity-Info",437:"Unsupported Certificate",438:"Invalid Identity Header",439:"First Hop Lacks Outbound Support",440:"Max-Breadth Exceeded",469:"Bad Info Package",470:"Consent Needed",478:"Unresolvable Destination",480:"Temporarily Unavailable",481:"Call/Transaction Does Not Exist",482:"Loop Detected",483:"Too Many Hops",484:"Address Incomplete",485:"Ambiguous",486:"Busy Here",487:"Request Terminated",488:"Not Acceptable Here",489:"Bad Event",491:"Request Pending",493:"Undecipherable",494:"Security Agreement Required",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Server Time-out",505:"Version Not Supported",513:"Message Too Large",580:"Precondition Failure",600:"Busy Everywhere",603:"Decline",604:"Does Not Exist Anywhere",606:"Not Acceptable"},OPTION_TAGS:{"100rel":!0,199:!0,answermode:!0,"early-session":!0,eventlist:!0,explicitsub:!0,"from-change":!0,"geolocation-http":!0,"geolocation-sip":!0,gin:!0,gruu:!0,histinfo:!0,ice:!0,join:!0,"multiple-refer":!0,norefersub:!0,nosub:!0,outbound:!0,path:!0,policy:!0,precondition:!0,pref:!0,privacy:!0,"recipient-list-invite":!0,"recipient-list-message":!0,"recipient-list-subscribe":!0,replaces:!0,"resource-priority":!0,"sdp-anat":!0,"sec-agree":!0,tdialog:!0,timer:!0,uui:!0}}}},function(e,t,i){"use strict";e.exports={ConfigurationError:function(){var e=function(e,t){this.code=1,this.name="CONFIGURATION_ERROR",this.parameter=e,this.value=t,this.message=this.value?"Invalid value "+JSON.stringify(this.value)+' for parameter "'+this.parameter+'"':"Missing parameter: "+this.parameter};return e.prototype=new Error,e}(),InvalidStateError:function(){var e=function(e){this.code=2,this.name="INVALID_STATE_ERROR",this.status=e,this.message="Invalid status: "+e};return e.prototype=new Error,e}(),NotSupportedError:function(){var e=function(e){this.code=3,this.name="NOT_SUPPORTED_ERROR",this.message=e};return e.prototype=new Error,e}(),GetDescriptionError:function(){var e=function(e){this.code=4,this.name="GET_DESCRIPTION_ERROR",this.message=e};return e.prototype=new Error,e}(),RenegotiationError:function(){var e=function(e){this.code=5,this.name="RENEGOTIATION_ERROR",this.message=e};return e.prototype=new Error,e}()}},function(e,t,i){"use strict";var s=500;e.exports=function(e){var t={T1:s,T2:4e3,T4:5e3,TIMER_B:32e3,TIMER_D:0,TIMER_F:32e3,TIMER_H:32e3,TIMER_I:0,TIMER_J:0,TIMER_K:0,TIMER_L:32e3,TIMER_M:32e3,TIMER_N:32e3,PROVISIONAL_RESPONSE_INTERVAL:6e4};return["setTimeout","clearTimeout","setInterval","clearInterval"].forEach(function(i){t[i]=function(){return e[i].apply(e,arguments)}}),t}},function(e,t,i){"use strict";e.exports=function(e){function t(e,t){var i=t,s=0,r=0;if(e.substring(i,i+2).match(/(^\r\n)/))return-2;for(;0===s;){if(-1===(r=e.indexOf("\r\n",i)))return r;!e.substring(r+2,r+4).match(/(^\r\n)/)&&e.charAt(r+2).match(/(^\s+)/)?i=r+2:s=r}return s}function i(t,i,s,r){var n,o,a,c,h=i.indexOf(":",s),u=i.substring(s,h).trim(),l=i.substring(h+1,r).trim();switch(u.toLowerCase()){case"via":case"v":t.addHeader("via",l),1===t.getHeaders("via").length?(c=t.parseHeader("Via"))&&(t.via=c,t.via_branch=c.branch):c=0;break;case"from":case"f":t.setHeader("from",l),(c=t.parseHeader("from"))&&(t.from=c,t.from_tag=c.getParam("tag"));break;case"to":case"t":t.setHeader("to",l),(c=t.parseHeader("to"))&&(t.to=c,t.to_tag=c.getParam("tag"));break;case"record-route":if(-1===(c=e.Grammar.parse(l,"Record_Route"))){c=void 0;break}for(a=c.length,o=0;o<a;o++)n=c[o],t.addHeader("record-route",l.substring(n.position,n.offset)),t.headers["Record-Route"][t.getHeaders("record-route").length-1].parsed=n.parsed;break;case"call-id":case"i":t.setHeader("call-id",l),(c=t.parseHeader("call-id"))&&(t.call_id=l);break;case"contact":case"m":if(-1===(c=e.Grammar.parse(l,"Contact"))){c=void 0;break}for(a=c.length,o=0;o<a;o++)n=c[o],t.addHeader("contact",l.substring(n.position,n.offset)),t.headers.Contact[t.getHeaders("contact").length-1].parsed=n.parsed;break;case"content-length":case"l":t.setHeader("content-length",l),c=t.parseHeader("content-length");break;case"content-type":case"c":t.setHeader("content-type",l),c=t.parseHeader("content-type");break;case"cseq":t.setHeader("cseq",l),(c=t.parseHeader("cseq"))&&(t.cseq=c.value),t instanceof e.IncomingResponse&&(t.method=c.method);break;case"max-forwards":t.setHeader("max-forwards",l),c=t.parseHeader("max-forwards");break;case"www-authenticate":t.setHeader("www-authenticate",l),c=t.parseHeader("www-authenticate");break;case"proxy-authenticate":t.setHeader("proxy-authenticate",l),c=t.parseHeader("proxy-authenticate");break;case"refer-to":case"r":t.setHeader("refer-to",l),(c=t.parseHeader("refer-to"))&&(t.refer_to=c);break;default:t.setHeader(u,l),c=0}return void 0!==c||{error:'error parsing header "'+u+'"'}}var s;(s={}).parseMessage=function(s,r){var n,o,a,c,h,u=0,l=s.indexOf("\r\n"),d=r.getLogger("sip.parser");if(-1!==l){if(o=s.substring(0,l),-1!==(h=e.Grammar.parse(o,"Request_Response"))){for(h.status_code?((n=new e.IncomingResponse(r)).status_code=h.status_code,n.reason_phrase=h.reason_phrase):((n=new e.IncomingRequest(r)).method=h.method,n.ruri=h.uri),n.data=s,u=l+2;;){if(-2===(l=t(s,u))){c=u+2;break}if(-1===l)return void d.error("malformed message");if(!0!==(h=i(n,s,u,l)))return void d.error(h.error);u=l+2}return n.hasHeader("content-length")?(a=n.getHeader("content-length"),n.body=s.substr(c,a)):n.body=s.substring(c),n}d.warn('error parsing first line of SIP message: "'+o+'"')}else d.warn("no CRLF found, not a SIP message, discarded")},e.Parser=s}},function(e,t,i){"use strict";e.exports=function(e){function t(t){var i=t.ua.configuration.hackAllowUnregisteredOptionTags,s=[],r={};return t.method===e.C.REGISTER?s.push("path","gruu"):t.method===e.C.INVITE&&(t.ua.contact.pub_gruu||t.ua.contact.temp_gruu)&&s.push("gruu"),t.ua.configuration.rel100===e.C.supported.SUPPORTED&&s.push("100rel"),t.ua.configuration.replaces===e.C.supported.SUPPORTED&&s.push("replaces"),s.push("outbound"),s=s.concat(t.ua.configuration.extraSupported),"Supported: "+(s=s.filter(function(t){var s=e.C.OPTION_TAGS[t],n=!r[t];return r[t]=!0,(s||i)&&n})).join(", ")+"\r\n"}var i,s,r,n;(i=function(t,i,s,r,n,o){var a,c,h,u,l,d;if(r=r||{},!t||!i||!s)return null;this.logger=s.getLogger("sip.sipmessage"),this.ua=s,this.headers={},this.method=t,this.ruri=i,this.body=o,this.extraHeaders=(n||[]).slice(),this.statusCode=r.status_code,this.reasonPhrase=r.reason_phrase,r.route_set?this.setHeader("route",r.route_set):s.configuration.usePreloadedRoute&&this.setHeader("route",s.transport.server.sip_uri),this.setHeader("via",""),this.setHeader("max-forwards",e.UA.C.MAX_FORWARDS),l=r.to_uri||i,a=r.to_displayName||0===r.to_displayName?'"'+r.to_displayName+'" ':"",a+="<"+(l&&l.toRaw?l.toRaw():l)+">",a+=r.to_tag?";tag="+r.to_tag:"",this.to=new e.NameAddrHeader.parse(a),this.setHeader("to",a),d=r.from_uri||s.configuration.uri,c=r.from_displayName||0===r.from_displayName?'"'+r.from_displayName+'" ':s.configuration.displayName?'"'+s.configuration.displayName+'" ':"",c+="<"+(d&&d.toRaw?d.toRaw():d)+">;tag=",c+=r.from_tag||e.Utils.newTag(),this.from=new e.NameAddrHeader.parse(c),this.setHeader("from",c),h=r.call_id||s.configuration.sipjsId+e.Utils.createRandomToken(15),this.call_id=h,this.setHeader("call-id",h),u=r.cseq||Math.floor(1e4*Math.random()),this.cseq=u,this.setHeader("cseq",u+" "+t)}).prototype={setHeader:function(t,i){this.headers[e.Utils.headerize(t)]=i instanceof Array?i:[i]},getHeader:function(t){var i,s,r=this.extraHeaders.length,n=this.headers[e.Utils.headerize(t)];if(n){if(n[0])return n[0]}else for(i=new RegExp("^\\s*"+t+"\\s*:","i"),s=0;s<r;s++)if(n=this.extraHeaders[s],i.test(n))return n.substring(n.indexOf(":")+1).trim()},getHeaders:function(t){var i,s,r,n=this.headers[e.Utils.headerize(t)],o=[];if(n){for(s=n.length,i=0;i<s;i++)o.push(n[i]);return o}for(s=this.extraHeaders.length,r=new RegExp("^\\s*"+t+"\\s*:","i"),i=0;i<s;i++)n=this.extraHeaders[i],r.test(n)&&o.push(n.substring(n.indexOf(":")+1).trim());return o},hasHeader:function(t){var i,s,r=this.extraHeaders.length;if(this.headers[e.Utils.headerize(t)])return!0;for(i=new RegExp("^\\s*"+t+"\\s*:","i"),s=0;s<r;s++)if(i.test(this.extraHeaders[s]))return!0;return!1},toString:function(){var i,s,r,n="";n+=this.method+" "+(this.ruri.toRaw?this.ruri.toRaw():this.ruri)+" SIP/2.0\r\n";for(i in this.headers)for(s=this.headers[i].length,r=0;r<s;r++)n+=i+": "+this.headers[i][r]+"\r\n";for(s=this.extraHeaders.length,r=0;r<s;r++)n+=this.extraHeaders[r].trim()+"\r\n";return n+=t(this),n+="User-Agent: "+this.ua.configuration.userAgentString+"\r\n",this.body?"string"==typeof this.body?(n+="Content-Length: "+(s=e.Utils.str_utf8_length(this.body))+"\r\n\r\n",n+=this.body):this.body.body&&this.body.contentType?(s=e.Utils.str_utf8_length(this.body.body),n+="Content-Type: "+this.body.contentType+"\r\n",n+="Content-Length: "+s+"\r\n\r\n",n+=this.body.body):n+="Content-Length: 0\r\n\r\n":n+="Content-Length: 0\r\n\r\n",n}},(s=function(){this.data=null,this.headers=null,this.method=null,this.via=null,this.via_branch=null,this.call_id=null,this.cseq=null,this.from=null,this.from_tag=null,this.to=null,this.to_tag=null,this.body=null}).prototype={addHeader:function(t,i){var s={raw:i};t=e.Utils.headerize(t),this.headers[t]?this.headers[t].push(s):this.headers[t]=[s]},getHeader:function(t){var i=this.headers[e.Utils.headerize(t)];if(i)return i[0]?i[0].raw:void 0},getHeaders:function(t){var i,s,r=this.headers[e.Utils.headerize(t)],n=[];if(!r)return[];for(s=r.length,i=0;i<s;i++)n.push(r[i].raw);return n},hasHeader:function(t){return!!this.headers[e.Utils.headerize(t)]},parseHeader:function(t,i){var s,r,n;if(t=e.Utils.headerize(t),i=i||0,this.headers[t]){if(!(i>=this.headers[t].length))return s=this.headers[t][i],r=s.raw,s.parsed?s.parsed:-1===(n=e.Grammar.parse(r,t.replace(/-/g,"_")))?(this.headers[t].splice(i,1),void this.logger.warn('error parsing "'+t+'" header field with value "'+r+'"')):(s.parsed=n,n);this.logger.log('not so many "'+t+'" headers present')}else this.logger.log('header "'+t+'" not present')},s:function(e,t){return this.parseHeader(e,t)},setHeader:function(t,i){var s={raw:i};this.headers[e.Utils.headerize(t)]=[s]},toString:function(){return this.data}},((r=function(e){this.logger=e.getLogger("sip.sipmessage"),this.ua=e,this.headers={},this.ruri=null,this.transport=null,this.server_transaction=null}).prototype=new s).reply=function(i,s,r,n,o,a){var c,h,u,l,d,p=this.getHeader("To"),f=0,g=0;if(d=e.Utils.buildStatusLine(i,s),r=(r||[]).slice(),this.method===e.C.INVITE&&i>100&&i<=200)for(u=(c=this.getHeaders("record-route")).length,f;f<u;f++)d+="Record-Route: "+c[f]+"\r\n";for(u=(h=this.getHeaders("via")).length,g;g<u;g++)d+="Via: "+h[g]+"\r\n";for(!this.to_tag&&i>100?p+=";tag="+e.Utils.newTag():this.to_tag&&!this.s("to").hasParam("tag")&&(p+=";tag="+this.to_tag),d+="To: "+p+"\r\n",d+="From: "+this.getHeader("From")+"\r\n",d+="Call-ID: "+this.call_id+"\r\n",d+="CSeq: "+this.cseq+" "+this.method+"\r\n",u=r.length,l=0;l<u;l++)d+=r[l].trim()+"\r\n";return d+=t(this),d+="User-Agent: "+this.ua.configuration.userAgentString+"\r\n",n?"string"==typeof n?(d+="Content-Type: application/sdp\r\n",d+="Content-Length: "+(u=e.Utils.str_utf8_length(n))+"\r\n\r\n",d+=n):n.body&&n.contentType?(u=e.Utils.str_utf8_length(n.body),d+="Content-Type: "+n.contentType+"\r\n",d+="Content-Length: "+u+"\r\n\r\n",d+=n.body):d+="Content-Length: 0\r\n\r\n":d+="Content-Length: 0\r\n\r\n",this.server_transaction.receiveResponse(i,d).then(o,a),d},r.prototype.reply_sl=function(t,i){var s,r,n=0,o=this.getHeaders("via"),a=o.length;for(r=e.Utils.buildStatusLine(t,i),n;n<a;n++)r+="Via: "+o[n]+"\r\n";s=this.getHeader("To"),!this.to_tag&&t>100?s+=";tag="+e.Utils.newTag():this.to_tag&&!this.s("to").hasParam("tag")&&(s+=";tag="+this.to_tag),r+="To: "+s+"\r\n",r+="From: "+this.getHeader("From")+"\r\n",r+="Call-ID: "+this.call_id+"\r\n",r+="CSeq: "+this.cseq+" "+this.method+"\r\n",r+="User-Agent: "+this.ua.configuration.userAgentString+"\r\n",r+="Content-Length: 0\r\n\r\n",this.transport.send(r)},(n=function(e){this.logger=e.getLogger("sip.sipmessage"),this.headers={},this.status_code=null,this.reason_phrase=null}).prototype=new s,e.OutgoingRequest=i,e.IncomingRequest=r,e.IncomingResponse=n}},function(e,t,i){"use strict";e.exports=function(e){var t;(t=function(t,i,s,r,n,o){var a,c,h,u;if(!s)throw new TypeError('missing or invalid "host" parameter');t=t||e.C.SIP,this.parameters={},this.headers={};for(a in n)this.setParam(a,n[a]);for(c in o)this.setHeader(c,o[c]);h={scheme:t,user:i,host:s,port:r},u={scheme:t.toLowerCase(),user:i,host:s.toLowerCase(),port:r},Object.defineProperties(this,{_normal:{get:function(){return u}},_raw:{get:function(){return h}},scheme:{get:function(){return u.scheme},set:function(e){h.scheme=e,u.scheme=e.toLowerCase()}},user:{get:function(){return u.user},set:function(e){u.user=h.user=e}},host:{get:function(){return u.host},set:function(e){h.host=e,u.host=e.toLowerCase()}},aor:{get:function(){return u.user+"@"+u.host}},port:{get:function(){return u.port},set:function(e){u.port=h.port=0===e?e:parseInt(e,10)||null}}})}).prototype={setParam:function(e,t){e&&(this.parameters[e.toLowerCase()]=void 0===t||null===t?null:t.toString().toLowerCase())},getParam:function(e){if(e)return this.parameters[e.toLowerCase()]},hasParam:function(e){if(e)return this.parameters.hasOwnProperty(e.toLowerCase())&&!0||!1},deleteParam:function(e){var t;if(e=e.toLowerCase(),this.parameters.hasOwnProperty(e))return t=this.parameters[e],delete this.parameters[e],t},clearParams:function(){this.parameters={}},setHeader:function(t,i){this.headers[e.Utils.headerize(t)]=i instanceof Array?i:[i]},getHeader:function(t){if(t)return this.headers[e.Utils.headerize(t)]},hasHeader:function(t){if(t)return this.headers.hasOwnProperty(e.Utils.headerize(t))&&!0||!1},deleteHeader:function(t){var i;if(t=e.Utils.headerize(t),this.headers.hasOwnProperty(t))return i=this.headers[t],delete this.headers[t],i},clearHeaders:function(){this.headers={}},clone:function(){return new t(this._raw.scheme,this._raw.user,this._raw.host,this._raw.port,JSON.parse(JSON.stringify(this.parameters)),JSON.parse(JSON.stringify(this.headers)))},toRaw:function(){return this._toString(this._raw)},toString:function(){return this._toString(this._normal)},_toString:function(t){var i,s,r,n,o=[];n=t.scheme+":",t.scheme.toLowerCase().match("^sips?$")||(n+="//"),t.user&&(n+=e.Utils.escapeUser(t.user)+"@"),n+=t.host,(t.port||0===t.port)&&(n+=":"+t.port);for(s in this.parameters)n+=";"+s,null!==this.parameters[s]&&(n+="="+this.parameters[s]);for(i in this.headers)for(r in this.headers[i])o.push(i+"="+this.headers[i][r]);return o.length>0&&(n+="?"+o.join("&")),n}},t.parse=function(t){return-1!==(t=e.Grammar.parse(t,"SIP_URI"))?t:void 0},e.URI=t}},function(e,t,i){"use strict";e.exports=function(e){var t;(t=function(t,i,s){var r;if(!(t&&t instanceof e.URI))throw new TypeError('missing or invalid "uri" parameter');this.uri=t,this.parameters={};for(r in s)this.setParam(r,s[r]);Object.defineProperties(this,{friendlyName:{get:function(){return this.displayName||t.aor}},displayName:{get:function(){return i},set:function(e){i=0===e?"0":e}}})}).prototype={setParam:function(e,t){e&&(this.parameters[e.toLowerCase()]=void 0===t||null===t?null:t.toString())},getParam:e.URI.prototype.getParam,hasParam:e.URI.prototype.hasParam,deleteParam:e.URI.prototype.deleteParam,clearParams:e.URI.prototype.clearParams,clone:function(){return new t(this.uri.clone(),this.displayName,JSON.parse(JSON.stringify(this.parameters)))},toString:function(){var e,t;e=this.displayName||0===this.displayName?'"'+this.displayName+'" ':"",e+="<"+this.uri.toString()+">";for(t in this.parameters)e+=";"+t,null!==this.parameters[t]&&(e+="="+this.parameters[t]);return e}},t.parse=function(t){return-1!==(t=e.Grammar.parse(t,"Name_Addr_Header"))?t:void 0},e.NameAddrHeader=t}},function(e,t,i){"use strict";e.exports=function(e){function t(e,t,i){var s;return s="SIP/2.0/"+(e.ua.configuration.hackViaTcp?"TCP":t.server.scheme),s+=" "+e.ua.configuration.viaHost+";branch="+i,e.ua.configuration.forceRport&&(s+=";rport"),s}var i={STATUS_TRYING:1,STATUS_PROCEEDING:2,STATUS_CALLING:3,STATUS_ACCEPTED:4,STATUS_COMPLETED:5,STATUS_TERMINATED:6,STATUS_CONFIRMED:7,NON_INVITE_CLIENT:"nict",NON_INVITE_SERVER:"nist",INVITE_CLIENT:"ict",INVITE_SERVER:"ist"},s=function(e,s,r){var n;this.type=i.NON_INVITE_CLIENT,this.transport=r,this.id="z9hG4bK"+Math.floor(1e7*Math.random()),this.request_sender=e,this.request=s,this.logger=e.ua.getLogger("sip.transaction.nict",this.id),n=t(e,r,this.id),this.request.setHeader("via",n),this.request_sender.ua.newTransaction(this)};(s.prototype=Object.create(e.EventEmitter.prototype)).stateChanged=function(e){this.state=e,this.emit("stateChanged")},s.prototype.send=function(){var t=this;this.stateChanged(i.STATUS_TRYING),this.F=e.Timers.setTimeout(t.timer_F.bind(t),e.Timers.TIMER_F),this.transport.send(this.request)||this.onTransportError()},s.prototype.onTransportError=function(){this.logger.log("transport error occurred, deleting non-INVITE client transaction "+this.id),e.Timers.clearTimeout(this.F),e.Timers.clearTimeout(this.K),this.stateChanged(i.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this),this.request_sender.onTransportError()},s.prototype.timer_F=function(){this.logger.log("Timer F expired for non-INVITE client transaction "+this.id),this.stateChanged(i.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this),this.request_sender.onRequestTimeout()},s.prototype.timer_K=function(){this.stateChanged(i.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this)},s.prototype.receiveResponse=function(t){var s=this,r=t.status_code;if(r<200)switch(this.state){case i.STATUS_TRYING:case i.STATUS_PROCEEDING:this.stateChanged(i.STATUS_PROCEEDING),this.request_sender.receiveResponse(t)}else switch(this.state){case i.STATUS_TRYING:case i.STATUS_PROCEEDING:this.stateChanged(i.STATUS_COMPLETED),e.Timers.clearTimeout(this.F),408===r?this.request_sender.onRequestTimeout():this.request_sender.receiveResponse(t),this.K=e.Timers.setTimeout(s.timer_K.bind(s),e.Timers.TIMER_K)}};var r=function(e,s,r){var n,o=this;this.type=i.INVITE_CLIENT,this.transport=r,this.id="z9hG4bK"+Math.floor(1e7*Math.random()),this.request_sender=e,this.request=s,this.logger=e.ua.getLogger("sip.transaction.ict",this.id),n=t(e,r,this.id),this.request.setHeader("via",n),this.request_sender.ua.newTransaction(this),this.request.cancel=function(e,t){for(var i=(t=(t||[]).slice()).length,s=null,r=0;r<i;r++)s=(s||"")+t[r].trim()+"\r\n";o.cancel_request(o,e,s)}};(r.prototype=Object.create(e.EventEmitter.prototype)).stateChanged=function(e){this.state=e,this.emit("stateChanged")},r.prototype.send=function(){var t=this;this.stateChanged(i.STATUS_CALLING),this.B=e.Timers.setTimeout(t.timer_B.bind(t),e.Timers.TIMER_B),this.transport.send(this.request)||this.onTransportError()},r.prototype.onTransportError=function(){this.logger.log("transport error occurred, deleting INVITE client transaction "+this.id),e.Timers.clearTimeout(this.B),e.Timers.clearTimeout(this.D),e.Timers.clearTimeout(this.M),this.stateChanged(i.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this),this.state!==i.STATUS_ACCEPTED&&this.request_sender.onTransportError()},r.prototype.timer_M=function(){this.logger.log("Timer M expired for INVITE client transaction "+this.id),this.state===i.STATUS_ACCEPTED&&(e.Timers.clearTimeout(this.B),this.stateChanged(i.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this))},r.prototype.timer_B=function(){this.logger.log("Timer B expired for INVITE client transaction "+this.id),this.state===i.STATUS_CALLING&&(this.stateChanged(i.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this),this.request_sender.onRequestTimeout())},r.prototype.timer_D=function(){this.logger.log("Timer D expired for INVITE client transaction "+this.id),e.Timers.clearTimeout(this.B),this.stateChanged(i.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this)},r.prototype.sendACK=function(t){var i,s=this;t=t||{},i=this.response.getHeader("contact")?this.response.getHeader("contact").replace(/</g,"").replace(/>/g,""):this.request.ruri;var r=new e.OutgoingRequest("ACK",i,this.request.ua,{cseq:this.response.cseq,call_id:this.response.call_id,from_uri:this.response.from.uri,from_tag:this.response.from_tag,to_uri:this.response.to.uri,to_tag:this.response.to_tag,route_set:this.response.getHeaders("record-route").reverse()},t.extraHeaders||[],t.body);return this.ackSender=new e.RequestSender({request:r,onRequestTimeout:this.request_sender.applicant.applicant?this.request_sender.applicant.applicant.onRequestTimeout:function(){s.logger.warn("ACK Request timed out")},onTransportError:this.request_sender.applicant.applicant?this.request_sender.applicant.applicant.onRequestTransportError:function(){s.loigger.warn("ACK Request had a transport error")},receiveResponse:t.receiveResponse||function(){s.logger.warn("Received a response to an ACK which was unexpected. Dropping Response.")}},this.request.ua).send(),r},r.prototype.cancel_request=function(t,s,r){var n=t.request;this.cancel=e.C.CANCEL+" "+n.ruri+" SIP/2.0\r\n",this.cancel+="Via: "+n.headers.Via.toString()+"\r\n",this.request.headers.Route&&(this.cancel+="Route: "+n.headers.Route.toString()+"\r\n"),this.cancel+="To: "+n.headers.To.toString()+"\r\n",this.cancel+="From: "+n.headers.From.toString()+"\r\n",this.cancel+="Call-ID: "+n.headers["Call-ID"].toString()+"\r\n",this.cancel+="CSeq: "+n.headers.CSeq.toString().split(" ")[0]+" CANCEL\r\n",s&&(this.cancel+="Reason: "+s+"\r\n"),r&&(this.cancel+=r),this.cancel+="Content-Length: 0\r\n\r\n",this.state===i.STATUS_PROCEEDING&&this.transport.send(this.cancel)},r.prototype.receiveResponse=function(t){var s=this,r=t.status_code;if(t.transaction=this,this.response&&this.response.status_code===t.status_code&&this.response.cseq===t.cseq)return this.logger.debug("ICT Received a retransmission for cseq: "+t.cseq),void(this.ackSender&&this.ackSender.send());if(this.response=t,r>=100&&r<=199)switch(this.state){case i.STATUS_CALLING:this.stateChanged(i.STATUS_PROCEEDING),this.request_sender.receiveResponse(t),this.cancel&&this.transport.send(this.cancel);break;case i.STATUS_PROCEEDING:this.request_sender.receiveResponse(t)}else if(r>=200&&r<=299)switch(this.state){case i.STATUS_CALLING:case i.STATUS_PROCEEDING:this.stateChanged(i.STATUS_ACCEPTED),this.M=e.Timers.setTimeout(s.timer_M.bind(s),e.Timers.TIMER_M),this.request_sender.receiveResponse(t);break;case i.STATUS_ACCEPTED:this.request_sender.receiveResponse(t)}else if(r>=300&&r<=699)switch(this.state){case i.STATUS_CALLING:case i.STATUS_PROCEEDING:this.stateChanged(i.STATUS_COMPLETED),this.sendACK(),this.request_sender.receiveResponse(t);break;case i.STATUS_COMPLETED:this.sendACK()}};var n=function(e,i,s){var r;this.transport=s,this.id="z9hG4bK"+Math.floor(1e7*Math.random()),this.request_sender=e,this.request=i,this.logger=e.ua.getLogger("sip.transaction.nict",this.id),r=t(e,s,this.id),this.request.setHeader("via",r)};(n.prototype=Object.create(e.EventEmitter.prototype)).send=function(){this.transport.send(this.request)||this.onTransportError()},n.prototype.onTransportError=function(){this.logger.log("transport error occurred, for an ACK client transaction "+this.id),this.request_sender.onTransportError()};var o=function(e,t){this.type=i.NON_INVITE_SERVER,this.id=e.via_branch,this.request=e,this.transport=e.transport,this.ua=t,this.last_response="",e.server_transaction=this,this.logger=t.getLogger("sip.transaction.nist",this.id),this.state=i.STATUS_TRYING,t.newTransaction(this)};(o.prototype=Object.create(e.EventEmitter.prototype)).stateChanged=function(e){this.state=e,this.emit("stateChanged")},o.prototype.timer_J=function(){this.logger.log("Timer J expired for non-INVITE server transaction "+this.id),this.stateChanged(i.STATUS_TERMINATED),this.ua.destroyTransaction(this)},o.prototype.onTransportError=function(){this.transportError||(this.transportError=!0,this.logger.log("transport error occurred, deleting non-INVITE server transaction "+this.id),e.Timers.clearTimeout(this.J),this.stateChanged(i.STATUS_TERMINATED),this.ua.destroyTransaction(this))},o.prototype.receiveResponse=function(t,s){var r=this,n=e.Utils.defer();if(100===t)switch(this.state){case i.STATUS_TRYING:this.stateChanged(i.STATUS_PROCEEDING),this.transport.send(s)||this.onTransportError();break;case i.STATUS_PROCEEDING:this.last_response=s,this.transport.send(s)?n.resolve():(this.onTransportError(),n.reject())}else if(t>=200&&t<=699)switch(this.state){case i.STATUS_TRYING:case i.STATUS_PROCEEDING:this.stateChanged(i.STATUS_COMPLETED),this.last_response=s,this.J=e.Timers.setTimeout(r.timer_J.bind(r),e.Timers.TIMER_J),this.transport.send(s)?n.resolve():(this.onTransportError(),n.reject())}return n.promise};var a=function(e,t){this.type=i.INVITE_SERVER,this.id=e.via_branch,this.request=e,this.transport=e.transport,this.ua=t,this.last_response="",e.server_transaction=this,this.logger=t.getLogger("sip.transaction.ist",this.id),this.state=i.STATUS_PROCEEDING,t.newTransaction(this),this.resendProvisionalTimer=null,e.reply(100)};(a.prototype=Object.create(e.EventEmitter.prototype)).stateChanged=function(e){this.state=e,this.emit("stateChanged")},a.prototype.timer_H=function(){this.logger.log("Timer H expired for INVITE server transaction "+this.id),this.state===i.STATUS_COMPLETED&&this.logger.warn("transactions","ACK for INVITE server transaction was never received, call will be terminated"),this.stateChanged(i.STATUS_TERMINATED),this.ua.destroyTransaction(this)},a.prototype.timer_I=function(){this.stateChanged(i.STATUS_TERMINATED),this.ua.destroyTransaction(this)},a.prototype.timer_L=function(){this.logger.log("Timer L expired for INVITE server transaction "+this.id),this.state===i.STATUS_ACCEPTED&&(this.stateChanged(i.STATUS_TERMINATED),this.ua.destroyTransaction(this))},a.prototype.onTransportError=function(){this.transportError||(this.transportError=!0,this.logger.log("transport error occurred, deleting INVITE server transaction "+this.id),null!==this.resendProvisionalTimer&&(e.Timers.clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null),e.Timers.clearTimeout(this.L),e.Timers.clearTimeout(this.H),e.Timers.clearTimeout(this.I),this.stateChanged(i.STATUS_TERMINATED),this.ua.destroyTransaction(this))},a.prototype.resend_provisional=function(){this.transport.send(this.last_response)||this.onTransportError()},a.prototype.receiveResponse=function(t,s){var r=this,n=e.Utils.defer();if(t>=100&&t<=199)switch(this.state){case i.STATUS_PROCEEDING:this.transport.send(s)||this.onTransportError(),this.last_response=s}if(t>100&&t<=199&&this.state===i.STATUS_PROCEEDING)null===this.resendProvisionalTimer&&(this.resendProvisionalTimer=e.Timers.setInterval(r.resend_provisional.bind(r),e.Timers.PROVISIONAL_RESPONSE_INTERVAL));else if(t>=200&&t<=299)switch(this.state){case i.STATUS_PROCEEDING:this.stateChanged(i.STATUS_ACCEPTED),this.last_response=s,this.L=e.Timers.setTimeout(r.timer_L.bind(r),e.Timers.TIMER_L),null!==this.resendProvisionalTimer&&(e.Timers.clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null);case i.STATUS_ACCEPTED:this.transport.send(s)?n.resolve():(this.onTransportError(),n.reject())}else if(t>=300&&t<=699)switch(this.state){case i.STATUS_PROCEEDING:null!==this.resendProvisionalTimer&&(e.Timers.clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null),this.transport.send(s)?(this.stateChanged(i.STATUS_COMPLETED),this.H=e.Timers.setTimeout(r.timer_H.bind(r),e.Timers.TIMER_H),n.resolve()):(this.onTransportError(),n.reject())}return n.promise};e.Transactions={C:i,checkTransaction:function(t,s){var r;switch(s.method){case e.C.INVITE:if(r=t.transactions.ist[s.via_branch]){switch(r.state){case i.STATUS_PROCEEDING:r.transport.send(r.last_response)}return!0}break;case e.C.ACK:if(!(r=t.transactions.ist[s.via_branch]))return!1;if(r.state===i.STATUS_ACCEPTED)return!1;if(r.state===i.STATUS_COMPLETED)return r.stateChanged(i.STATUS_CONFIRMED),r.I=e.Timers.setTimeout(r.timer_I.bind(r),e.Timers.TIMER_I),!0;break;case e.C.CANCEL:return(r=t.transactions.ist[s.via_branch])?(s.reply_sl(200),r.state!==i.STATUS_PROCEEDING):(s.reply_sl(481),!0);default:if(r=t.transactions.nist[s.via_branch]){switch(r.state){case i.STATUS_TRYING:break;case i.STATUS_PROCEEDING:case i.STATUS_COMPLETED:r.transport.send(r.last_response)}return!0}}},NonInviteClientTransaction:s,InviteClientTransaction:r,AckClientTransaction:n,NonInviteServerTransaction:o,InviteServerTransaction:a}}},function(e,t,i){"use strict";e.exports=function(e){var t,s=i(28)(e),r={STATUS_EARLY:1,STATUS_CONFIRMED:2};(t=function(t,i,s,n){var o;if(this.uac_pending_reply=!1,this.uas_pending_reply=!1,!i.hasHeader("contact"))return{error:"unable to create a Dialog without Contact header field"};n=i instanceof e.IncomingResponse?i.status_code<200?r.STATUS_EARLY:r.STATUS_CONFIRMED:n||r.STATUS_CONFIRMED,o=i.parseHeader("contact"),"UAS"===s?(this.id={call_id:i.call_id,local_tag:i.to_tag,remote_tag:i.from_tag,toString:function(){return this.call_id+this.local_tag+this.remote_tag}},this.state=n,this.remote_seqnum=i.cseq,this.local_uri=i.parseHeader("to").uri,this.remote_uri=i.parseHeader("from").uri,this.remote_target=o.uri,this.route_set=i.getHeaders("record-route"),this.invite_seqnum=i.cseq,this.local_seqnum=i.cseq):"UAC"===s&&(this.id={call_id:i.call_id,local_tag:i.from_tag,remote_tag:i.to_tag,toString:function(){return this.call_id+this.local_tag+this.remote_tag}},this.state=n,this.invite_seqnum=i.cseq,this.local_seqnum=i.cseq,this.local_uri=i.parseHeader("from").uri,this.pracked=[],this.remote_uri=i.parseHeader("to").uri,this.remote_target=o.uri,this.route_set=i.getHeaders("record-route").reverse()),this.logger=t.ua.getLogger("sip.dialog",this.id.toString()),this.owner=t,t.ua.dialogs[this.id.toString()]=this,this.logger.log("new "+s+" dialog created with status "+(this.state===r.STATUS_EARLY?"EARLY":"CONFIRMED")),t.emit("dialog",this)}).prototype={update:function(e,t){this.state=r.STATUS_CONFIRMED,this.logger.log("dialog "+this.id.toString()+"  changed to CONFIRMED state"),"UAC"===t&&(this.route_set=e.getHeaders("record-route").reverse())},terminate:function(){this.logger.log("dialog "+this.id.toString()+" deleted"),this.sessionDescriptionHandler&&this.state!==r.STATUS_CONFIRMED&&this.sessionDescriptionHandler.close(),delete this.owner.ua.dialogs[this.id.toString()]},createRequest:function(t,i,s){var r,n;return i=(i||[]).slice(),this.local_seqnum||(this.local_seqnum=Math.floor(1e4*Math.random())),r=t===e.C.CANCEL||t===e.C.ACK?this.invite_seqnum:this.local_seqnum+=1,n=new e.OutgoingRequest(t,this.remote_target,this.owner.ua,{cseq:r,call_id:this.id.call_id,from_uri:this.local_uri,from_tag:this.id.local_tag,to_uri:this.remote_uri,to_tag:this.id.remote_tag,route_set:this.route_set},i,s),n.dialog=this,n},checkInDialogRequest:function(t){var i=this;if(this.remote_seqnum){if(t.cseq<this.remote_seqnum)return t.method!==e.C.ACK&&t.reply(500),t.cseq===this.invite_seqnum}else this.remote_seqnum=t.cseq;switch(t.method){case e.C.INVITE:if(!0===this.uac_pending_reply)t.reply(491);else{if(!0===this.uas_pending_reply&&t.cseq>this.remote_seqnum){var s=1+(10*Math.random()|0);return t.reply(500,null,["Retry-After:"+s]),this.remote_seqnum=t.cseq,!1}this.uas_pending_reply=!0,t.server_transaction.on("stateChanged",function t(){this.state!==e.Transactions.C.STATUS_ACCEPTED&&this.state!==e.Transactions.C.STATUS_COMPLETED&&this.state!==e.Transactions.C.STATUS_TERMINATED||(this.removeListener("stateChanged",t),i.uas_pending_reply=!1)})}t.hasHeader("contact")&&t.server_transaction.on("stateChanged",function(){this.state===e.Transactions.C.STATUS_ACCEPTED&&(i.remote_target=t.parseHeader("contact").uri)});break;case e.C.NOTIFY:t.hasHeader("contact")&&t.server_transaction.on("stateChanged",function(){this.state===e.Transactions.C.STATUS_COMPLETED&&(i.remote_target=t.parseHeader("contact").uri)})}return t.cseq>this.remote_seqnum&&(this.remote_seqnum=t.cseq),!0},sendRequest:function(e,t,i){var r=((i=i||{}).extraHeaders||[]).slice(),n=null;i.body&&(i.body.body?n=i.body:((n={}).body=i.body,i.contentType&&(n.contentType=i.contentType)));var o=this.createRequest(t,r,n);return new s(this,e,o).send(),o},receiveRequest:function(e){this.checkInDialogRequest(e)&&this.owner.receiveRequest(e)}},t.C=r,e.Dialog=t}},function(e,t,i){"use strict";e.exports=function(e){var t;return t=function(e,t,i){this.dialog=e,this.applicant=t,this.request=i,this.reattempt=!1,this.reattemptTimer=null},t.prototype={send:function(){var t=this,i=new e.RequestSender(this,this.dialog.owner.ua);i.send(),this.request.method===e.C.INVITE&&i.clientTransaction.state!==e.Transactions.C.STATUS_TERMINATED&&(this.dialog.uac_pending_reply=!0,i.clientTransaction.on("stateChanged",function i(){this.state!==e.Transactions.C.STATUS_ACCEPTED&&this.state!==e.Transactions.C.STATUS_COMPLETED&&this.state!==e.Transactions.C.STATUS_TERMINATED||(this.removeListener("stateChanged",i),t.dialog.uac_pending_reply=!1)}))},onRequestTimeout:function(){this.applicant.onRequestTimeout()},onTransportError:function(){this.applicant.onTransportError()},receiveResponse:function(t){var i=this;408===t.status_code||481===t.status_code?this.applicant.onDialogError(t):t.method===e.C.INVITE&&491===t.status_code?this.reattempt?this.applicant.receiveResponse(t):(this.request.cseq.value=this.dialog.local_seqnum+=1,this.reattemptTimer=e.Timers.setTimeout(function(){i.applicant.owner.status!==e.Session.C.STATUS_TERMINATED&&(i.reattempt=!0,i.request_sender.send())},this.getReattemptTimeout())):this.applicant.receiveResponse(t)}},t}},function(e,t,i){"use strict";e.exports=function(e){var t;(t=function(t,i){this.logger=i.getLogger("sip.requestsender"),this.ua=i,this.applicant=t,this.method=t.request.method,this.request=t.request,this.credentials=null,this.challenged=!1,this.staled=!1,i.status!==e.UA.C.STATUS_USER_CLOSED||this.method===e.C.BYE&&this.method===e.C.ACK||this.onTransportError()}).prototype={send:function(){switch(this.method){case"INVITE":this.clientTransaction=new e.Transactions.InviteClientTransaction(this,this.request,this.ua.transport);break;case"ACK":this.clientTransaction=new e.Transactions.AckClientTransaction(this,this.request,this.ua.transport);break;default:this.clientTransaction=new e.Transactions.NonInviteClientTransaction(this,this.request,this.ua.transport)}return this.clientTransaction.send(),this.clientTransaction},onRequestTimeout:function(){this.applicant.onRequestTimeout()},onTransportError:function(){this.applicant.onTransportError()},receiveResponse:function(t){var i,s,r,n=t.status_code;if(401===n||407===n){if(401===t.status_code?(s=t.parseHeader("www-authenticate"),r="authorization"):(s=t.parseHeader("proxy-authenticate"),r="proxy-authorization"),!s)return this.logger.warn(t.status_code+" with wrong or missing challenge, cannot authenticate"),void this.applicant.receiveResponse(t);if(!this.challenged||!this.staled&&!0===s.stale){if(this.credentials||(this.credentials=this.ua.configuration.authenticationFactory(this.ua)),!this.credentials.authenticate(this.request,s))return void this.applicant.receiveResponse(t);this.challenged=!0,s.stale&&(this.staled=!0),t.method===e.C.REGISTER?i=this.applicant.cseq+=1:this.request.dialog?i=this.request.dialog.local_seqnum+=1:(i=this.request.cseq+1,this.request.cseq=i),this.request.setHeader("cseq",i+" "+this.method),this.request.setHeader(r,this.credentials.toString()),this.send()}else this.applicant.receiveResponse(t)}else this.applicant.receiveResponse(t)}},e.RequestSender=t}},function(e,t,i){"use strict";e.exports=function(e){var t;(t=function(t){var i={};this.registrar=t.configuration.registrarServer,this.expires=t.configuration.registerExpires,this.contact=t.contact.toString(),this.contact+=";reg-id=1",this.contact+=';+sip.instance="<urn:uuid:'+t.configuration.instanceId+'>"',this.call_id=e.Utils.createRandomToken(22),this.cseq=Math.floor(1e4*Math.random()),this.to_uri=t.configuration.uri,i.to_uri=this.to_uri,i.to_displayName=t.configuration.displayName,i.call_id=this.call_id,i.cseq=this.cseq,e.Utils.augment(this,e.ClientContext,[t,"REGISTER",this.registrar,{params:i}]),this.registrationTimer=null,this.registrationExpiredTimer=null,this.registered=!1,this.logger=t.getLogger("sip.registercontext")}).prototype={register:function(t){var i,s=this;this.options=t||{},(i=(this.options.extraHeaders||[]).slice()).push("Contact: "+this.contact+";expires="+this.expires),i.push("Allow: "+e.UA.C.ALLOWED_METHODS.toString()),this.closeHeaders=this.options.closeWithHeaders?(this.options.extraHeaders||[]).slice():[],this.receiveResponse=function(t){var i,r,n,o=t.getHeaders("contact").length;if(t.cseq===this.cseq)switch(null!==this.registrationTimer&&(e.Timers.clearTimeout(this.registrationTimer),this.registrationTimer=null),!0){case/^1[0-9]{2}$/.test(t.status_code):this.emit("progress",t);break;case/^2[0-9]{2}$/.test(t.status_code):if(this.emit("accepted",t),t.hasHeader("expires")&&(r=t.getHeader("expires")),null!==this.registrationExpiredTimer&&(e.Timers.clearTimeout(this.registrationExpiredTimer),this.registrationExpiredTimer=null),!o){this.logger.warn("no Contact header in response to REGISTER, response ignored");break}for(;o--;){if((i=t.parseHeader("contact",o)).uri.user===this.ua.contact.uri.user){r=i.getParam("expires");break}i=null}if(!i){this.logger.warn("no Contact header pointing to us, response ignored");break}r||(r=this.expires),this.registrationTimer=e.Timers.setTimeout(function(){s.registrationTimer=null,s.register(s.options)},1e3*r-3e3),this.registrationExpiredTimer=e.Timers.setTimeout(function(){s.logger.warn("registration expired"),s.registered&&s.unregistered(null,e.C.causes.EXPIRES)},1e3*r),i.hasParam("temp-gruu")&&(this.ua.contact.temp_gruu=e.URI.parse(i.getParam("temp-gruu").replace(/"/g,""))),i.hasParam("pub-gruu")&&(this.ua.contact.pub_gruu=e.URI.parse(i.getParam("pub-gruu").replace(/"/g,""))),this.registered=!0,this.emit("registered",t||null);break;case/^423$/.test(t.status_code):t.hasHeader("min-expires")?(this.expires=t.getHeader("min-expires"),this.register(this.options)):(this.logger.warn("423 response received for REGISTER without Min-Expires"),this.registrationFailure(t,e.C.causes.SIP_FAILURE_CODE));break;default:n=e.Utils.sipErrorCause(t.status_code),this.registrationFailure(t,n)}},this.onRequestTimeout=function(){this.registrationFailure(null,e.C.causes.REQUEST_TIMEOUT)},this.onTransportError=function(){this.registrationFailure(null,e.C.causes.CONNECTION_ERROR)},this.cseq++,this.request.cseq=this.cseq,this.request.setHeader("cseq",this.cseq+" REGISTER"),this.request.extraHeaders=i,this.send()},registrationFailure:function(e,t){this.emit("failed",e||null,t||null)},onTransportClosed:function(){this.registered_before=this.registered,null!==this.registrationTimer&&(e.Timers.clearTimeout(this.registrationTimer),this.registrationTimer=null),null!==this.registrationExpiredTimer&&(e.Timers.clearTimeout(this.registrationExpiredTimer),this.registrationExpiredTimer=null),this.registered&&this.unregistered(null,e.C.causes.CONNECTION_ERROR)},onTransportConnected:function(){this.register(this.options)},close:function(){var e={all:!1,extraHeaders:this.closeHeaders};this.registered_before=this.registered,this.registered&&this.unregister(e)},unregister:function(t){var i;t=t||{},this.registered||t.all||this.logger.warn("Already unregistered, but sending an unregister anyways."),i=(t.extraHeaders||[]).slice(),this.registered=!1,null!==this.registrationTimer&&(e.Timers.clearTimeout(this.registrationTimer),this.registrationTimer=null),t.all?(i.push("Contact: *"),i.push("Expires: 0")):i.push("Contact: "+this.contact+";expires=0"),this.receiveResponse=function(t){var i;switch(!0){case/^1[0-9]{2}$/.test(t.status_code):this.emit("progress",t);break;case/^2[0-9]{2}$/.test(t.status_code):this.emit("accepted",t),null!==this.registrationExpiredTimer&&(e.Timers.clearTimeout(this.registrationExpiredTimer),this.registrationExpiredTimer=null),this.unregistered(t);break;default:i=e.Utils.sipErrorCause(t.status_code),this.unregistered(t,i)}},this.onRequestTimeout=function(){},this.onTransportError=function(){},this.cseq++,this.request.cseq=this.cseq,this.request.setHeader("cseq",this.cseq+" REGISTER"),this.request.extraHeaders=i,this.send()},unregistered:function(e,t){this.registered=!1,this.emit("unregistered",e||null,t||null)}},e.RegisterContext=t}},function(e,t,i){"use strict";e.exports=function(e){var t=function(e,t){};return t.prototype=Object.create(e.prototype,{close:{value:function(){}},getDescription:{value:function(e,t){}},hasDescription:{value:function(e){}},holdModifier:{value:function(e){}},setDescription:{value:function(e,t,i){}}}),t}},function(e,t,i){"use strict";e.exports=function(e){var t;((t=function(t,i,s,r){var n=s;if(void 0===s)throw new TypeError("Not enough arguments");if(this.ua=t,this.logger=t.getLogger("sip.clientcontext"),this.method=i,!(s=t.normalizeTarget(s)))throw new TypeError("Invalid target: "+n);(r=Object.create(r||Object.prototype)).extraHeaders=(r.extraHeaders||[]).slice(),this.request=new e.OutgoingRequest(this.method,s,this.ua,r.params,r.extraHeaders),r.body&&(this.body={},this.body.body=r.body,r.contentType&&(this.body.contentType=r.contentType),this.request.body=this.body),this.localIdentity=this.request.from,this.remoteIdentity=this.request.to,this.data={}}).prototype=Object.create(e.EventEmitter.prototype)).send=function(){return new e.RequestSender(this,this.ua).send(),this},t.prototype.cancel=function(t){(t=t||{}).extraHeaders=(t.extraHeaders||[]).slice();var i=e.Utils.getCancelReason(t.status_code,t.reason_phrase);this.request.cancel(i,t.extraHeaders),this.emit("cancel")},t.prototype.receiveResponse=function(t){var i=e.Utils.getReasonPhrase(t.status_code);switch(!0){case/^1[0-9]{2}$/.test(t.status_code):this.emit("progress",t,i);break;case/^2[0-9]{2}$/.test(t.status_code):this.ua.applicants[this]&&delete this.ua.applicants[this],this.emit("accepted",t,i);break;default:this.ua.applicants[this]&&delete this.ua.applicants[this],this.emit("rejected",t,i),this.emit("failed",t,i)}},t.prototype.onRequestTimeout=function(){this.emit("failed",null,e.C.causes.REQUEST_TIMEOUT)},t.prototype.onTransportError=function(){this.emit("failed",null,e.C.causes.CONNECTION_ERROR)},e.ClientContext=t}},function(e,t,i){"use strict";e.exports=function(e){var t;((t=function(t,i){this.ua=t,this.logger=t.getLogger("sip.servercontext"),this.request=i,i.method===e.C.INVITE?this.transaction=new e.Transactions.InviteServerTransaction(i,t):this.transaction=new e.Transactions.NonInviteServerTransaction(i,t),i.body&&(this.body=i.body),i.hasHeader("Content-Type")&&(this.contentType=i.getHeader("Content-Type")),this.method=i.method,this.data={},this.localIdentity=i.to,this.remoteIdentity=i.from}).prototype=Object.create(e.EventEmitter.prototype)).progress=function(e){return(e=Object.create(e||Object.prototype)).statusCode||(e.statusCode=180),e.minCode=100,e.maxCode=199,e.events=["progress"],this.reply(e)},t.prototype.accept=function(e){return(e=Object.create(e||Object.prototype)).statusCode||(e.statusCode=200),e.minCode=200,e.maxCode=299,e.events=["accepted"],this.reply(e)},t.prototype.reject=function(e){return(e=Object.create(e||Object.prototype)).statusCode||(e.statusCode=480),e.minCode=300,e.maxCode=699,e.events=["rejected","failed"],this.reply(e)},t.prototype.reply=function(t){var i,s=(t=t||{}).statusCode||100,r=t.minCode||100,n=t.maxCode||699,o=e.Utils.getReasonPhrase(s,t.reasonPhrase),a=t.extraHeaders||[],c=t.body,h=t.events||[];if(s<r||s>n)throw new TypeError("Invalid statusCode: "+s);return i=this.request.reply(s,o,a,c),h.forEach(function(e){this.emit(e,i,o)},this),this},t.prototype.onRequestTimeout=function(){this.emit("failed",null,e.C.causes.REQUEST_TIMEOUT)},t.prototype.onTransportError=function(){this.emit("failed",null,e.C.causes.CONNECTION_ERROR)},e.ServerContext=t}},function(e,t,i){"use strict";e.exports=function(e,t){var s,r,n,o=i(35)(e),a={STATUS_NULL:0,STATUS_INVITE_SENT:1,STATUS_1XX_RECEIVED:2,STATUS_INVITE_RECEIVED:3,STATUS_WAITING_FOR_ANSWER:4,STATUS_ANSWERED:5,STATUS_WAITING_FOR_PRACK:6,STATUS_WAITING_FOR_ACK:7,STATUS_CANCELED:8,STATUS_TERMINATED:9,STATUS_ANSWERED_WAITING_FOR_PRACK:10,STATUS_EARLY_MEDIA:11,STATUS_CONFIRMED:12};(s=function(t){if(this.status=a.STATUS_NULL,this.dialog=null,this.pendingReinvite=!1,this.earlyDialogs={},!t)throw new e.Exceptions.SessionDescriptionHandlerMissing("A session description handler is required for the session to function");this.sessionDescriptionHandlerFactory=t,this.hasOffer=!1,this.hasAnswer=!1,this.timers={ackTimer:null,expiresTimer:null,invite2xxTimer:null,userNoAnswerTimer:null,rel1xxTimer:null,prackTimer:null},this.startTime=null,this.endTime=null,this.tones=null,this.local_hold=!1,this.remote_hold=!1,this.disableRenegotiation=!1,this.early_sdp=null,this.rel100=e.C.supported.UNSUPPORTED}).prototype={dtmf:function(t,i){var s=[],r=this;if(i=i||{},void 0===t)throw new TypeError("Not enough arguments");if(this.status!==a.STATUS_CONFIRMED&&this.status!==a.STATUS_WAITING_FOR_ACK)throw new e.Exceptions.InvalidStateError(this.status);if("string"!=typeof t&&"number"!=typeof t||!t.toString().match(/^[0-9A-D#*,]+$/i))throw new TypeError("Invalid tones: "+t);for(t=t.toString().split("");t.length>0;)s.push(new o(this,t.shift(),i));if(this.tones)return this.tones=this.tones.concat(s),this;var n=function(){var t,s;if(r.status===a.STATUS_TERMINATED||!r.tones||0===r.tones.length)return r.tones=null,this;(t=r.tones.shift()).on("failed",function(){r.tones=null}),t.send(i),s=t.duration+t.interToneGap,e.Timers.setTimeout(n,s)};return this.tones=s,n(),this},bye:function(t){var i=(t=Object.create(t||Object.prototype)).statusCode;if(this.status===a.STATUS_TERMINATED)return this.logger.error("Error: Attempted to send BYE in a terminated session."),this;if(this.logger.log("terminating Session"),i&&(i<200||i>=700))throw new TypeError("Invalid statusCode: "+i);return t.receiveResponse=function(){},this.sendRequest(e.C.BYE,t).terminated()},refer:function(t,i){var s=((i=i||{}).extraHeaders||[]).slice(),r=t instanceof e.InviteServerContext||t instanceof e.InviteClientContext,n=t;if(void 0===t)throw new TypeError("Not enough arguments");if(this.status!==a.STATUS_CONFIRMED)throw new e.Exceptions.InvalidStateError(this.status);if(r)t='"'+t.remoteIdentity.friendlyName+'" <'+t.dialog.remote_target.toString()+"?Replaces="+t.dialog.id.call_id+"%3Bto-tag%3D"+t.dialog.id.remote_tag+"%3Bfrom-tag%3D"+t.dialog.id.local_tag+">";else{try{t=e.Grammar.parse(t,"Refer_To").uri||t}catch(e){this.logger.debug(".refer() cannot parse Refer_To from",t),this.logger.debug("...falling through to normalizeTarget()")}if(!(t=this.ua.normalizeTarget(t)))throw new TypeError("Invalid target: "+n)}return s.push("Contact: "+this.contact),s.push("Allow: "+e.UA.C.ALLOWED_METHODS.toString()),s.push("Refer-To: "+t),this.sendRequest(e.C.REFER,{extraHeaders:s,body:i.body,receiveResponse:function(e){/^2[0-9]{2}$/.test(e.status_code)&&(r||t.scheme&&t.scheme.match("^sips?$"))&&this.terminate()}.bind(this)}),this},followRefer:function(e){return function(e,i){var s=i.parseHeader("refer-to"),r=s.uri;if(r.scheme.match("^sips?$")){var n=[],o=r.getHeader("Replaces");void 0!==o&&n.push("Replaces: "+decodeURIComponent(o)),r.clearHeaders();var a=this.passedOptions||{};a.params=a.params||{},a.params.to_displayName=s.friendlyName,a.extraHeaders=n,this.sessionDescriptionHandler&&(a.sessionDescriptionHandlerOptions=this.sessionDescriptionHandler.options);var c=this.ua.invite(r,a,this.modifiers);e.call(this,i,c),this.terminate()}else{var h=r.toString();"function"==typeof t.open?t.open(h):this.logger.warn("referred to non-SIP URI but `open` isn't in the environment: "+h)}}.bind(this,e)},sendRequest:function(t,i){i=i||{};var s=this,r=new e.OutgoingRequest(t,this.dialog.remote_target,this.ua,{cseq:i.cseq||(this.dialog.local_seqnum+=1),call_id:this.dialog.id.call_id,from_uri:this.dialog.local_uri,from_tag:this.dialog.id.local_tag,to_uri:this.dialog.remote_uri,to_tag:this.dialog.id.remote_tag,route_set:this.dialog.route_set,statusCode:i.statusCode,reasonPhrase:i.reasonPhrase},i.extraHeaders||[],i.body);return new e.RequestSender({request:r,onRequestTimeout:function(){s.onRequestTimeout()},onTransportError:function(){s.onTransportError()},receiveResponse:i.receiveResponse||function(e){s.receiveNonInviteResponse(e)}},this.ua).send(),this.emit(t.toLowerCase(),r),this},close:function(){var t;if(this.status===a.STATUS_TERMINATED)return this;this.logger.log("closing INVITE session "+this.id),this.sessionDescriptionHandler&&this.sessionDescriptionHandler.close();for(t in this.timers)e.Timers.clearTimeout(this.timers[t]);this.dialog&&(this.dialog.terminate(),delete this.dialog);for(t in this.earlyDialogs)this.earlyDialogs[t].terminate(),delete this.earlyDialogs[t];return this.status=a.STATUS_TERMINATED,delete this.ua.sessions[this.id],this},createDialog:function(t,i,s){var r,n,o=t["UAS"===i?"to_tag":"from_tag"],a=t["UAS"===i?"from_tag":"to_tag"],c=t.call_id+o+a;if(n=this.earlyDialogs[c],s)return!!n||((n=new e.Dialog(this,t,i,e.Dialog.C.STATUS_EARLY)).error?(this.logger.error(n.error),this.failed(t,e.C.causes.INTERNAL_ERROR),!1):(this.earlyDialogs[c]=n,!0));if(n){n.update(t,i),this.dialog=n,delete this.earlyDialogs[c];for(var h in this.earlyDialogs)this.earlyDialogs[h].terminate(),delete this.earlyDialogs[h];return!0}return(r=new e.Dialog(this,t,i)).error?(this.logger.error(r.error),this.failed(t,e.C.causes.INTERNAL_ERROR),!1):(this.to_tag=t.to_tag,this.dialog=r,!0)},hold:function(t,i){if(this.status!==a.STATUS_WAITING_FOR_ACK&&this.status!==a.STATUS_CONFIRMED)throw new e.Exceptions.InvalidStateError(this.status);this.isOnHold().local?this.logger.log("Session is already on hold, cannot put it on hold again"):(t=t||{},i&&(t.modifiers=i),this.onhold("local"),this.sendReinvite(t))},unhold:function(t,i){if(this.status!==a.STATUS_WAITING_FOR_ACK&&this.status!==a.STATUS_CONFIRMED)throw new e.Exceptions.InvalidStateError(this.status);this.isOnHold().local?(t=t||{},i&&(t.modifiers=i),this.onunhold("local"),this.sendReinvite(t)):this.logger.log("Session is not on hold, cannot unhold it")},isOnHold:function(){return{local:this.local_hold,remote:this.remote_hold}},reinvite:function(e,t){return e=e||{},t&&(e.modifiers=t),this.sendReinvite(e)},receiveReinvite:function(t){var i=this;if(!this.sessionDescriptionHandler.hasDescription(t.getHeader("Content-Type")))return this.logger.warn("invalid Content-Type"),void t.reply(415);this.sessionDescriptionHandler.setDescription(t.body,this.sessionDescriptionHandlerOptions,this.modifiers).then(this.sessionDescriptionHandler.getDescription.bind(this.sessionDescriptionHandler,this.sessionDescriptionHandlerOptions,this.modifiers)).then(function(e){var s=["Contact: "+i.contact];t.reply(200,null,s,e,function(){i.status=a.STATUS_WAITING_FOR_ACK,i.setACKTimer(),i.remote_hold?i.onunhold("remote"):i.remote_hold||i.onhold("remote")})}).catch(function(s){var r;s instanceof e.Exceptions.GetDescriptionError?r=500:s instanceof e.Exceptions.RenegotiationError?(i.emit("renegotiationError",s),i.logger.warn(s),r=488):(i.logger.error(s),r=488),t.reply(r)})},sendReinvite:function(t){if(this.pendingReinvite)this.logger.warn("Reinvite in progress. Please wait until complete, then try again.");else{this.pendingReinvite=!0,(t=t||{}).modifiers=t.modifiers||[];var i=this,s=(t.extraHeaders||[]).slice();s.push("Contact: "+this.contact),s.push("Allow: "+e.UA.C.ALLOWED_METHODS.toString()),this.receiveResponse=this.receiveReinviteResponse,this.isOnHold().local&&t.modifiers.push(i.sessionDescriptionHandler.holdModifier),this.sessionDescriptionHandler.getDescription(t.sessionDescriptionHandlerOptions,t.modifiers).then(function(t){i.dialog.sendRequest(i,e.C.INVITE,{extraHeaders:s,body:t})}).catch(function(t){if(t instanceof e.Exceptions.RenegotiationError)return i.pendingReinvite=!1,i.emit("renegotiationError",t),i.logger.warn("Renegotiation Error"),void i.logger.warn(t);i.logger.error("sessionDescriptionHandler error"),i.logger.error(t)})}},receiveRequest:function(t){switch(t.method){case e.C.BYE:t.reply(200),this.status===a.STATUS_CONFIRMED&&(this.emit("bye",t),this.terminated(t,e.C.causes.BYE));break;case e.C.INVITE:this.status===a.STATUS_CONFIRMED&&(this.logger.log("re-INVITE received"),this.receiveReinvite(t));break;case e.C.INFO:if(this.status===a.STATUS_CONFIRMED||this.status===a.STATUS_WAITING_FOR_ACK){if(this.onInfo)return this.onInfo(t);var i,s,r,n=t.getHeader("content-type"),c=/^(Signal\s*?=\s*?)([0-9A-D#*]{1})(\s)?.*/,h=/^(Duration\s?=\s?)([0-9]{1,4})(\s)?.*/;n&&(n.match(/^application\/dtmf-relay/i)?(t.body&&2===(i=t.body.split("\r\n",2)).length&&(c.test(i[0])&&(s=i[0].replace(c,"$2")),h.test(i[1])&&(r=parseInt(i[1].replace(h,"$2"),10))),new o(this,s,{duration:r}).init_incoming(t)):t.reply(415,null,["Accept: application/dtmf-relay"]))}break;case e.C.REFER:if(this.status===a.STATUS_CONFIRMED){this.logger.log("REFER received");var u;this.listeners("refer").length?(t.reply(202,"Accepted"),u="SIP/2.0 100 Trying",this.sendRequest(e.C.NOTIFY,{extraHeaders:["Event: refer","Subscription-State: terminated","Content-Type: message/sipfrag"],body:u,receiveResponse:function(){}}),this.emit("refer",t)):t.reply(603,"Declined")}break;case e.C.NOTIFY:t.reply(200,"OK"),this.emit("notify",t)}},receiveReinviteResponse:function(t){var i=this;if(this.status!==a.STATUS_TERMINATED)switch(!0){case/^1[0-9]{2}$/.test(t.status_code):break;case/^2[0-9]{2}$/.test(t.status_code):if(this.status=a.STATUS_CONFIRMED,this.emit("ack",t.transaction.sendACK()),this.pendingReinvite=!1,e.Timers.clearTimeout(i.timers.invite2xxTimer),!this.sessionDescriptionHandler.hasDescription(t.getHeader("Content-Type"))){this.logger.error("2XX response received to re-invite but did not have a description"),this.emit("renegotiationError",new e.Exceptions.RenegotiationError("2XX response received to re-invite but did not have a description"));break}this.sessionDescriptionHandler.setDescription(t.body,this.sessionDescriptionHandlerOptions,this.modifiers).catch(function(t){i.logger.error("Could not set the description in 2XX response"),i.logger.error(t),i.emit("renegotiationError",t),i.sendRequest(e.C.BYE,{extraHeaders:[e.Utils.getReasonHeaderValue(488,"Not Acceptable Here")]})});break;default:this.disableRenegotiation=!0,this.pendingReinvite=!1,this.logger.log("Received a non 1XX or 2XX response to a re-invite"),this.emit("renegotiationError",new e.Exceptions.RenegotiationError("Invalid response to a re-invite"))}},acceptAndTerminate:function(t,i,s){var r=[];return i&&r.push("Reason: "+e.Utils.getReasonHeaderValue(i,s)),(this.dialog||this.createDialog(t,"UAC"))&&(this.emit("ack",t.transaction.sendACK()),this.sendRequest(e.C.BYE,{extraHeaders:r})),this},setInvite2xxTimer:function(t,i){var s=this,r=e.Timers.T1;this.timers.invite2xxTimer=e.Timers.setTimeout(function n(){if(s.status===a.STATUS_WAITING_FOR_ACK){s.logger.log("no ACK received, attempting to retransmit OK");var o=["Contact: "+s.contact];t.reply(200,null,o,i),r=Math.min(2*r,e.Timers.T2),s.timers.invite2xxTimer=e.Timers.setTimeout(n,r)}},r)},setACKTimer:function(){var t=this;this.timers.ackTimer=e.Timers.setTimeout(function(){t.status===a.STATUS_WAITING_FOR_ACK&&(t.logger.log("no ACK received for an extended period of time, terminating the call"),e.Timers.clearTimeout(t.timers.invite2xxTimer),t.sendRequest(e.C.BYE),t.terminated(null,e.C.causes.NO_ACK))},e.Timers.TIMER_H)},onTransportError:function(){this.status!==a.STATUS_CONFIRMED&&this.status!==a.STATUS_TERMINATED&&this.failed(null,e.C.causes.CONNECTION_ERROR)},onRequestTimeout:function(){this.status===a.STATUS_CONFIRMED?this.terminated(null,e.C.causes.REQUEST_TIMEOUT):this.status!==a.STATUS_TERMINATED&&(this.failed(null,e.C.causes.REQUEST_TIMEOUT),this.terminated(null,e.C.causes.REQUEST_TIMEOUT))},onDialogError:function(t){this.status===a.STATUS_CONFIRMED?this.terminated(t,e.C.causes.DIALOG_ERROR):this.status!==a.STATUS_TERMINATED&&(this.failed(t,e.C.causes.DIALOG_ERROR),this.terminated(t,e.C.causes.DIALOG_ERROR))},onhold:function(e){this["local"===e?"local_hold":"remote_hold"]=!0,this.emit("hold",{originator:e})},onunhold:function(e){this["local"===e?"local_hold":"remote_hold"]=!1,this.emit("unhold",{originator:e})},failed:function(e,t){return this.status===a.STATUS_TERMINATED?this:(this.emit("failed",e||null,t||null),this)},rejected:function(e,t){return this.emit("rejected",e||null,t||null),this},canceled:function(){return this.emit("cancel"),this},accepted:function(t,i){return i=e.Utils.getReasonPhrase(t&&t.status_code,i),this.startTime=new Date,this.replacee&&(this.replacee.emit("replaced",this),this.replacee.terminate()),this.emit("accepted",t,i),this},terminated:function(e,t){return this.status===a.STATUS_TERMINATED?this:(this.endTime=new Date,this.close(),this.emit("terminated",e||null,t||null),this)},connecting:function(e){return this.emit("connecting",{request:e}),this}},s.C=a,e.Session=s,(r=function(t,i){function s(e,t){i.hasHeader(e)&&i.getHeader(e).toLowerCase().indexOf("100rel")>=0&&(n.rel100=t)}var r,n=this,o=i.getHeader("Content-Type"),c=i.parseHeader("Content-Disposition");if(e.Utils.augment(this,e.ServerContext,[t,i]),e.Utils.augment(this,e.Session,[t.configuration.sessionDescriptionHandlerFactory]),c&&"render"===c.type&&(this.renderbody=i.body,this.rendertype=o),this.status=a.STATUS_INVITE_RECEIVED,this.from_tag=i.from_tag,this.id=i.call_id+this.from_tag,this.request=i,this.contact=this.ua.contact.toString(),this.receiveNonInviteResponse=function(){},this.logger=t.getLogger("sip.inviteservercontext",this.id),this.ua.sessions[this.id]=this,i.hasHeader("expires")&&(r=1e3*i.getHeader("expires")),s("require",e.C.supported.REQUIRED),s("supported",e.C.supported.SUPPORTED),i.to_tag=e.Utils.newTag(),this.createDialog(i,"UAS",!0)){var h={extraHeaders:["Contact: "+n.contact]};n.rel100!==e.C.supported.REQUIRED&&n.progress(h),n.status=a.STATUS_WAITING_FOR_ANSWER,n.timers.userNoAnswerTimer=e.Timers.setTimeout(function(){i.reply(408),n.failed(i,e.C.causes.NO_ANSWER),n.terminated(i,e.C.causes.NO_ANSWER)},n.ua.configuration.noAnswerTimeout),r&&(n.timers.expiresTimer=e.Timers.setTimeout(function(){n.status===a.STATUS_WAITING_FOR_ANSWER&&(i.reply(487),n.failed(i,e.C.causes.EXPIRES),n.terminated(i,e.C.causes.EXPIRES))},r))}else i.reply(500,"Missing Contact header field")}).prototype={reject:function(t){if(this.status===a.STATUS_TERMINATED)throw new e.Exceptions.InvalidStateError(this.status);return this.logger.log("rejecting RTCSession"),e.ServerContext.prototype.reject.call(this,t),this.terminated()},terminate:function(t){var i,s=((t=t||{}).extraHeaders||[]).slice(),r=t.body,n=this;return this.status===a.STATUS_WAITING_FOR_ACK&&this.request.server_transaction.state!==e.Transactions.C.STATUS_TERMINATED?(i=this.dialog,this.receiveRequest=function(t){t.method===e.C.ACK&&(this.sendRequest(e.C.BYE,{extraHeaders:s,body:r}),i.terminate())},this.request.server_transaction.on("stateChanged",function(){this.state===e.Transactions.C.STATUS_TERMINATED&&this.dialog&&(this.request=new e.OutgoingRequest(e.C.BYE,this.dialog.remote_target,this.ua,{cseq:this.dialog.local_seqnum+=1,call_id:this.dialog.id.call_id,from_uri:this.dialog.local_uri,from_tag:this.dialog.id.local_tag,to_uri:this.dialog.remote_uri,to_tag:this.dialog.id.remote_tag,route_set:this.dialog.route_set},s,r),new e.RequestSender({request:this.request,onRequestTimeout:function(){n.onRequestTimeout()},onTransportError:function(){n.onTransportError()},receiveResponse:function(){}},this.ua).send(),i.terminate())}),this.emit("bye",this.request),this.terminated(),this.dialog=i,this.ua.dialogs[i.id.toString()]=i):this.status===a.STATUS_CONFIRMED?this.bye(t):this.reject(t),this},progress:function(t){function i(){r=t.statusCode||183,this.status=a.STATUS_WAITING_FOR_PRACK,o.push("Contact: "+this.contact),o.push("Require: 100rel"),o.push("RSeq: "+Math.floor(1e4*Math.random())),this.sessionDescriptionHandler.getDescription(t.sessionDescriptionHandlerOptions,t.modifiers).then(function(t){if(!this.isCanceled&&this.status!==a.STATUS_TERMINATED){this.early_sdp=t.body,this[this.hasOffer?"hasAnswer":"hasOffer"]=!0;var i=e.Timers.T1;this.timers.rel1xxTimer=e.Timers.setTimeout(function s(){this.request.reply(r,null,o,t),i*=2,this.timers.rel1xxTimer=e.Timers.setTimeout(s.bind(this),i)}.bind(this),i),this.timers.prackTimer=e.Timers.setTimeout(function(){this.status===a.STATUS_WAITING_FOR_PRACK&&(this.logger.log("no PRACK received, rejecting the call"),e.Timers.clearTimeout(this.timers.rel1xxTimer),this.request.reply(504),this.terminated(null,e.C.causes.NO_PRACK))}.bind(this),64*e.Timers.T1),s=this.request.reply(r,n,o,t),this.emit("progress",s,n)}}.bind(this),function(){this.request.reply(480),this.failed(null,e.C.causes.WEBRTC_ERROR),this.terminated(null,e.C.causes.WEBRTC_ERROR)}.bind(this))}var s,r=(t=t||{}).statusCode||180,n=t.reasonPhrase,o=(t.extraHeaders||[]).slice(),c=t.body;if(r<100||r>199)throw new TypeError("Invalid statusCode: "+r);return this.isCanceled||this.status===a.STATUS_TERMINATED?this:(100!==t.statusCode&&(this.rel100===e.C.supported.REQUIRED||this.rel100===e.C.supported.SUPPORTED&&t.rel100||this.rel100===e.C.supported.SUPPORTED&&this.ua.configuration.rel100===e.C.supported.REQUIRED)?(this.sessionDescriptionHandler=this.setupSessionDescriptionHandler(),this.sessionDescriptionHandler.hasDescription(this.request.getHeader("Content-Type"))?(this.hasOffer=!0,this.sessionDescriptionHandler.setDescription(this.request.body,t.sessionDescriptionHandlerOptions,t.modifiers).then(i.apply(this)).catch(function(t){this.logger.warn("invalid description"),this.logger.warn(t),this.failed(null,e.C.causes.WEBRTC_ERROR),this.terminated(null,e.C.causes.WEBRTC_ERROR)}.bind(this))):i.apply(this)):function(){s=this.request.reply(r,n,o,c),this.emit("progress",s,n)}.apply(this),this)},accept:function(t){t=t||{},this.onInfo=t.onInfo;var i=this,s=this.request,r=(t.extraHeaders||[]).slice(),n=function(t){var n;r.push("Contact: "+i.contact),r.push("Allow: "+e.UA.C.ALLOWED_METHODS.toString()),i.hasOffer?i.hasAnswer=!0:i.hasOffer=!0,n=s.reply(200,null,r,t,function(){i.status=a.STATUS_WAITING_FOR_ACK,i.setInvite2xxTimer(s,t),i.setACKTimer()},function(){i.failed(null,e.C.causes.CONNECTION_ERROR),i.terminated(null,e.C.causes.CONNECTION_ERROR)}),i.status!==a.STATUS_TERMINATED&&i.accepted(n,e.Utils.getReasonPhrase(200))},o=function(){i.status!==a.STATUS_TERMINATED&&(i.request.reply(480),i.failed(null,e.C.causes.WEBRTC_ERROR),i.terminated(null,e.C.causes.WEBRTC_ERROR))};if(this.status===a.STATUS_WAITING_FOR_PRACK)return this.status=a.STATUS_ANSWERED_WAITING_FOR_PRACK,this;if(this.status===a.STATUS_WAITING_FOR_ANSWER)this.status=a.STATUS_ANSWERED;else if(this.status!==a.STATUS_EARLY_MEDIA)throw new e.Exceptions.InvalidStateError(this.status);if(!this.createDialog(s,"UAS"))return s.reply(500,"Missing Contact header field"),this;if(e.Timers.clearTimeout(this.timers.userNoAnswerTimer),this.status===a.STATUS_EARLY_MEDIA)n({});else if(this.sessionDescriptionHandler=this.setupSessionDescriptionHandler(),"0"!==this.request.getHeader("Content-Length")||this.request.getHeader("Content-Type")){if(!this.sessionDescriptionHandler.hasDescription(this.request.getHeader("Content-Type")))return void this.request.reply(415);this.hasOffer=!0,this.sessionDescriptionHandler.setDescription(this.request.body,t.sessionDescriptionHandlerOptions,t.modifiers).then(function(){return this.sessionDescriptionHandler.getDescription(t.sessionDescriptionHandlerOptions,t.modifiers)}.bind(this)).then(n).catch(o)}else this.sessionDescriptionHandler.getDescription(t.sessionDescriptionHandlerOptions,t.modifiers).then(n).catch(o);return this},receiveRequest:function(t){function i(){var i,s;e.Timers.clearTimeout(this.timers.ackTimer),e.Timers.clearTimeout(this.timers.invite2xxTimer),this.status=a.STATUS_CONFIRMED,i=t.getHeader("Content-Type"),(s=t.getHeader("Content-Disposition"))&&"render"===s.type&&(this.renderbody=t.body,this.rendertype=i),this.emit("confirmed",t)}switch(t.method){case e.C.CANCEL:this.status!==a.STATUS_WAITING_FOR_ANSWER&&this.status!==a.STATUS_WAITING_FOR_PRACK&&this.status!==a.STATUS_ANSWERED_WAITING_FOR_PRACK&&this.status!==a.STATUS_EARLY_MEDIA&&this.status!==a.STATUS_ANSWERED||(this.status=a.STATUS_CANCELED,this.request.reply(487),this.canceled(t),this.rejected(t,e.C.causes.CANCELED),this.failed(t,e.C.causes.CANCELED),this.terminated(t,e.C.causes.CANCELED));break;case e.C.ACK:this.status===a.STATUS_WAITING_FOR_ACK&&(this.hasAnswer?i.apply(this):(this.sessionDescriptionHandler=this.setupSessionDescriptionHandler(),this.sessionDescriptionHandler.hasDescription(t.getHeader("Content-Type"))?(this.hasAnswer=!0,this.sessionDescriptionHandler.setDescription(t.body,this.sessionDescriptionHandlerOptions,this.modifiers).then(i.bind(this),function(i){this.logger.warn(i),this.terminate({statusCode:"488",reasonPhrase:"Bad Media Description"}),this.failed(t,e.C.causes.BAD_MEDIA_DESCRIPTION),this.terminated(t,e.C.causes.BAD_MEDIA_DESCRIPTION)}.bind(this))):this.early_sdp?i.apply(this):(this.failed(t,e.C.causes.BAD_MEDIA_DESCRIPTION),this.terminated(t,e.C.causes.BAD_MEDIA_DESCRIPTION))));break;case e.C.PRACK:this.status===a.STATUS_WAITING_FOR_PRACK||this.status===a.STATUS_ANSWERED_WAITING_FOR_PRACK?this.hasAnswer?(e.Timers.clearTimeout(this.timers.rel1xxTimer),e.Timers.clearTimeout(this.timers.prackTimer),t.reply(200),this.status===a.STATUS_ANSWERED_WAITING_FOR_PRACK&&(this.status=a.STATUS_EARLY_MEDIA,this.accept()),this.status=a.STATUS_EARLY_MEDIA):(this.sessionDescriptionHandler=this.setupSessionDescriptionHandler(),this.sessionDescriptionHandler.hasDescription(t.getHeader("Content-Type"))?(this.hasAnswer=!0,this.sessionDescriptionHandler.setDescription(t.body,this.sessionDescriptionHandlerOptions,this.modifiers).then(function(){e.Timers.clearTimeout(this.timers.rel1xxTimer),e.Timers.clearTimeout(this.timers.prackTimer),t.reply(200),this.status===a.STATUS_ANSWERED_WAITING_FOR_PRACK&&(this.status=a.STATUS_EARLY_MEDIA,this.accept()),this.status=a.STATUS_EARLY_MEDIA}.bind(this),function(i){this.logger.warn(i),this.terminate({statusCode:"488",reasonPhrase:"Bad Media Description"}),this.failed(t,e.C.causes.BAD_MEDIA_DESCRIPTION),this.terminated(t,e.C.causes.BAD_MEDIA_DESCRIPTION)}.bind(this))):(this.terminate({statusCode:"488",reasonPhrase:"Bad Media Description"}),this.failed(t,e.C.causes.BAD_MEDIA_DESCRIPTION),this.terminated(t,e.C.causes.BAD_MEDIA_DESCRIPTION))):this.status===a.STATUS_EARLY_MEDIA&&t.reply(200);break;default:s.prototype.receiveRequest.apply(this,[t])}},setupSessionDescriptionHandler:function(){return this.sessionDescriptionHandler?this.sessionDescriptionHandler:this.sessionDescriptionHandlerFactory(this,this.ua.configuration.sessionDescriptionHandlerFactoryOptions)},onTransportError:function(){this.status!==a.STATUS_CONFIRMED&&this.status!==a.STATUS_TERMINATED&&this.failed(null,e.C.causes.CONNECTION_ERROR)},onRequestTimeout:function(){this.status===a.STATUS_CONFIRMED?this.terminated(null,e.C.causes.REQUEST_TIMEOUT):this.status!==a.STATUS_TERMINATED&&(this.failed(null,e.C.causes.REQUEST_TIMEOUT),this.terminated(null,e.C.causes.REQUEST_TIMEOUT))}},e.InviteServerContext=r,(n=function(t,i,s,r){s=s||{},this.passedOptions=s,s.params=Object.create(s.params||Object.prototype);var n=(s.extraHeaders||[]).slice(),o=t.configuration.sessionDescriptionHandlerFactory;if(this.sessionDescriptionHandlerFactoryOptions=t.configuration.sessionDescriptionHandlerFactoryOptions||{},this.sessionDescriptionHandlerOptions=s.sessionDescriptionHandlerOptions||{},this.modifiers=r,this.inviteWithoutSdp=s.inviteWithoutSdp||!1,this.anonymous=s.anonymous||!1,this.renderbody=s.renderbody||null,this.rendertype=s.rendertype||"text/plain",this.from_tag=e.Utils.newTag(),s.params.from_tag=this.from_tag,this.contact=t.contact.toString({anonymous:this.anonymous,outbound:this.anonymous?!t.contact.temp_gruu:!t.contact.pub_gruu}),this.anonymous&&(s.params.from_displayName="Anonymous",s.params.from_uri="sip:anonymous@anonymous.invalid",n.push("P-Preferred-Identity: "+t.configuration.uri.toString()),n.push("Privacy: id")),n.push("Contact: "+this.contact),n.push("Allow: "+e.UA.C.ALLOWED_METHODS.toString()),this.inviteWithoutSdp&&this.renderbody&&(n.push("Content-Type: "+this.rendertype),n.push("Content-Disposition: render;handling=optional")),t.configuration.rel100===e.C.supported.REQUIRED&&n.push("Require: 100rel"),t.configuration.replaces===e.C.supported.REQUIRED&&n.push("Require: replaces"),s.extraHeaders=n,e.Utils.augment(this,e.ClientContext,[t,e.C.INVITE,i,s]),e.Utils.augment(this,e.Session,[o]),this.status!==a.STATUS_NULL)throw new e.Exceptions.InvalidStateError(this.status);this.isCanceled=!1,this.received_100=!1,this.method=e.C.INVITE,this.receiveNonInviteResponse=this.receiveResponse,this.receiveResponse=this.receiveInviteResponse,this.logger=t.getLogger("sip.inviteclientcontext"),t.applicants[this]=this,this.id=this.request.call_id+this.from_tag,this.onInfo=s.onInfo}).prototype={invite:function(){var t=this;return this.ua.sessions[this.id]=this,this.inviteWithoutSdp?(this.request.body=t.renderbody,this.status=a.STATUS_INVITE_SENT,this.send()):(this.sessionDescriptionHandler=this.sessionDescriptionHandlerFactory(this,this.sessionDescriptionHandlerFactoryOptions),this.sessionDescriptionHandler.getDescription(this.sessionDescriptionHandlerOptions,this.modifiers).then(function(e){t.isCanceled||t.status===a.STATUS_TERMINATED||(t.hasOffer=!0,t.request.body=e,t.status=a.STATUS_INVITE_SENT,t.send())},function(){t.status!==a.STATUS_TERMINATED&&(t.failed(null,e.C.causes.WEBRTC_ERROR),t.terminated(null,e.C.causes.WEBRTC_ERROR))})),this},receiveInviteResponse:function(t){var i,s=this,r=t.call_id+t.from_tag+t.to_tag,n=[],o={};if(this.status!==a.STATUS_TERMINATED&&t.method===e.C.INVITE){if(this.dialog&&t.status_code>=200&&t.status_code<=299){if(r!==this.dialog.id.toString()){if(!this.createDialog(t,"UAC",!0))return;return this.emit("ack",t.transaction.sendACK({body:e.Utils.generateFakeSDP(t.body)})),this.earlyDialogs[r].sendRequest(this,e.C.BYE),void(this.status!==a.STATUS_CONFIRMED&&(this.failed(t,e.C.causes.WEBRTC_ERROR),this.terminated(t,e.C.causes.WEBRTC_ERROR)))}if(this.status===a.STATUS_CONFIRMED)return void this.emit("ack",t.transaction.sendACK());if(!this.hasAnswer)return}if(this.dialog&&t.status_code<200){if(-1!==this.dialog.pracked.indexOf(t.getHeader("rseq"))||this.dialog.pracked[this.dialog.pracked.length-1]>=t.getHeader("rseq")&&this.dialog.pracked.length>0)return;if(!this.earlyDialogs[r]&&!this.createDialog(t,"UAC",!0))return;if(-1!==this.earlyDialogs[r].pracked.indexOf(t.getHeader("rseq"))||this.earlyDialogs[r].pracked[this.earlyDialogs[r].pracked.length-1]>=t.getHeader("rseq")&&this.earlyDialogs[r].pracked.length>0)return;return n.push("RAck: "+t.getHeader("rseq")+" "+t.getHeader("cseq")),this.earlyDialogs[r].pracked.push(t.getHeader("rseq")),void this.earlyDialogs[r].sendRequest(this,e.C.PRACK,{extraHeaders:n,body:e.Utils.generateFakeSDP(t.body)})}if(this.isCanceled)t.status_code>=100&&t.status_code<200?(this.request.cancel(this.cancelReason,n),this.canceled(null)):t.status_code>=200&&t.status_code<299?(this.acceptAndTerminate(t),this.emit("bye",this.request)):t.status_code>=300&&(i=e.C.REASON_PHRASE[t.status_code]||e.C.causes.CANCELED,this.rejected(t,i),this.failed(t,i),this.terminated(t,i));else switch(!0){case/^100$/.test(t.status_code):this.received_100=!0,this.emit("progress",t);break;case/^1[0-9]{2}$/.test(t.status_code):if(!t.to_tag){this.logger.warn("1xx response received without to tag");break}if(t.hasHeader("contact")&&!this.createDialog(t,"UAC",!0))break;if(this.status=a.STATUS_1XX_RECEIVED,t.hasHeader("require")&&-1!==t.getHeader("require").indexOf("100rel")){if(this.dialog||!this.earlyDialogs[r])break;if(-1!==this.earlyDialogs[r].pracked.indexOf(t.getHeader("rseq"))||this.earlyDialogs[r].pracked[this.earlyDialogs[r].pracked.length-1]>=t.getHeader("rseq")&&this.earlyDialogs[r].pracked.length>0)return;if(this.sessionDescriptionHandler=this.sessionDescriptionHandlerFactory(this,this.sessionDescriptionHandlerFactoryOptions),this.sessionDescriptionHandler.hasDescription(t.getHeader("Content-Type")))if(this.hasOffer){if(!this.createDialog(t,"UAC"))break;this.hasAnswer=!0,this.dialog.pracked.push(t.getHeader("rseq")),this.sessionDescriptionHandler.setDescription(t.body,this.sessionDescriptionHandlerOptions,this.modifiers).then(function(){n.push("RAck: "+t.getHeader("rseq")+" "+t.getHeader("cseq")),s.sendRequest(e.C.PRACK,{extraHeaders:n,receiveResponse:function(){}}),s.status=a.STATUS_EARLY_MEDIA,s.emit("progress",t)},function(i){s.logger.warn(i),s.acceptAndTerminate(t,488,"Not Acceptable Here"),s.failed(t,e.C.causes.BAD_MEDIA_DESCRIPTION)})}else{var c=this.earlyDialogs[r],h=c.sessionDescriptionHandler=this.sessionDescriptionHandlerFactory(this,this.sessionDescriptionHandlerOptions);c.pracked.push(t.getHeader("rseq")),h.setDescription(t.body,s.sessionDescriptionHandlerOptions,s.modifers).then(h.getDescription.bind(h,s.sessionDescriptionHandlerOptions,s.modifiers)).then(function(i){n.push("RAck: "+t.getHeader("rseq")+" "+t.getHeader("cseq")),c.sendRequest(s,e.C.PRACK,{extraHeaders:n,body:i}),s.status=a.STATUS_EARLY_MEDIA,s.emit("progress",t)}).catch(function(i){if(i instanceof e.Exceptions.GetDescriptionError){if(c.pracked.push(t.getHeader("rseq")),s.status===a.STATUS_TERMINATED)return;s.failed(null,e.C.causes.WEBRTC_ERROR),s.terminated(null,e.C.causes.WEBRTC_ERROR)}else c.pracked.splice(c.pracked.indexOf(t.getHeader("rseq")),1),s.logger.warn("invalid description"),s.logger.warn(i)})}else n.push("RAck: "+t.getHeader("rseq")+" "+t.getHeader("cseq")),this.earlyDialogs[r].pracked.push(t.getHeader("rseq")),this.earlyDialogs[r].sendRequest(this,e.C.PRACK,{extraHeaders:n}),this.emit("progress",t)}else this.emit("progress",t);break;case/^2[0-9]{2}$/.test(t.status_code):if(this.request.cseq+" "+this.request.method!==t.getHeader("cseq"))break;if(this.status===a.STATUS_EARLY_MEDIA&&this.dialog){this.status=a.STATUS_CONFIRMED,o={},this.renderbody&&(n.push("Content-Type: "+this.rendertype),o.extraHeaders=n,o.body=this.renderbody),this.emit("ack",t.transaction.sendACK(o)),this.accepted(t);break}if(this.dialog)break;if(this.hasOffer)if(this.hasAnswer)this.renderbody&&(n.push("Content-Type: "+s.rendertype),o.extraHeaders=n,o.body=this.renderbody),this.emit("ack",t.transaction.sendACK(o));else{if(!this.sessionDescriptionHandler.hasDescription(t.getHeader("Content-Type"))){this.acceptAndTerminate(t,400,"Missing session description"),this.failed(t,e.C.causes.BAD_MEDIA_DESCRIPTION);break}if(!this.createDialog(t,"UAC"))break;this.hasAnswer=!0,this.sessionDescriptionHandler.setDescription(t.body,this.sessionDescriptionHandlerOptions,this.modifiers).then(function(){var e={};s.status=a.STATUS_CONFIRMED,s.renderbody&&(n.push("Content-Type: "+s.rendertype),e.extraHeaders=n,e.body=s.renderbody),s.emit("ack",t.transaction.sendACK(e)),s.accepted(t)},function(i){s.logger.warn(i),s.acceptAndTerminate(t,488,"Not Acceptable Here"),s.failed(t,e.C.causes.BAD_MEDIA_DESCRIPTION)})}else if(this.earlyDialogs[r]&&this.earlyDialogs[r].sessionDescriptionHandler){if(this.hasOffer=!0,this.hasAnswer=!0,this.sessionDescriptionHandler=this.earlyDialogs[r].sessionDescriptionHandler,!this.createDialog(t,"UAC"))break;this.status=a.STATUS_CONFIRMED,this.emit("ack",t.transaction.sendACK()),this.accepted(t)}else{if(this.sessionDescriptionHandler=this.sessionDescriptionHandlerFactory(this,this.sessionDescriptionHandlerFactoryOptions),!this.sessionDescriptionHandler.hasDescription(t.getHeader("Content-Type"))){this.acceptAndTerminate(t,400,"Missing session description"),this.failed(t,e.C.causes.BAD_MEDIA_DESCRIPTION);break}if(!this.createDialog(t,"UAC"))break;this.hasOffer=!0,this.sessionDescriptionHandler.setDescription(t.body,this.sessionDescriptionHandlerOptions,this.modifiers).then(this.sessionDescriptionHandler.getDescription.bind(this.sessionDescriptionHandler,this.sessionDescriptionHandlerOptions,this.modifiers)).then(function(e){s.isCanceled||s.status===a.STATUS_TERMINATED||(s.status=a.STATUS_CONFIRMED,s.hasAnswer=!0,s.emit("ack",t.transaction.sendACK({body:e})),s.accepted(t))}).catch(function(i){i instanceof e.Exceptions.GetDescriptionError?s.logger.warn("there was a problem"):(s.logger.warn("invalid description"),s.logger.warn(i),s.acceptAndTerminate(t,488,"Invalid session description"),s.failed(t,e.C.causes.BAD_MEDIA_DESCRIPTION))})}break;default:i=e.Utils.sipErrorCause(t.status_code),this.rejected(t,i),this.failed(t,i),this.terminated(t,i)}}},cancel:function(t){if(t=t||{},t.extraHeaders=(t.extraHeaders||[]).slice(),this.status===a.STATUS_TERMINATED||this.status===a.STATUS_CONFIRMED)throw new e.Exceptions.InvalidStateError(this.status);this.logger.log("canceling RTCSession");var i=e.Utils.getCancelReason(t.status_code,t.reason_phrase);return this.status===a.STATUS_NULL||this.status===a.STATUS_INVITE_SENT&&!this.received_100?(this.isCanceled=!0,this.cancelReason=i):this.status!==a.STATUS_INVITE_SENT&&this.status!==a.STATUS_1XX_RECEIVED&&this.status!==a.STATUS_EARLY_MEDIA||this.request.cancel(i,t.extraHeaders),this.canceled()},terminate:function(e){return this.status===a.STATUS_TERMINATED?this:(this.status===a.STATUS_WAITING_FOR_ACK||this.status===a.STATUS_CONFIRMED?this.bye(e):this.cancel(e),this)},receiveRequest:function(t){return t.method,e.C.CANCEL,t.method===e.C.ACK&&this.status===a.STATUS_WAITING_FOR_ACK&&(e.Timers.clearTimeout(this.timers.ackTimer),e.Timers.clearTimeout(this.timers.invite2xxTimer),this.status=a.STATUS_CONFIRMED,this.accepted()),s.prototype.receiveRequest.apply(this,[t])},onTransportError:function(){this.status!==a.STATUS_CONFIRMED&&this.status!==a.STATUS_TERMINATED&&this.failed(null,e.C.causes.CONNECTION_ERROR)},onRequestTimeout:function(){this.status===a.STATUS_CONFIRMED?this.terminated(null,e.C.causes.REQUEST_TIMEOUT):this.status!==a.STATUS_TERMINATED&&(this.failed(null,e.C.causes.REQUEST_TIMEOUT),this.terminated(null,e.C.causes.REQUEST_TIMEOUT))}},e.InviteClientContext=n}},function(e,t,i){"use strict";e.exports=function(e){var t;return t=function(i,s,r){var n,o;if(void 0===s)throw new TypeError("Not enough arguments");if(this.logger=i.ua.getLogger("sip.invitecontext.dtmf",i.id),this.owner=i,this.direction=null,r=r||{},n=r.duration||null,o=r.interToneGap||null,"string"==typeof s)s=s.toUpperCase();else{if("number"!=typeof s)throw new TypeError("Invalid tone: "+s);s=s.toString()}if(!s.match(/^[0-9A-D#*]$/))throw new TypeError("Invalid tone: "+s);if(this.tone=s,n&&!e.Utils.isDecimal(n))throw new TypeError("Invalid tone duration: "+n);if(n?n<t.C.MIN_DURATION?(this.logger.warn('"duration" value is lower than the minimum allowed, setting it to '+t.C.MIN_DURATION+" milliseconds"),n=t.C.MIN_DURATION):n>t.C.MAX_DURATION?(this.logger.warn('"duration" value is greater than the maximum allowed, setting it to '+t.C.MAX_DURATION+" milliseconds"),n=t.C.MAX_DURATION):n=Math.abs(n):n=t.C.DEFAULT_DURATION,this.duration=n,o&&!e.Utils.isDecimal(o))throw new TypeError("Invalid interToneGap: "+o);o?o<t.C.MIN_INTER_TONE_GAP?(this.logger.warn('"interToneGap" value is lower than the minimum allowed, setting it to '+t.C.MIN_INTER_TONE_GAP+" milliseconds"),o=t.C.MIN_INTER_TONE_GAP):o=Math.abs(o):o=t.C.DEFAULT_INTER_TONE_GAP,this.interToneGap=o},t.prototype=Object.create(e.EventEmitter.prototype),t.prototype.send=function(t){var i,s={};if(this.direction="outgoing",this.owner.status!==e.Session.C.STATUS_CONFIRMED&&this.owner.status!==e.Session.C.STATUS_WAITING_FOR_ACK)throw new e.Exceptions.InvalidStateError(this.owner.status);i=(t=t||{}).extraHeaders?t.extraHeaders.slice():[],s.contentType="application/dtmf-relay",s.body="Signal= "+this.tone+"\r\n",s.body+="Duration= "+this.duration,this.request=this.owner.dialog.sendRequest(this,e.C.INFO,{extraHeaders:i,body:s}),this.owner.emit("dtmf",this.request,this)},t.prototype.receiveResponse=function(t){var i;switch(!0){case/^1[0-9]{2}$/.test(t.status_code):break;case/^2[0-9]{2}$/.test(t.status_code):this.emit("succeeded",{originator:"remote",response:t});break;default:i=e.Utils.sipErrorCause(t.status_code),this.emit("failed",t,i)}},t.prototype.onRequestTimeout=function(){this.emit("failed",null,e.C.causes.REQUEST_TIMEOUT),this.owner.onRequestTimeout()},t.prototype.onTransportError=function(){this.emit("failed",null,e.C.causes.CONNECTION_ERROR),this.owner.onTransportError()},t.prototype.onDialogError=function(t){this.emit("failed",t,e.C.causes.DIALOG_ERROR),this.owner.onDialogError(t)},t.prototype.init_incoming=function(e){this.direction="incoming",this.request=e,e.reply(200),this.tone&&this.duration?this.owner.emit("dtmf",e,this):this.logger.warn("invalid INFO DTMF received, discarded")},t.C={MIN_DURATION:70,MAX_DURATION:6e3,DEFAULT_DURATION:100,MIN_INTER_TONE_GAP:50,DEFAULT_INTER_TONE_GAP:500},t}},function(e,t,i){"use strict";e.exports=function(e){e.Subscription=function(t,i,s,r){if(r=Object.create(r||Object.prototype),this.extraHeaders=r.extraHeaders=(r.extraHeaders||[]).slice(),this.id=null,this.state="init",!s)throw new TypeError("Event necessary to create a subscription.");this.event=s,"number"!=typeof r.expires?(t.logger.warn("expires must be a number. Using default of 3600."),this.expires=3600):this.expires=r.expires,this.requestedExpires=this.expires,r.extraHeaders.push("Event: "+this.event),r.extraHeaders.push("Expires: "+this.expires),r.body&&(this.body=r.body),this.contact=t.contact.toString(),r.extraHeaders.push("Contact: "+this.contact),r.extraHeaders.push("Allow: "+e.UA.C.ALLOWED_METHODS.toString()),e.Utils.augment(this,e.ClientContext,[t,e.C.SUBSCRIBE,i,r]),this.logger=t.getLogger("sip.subscription"),this.dialog=null,this.timers={N:null,sub_duration:null},this.errorCodes=[404,405,410,416,480,481,482,483,484,485,489,501,604]},e.Subscription.prototype={subscribe:function(){var t=this;return"active"===this.state?(this.refresh(),this):"notify_wait"===this.state?this:(e.Timers.clearTimeout(this.timers.sub_duration),e.Timers.clearTimeout(this.timers.N),this.timers.N=e.Timers.setTimeout(t.timer_fire.bind(t),e.Timers.TIMER_N),this.ua.earlySubscriptions[this.request.call_id+this.request.from.parameters.tag+this.event]=this,this.send(),this.state="notify_wait",this)},refresh:function(){"terminated"!==this.state&&"pending"!==this.state&&"notify_wait"!==this.state&&this.dialog.sendRequest(this,e.C.SUBSCRIBE,{extraHeaders:this.extraHeaders,body:this.body})},receiveResponse:function(t){var i,s=this,r=e.Utils.getReasonPhrase(t.status_code);"notify_wait"===this.state&&t.status_code>=300||"notify_wait"!==this.state&&-1!==this.errorCodes.indexOf(t.status_code)?this.failed(t,null):/^2[0-9]{2}$/.test(t.status_code)?(this.emit("accepted",t,r),(i=t.getHeader("Expires"))&&i<=this.requestedExpires?(this.expires=i,this.timers.sub_duration=e.Timers.setTimeout(s.refresh.bind(s),900*i)):i?(this.logger.warn("Expires header in a 200-class response to SUBSCRIBE with a higher value than the one in the request"),this.failed(t,e.C.INVALID_EXPIRES_HEADER)):(this.logger.warn("Expires header missing in a 200-class response to SUBSCRIBE"),this.failed(t,e.C.EXPIRES_HEADER_MISSING))):t.statusCode>300&&(this.emit("failed",t,r),this.emit("rejected",t,r))},unsubscribe:function(){var t=[],i=this;this.state="terminated",t.push("Event: "+this.event),t.push("Expires: 0"),t.push("Contact: "+this.contact),t.push("Allow: "+e.UA.C.ALLOWED_METHODS.toString()),this.receiveResponse=function(){},this.dialog.sendRequest(this,this.method,{extraHeaders:t,body:this.body}),e.Timers.clearTimeout(this.timers.sub_duration),e.Timers.clearTimeout(this.timers.N),this.timers.N=e.Timers.setTimeout(i.timer_fire.bind(i),e.Timers.TIMER_N)},timer_fire:function(){"terminated"===this.state?(this.terminateDialog(),e.Timers.clearTimeout(this.timers.N),e.Timers.clearTimeout(this.timers.sub_duration),delete this.ua.subscriptions[this.id]):"notify_wait"===this.state||"pending"===this.state?this.close():this.refresh()},close:function(){"notify_wait"===this.state?(this.state="terminated",e.Timers.clearTimeout(this.timers.N),e.Timers.clearTimeout(this.timers.sub_duration),this.receiveResponse=function(){},delete this.ua.earlySubscriptions[this.request.call_id+this.request.from.parameters.tag+this.event]):"terminated"!==this.state&&this.unsubscribe()},createConfirmedDialog:function(t,i){var s;return this.terminateDialog(),s=new e.Dialog(this,t,i),s.invite_seqnum=this.request.cseq,s.local_seqnum=this.request.cseq,!s.error&&(this.dialog=s,!0)},terminateDialog:function(){this.dialog&&(delete this.ua.subscriptions[this.id],this.dialog.terminate(),delete this.dialog)},receiveRequest:function(t){function i(){s.expires&&(e.Timers.clearTimeout(r.timers.sub_duration),s.expires=Math.min(r.expires,Math.max(s.expires,0)),r.timers.sub_duration=e.Timers.setTimeout(r.refresh.bind(r),900*s.expires))}var s,r=this;if(this.matchEvent(t))if(this.dialog||this.createConfirmedDialog(t,"UAS")&&(this.id=this.dialog.id.toString(),delete this.ua.earlySubscriptions[this.request.call_id+this.request.from.parameters.tag+this.event],this.ua.subscriptions[this.id]=this),s=t.parseHeader("Subscription-State"),t.reply(200,e.C.REASON_200),e.Timers.clearTimeout(this.timers.N),this.emit("notify",{request:t}),"terminated"!==this.state)switch(s.state){case"active":this.state="active",i();break;case"pending":"notify_wait"===this.state&&i(),this.state="pending";break;case"terminated":if(e.Timers.clearTimeout(this.timers.sub_duration),s.reason)switch(this.logger.log("terminating subscription with reason "+s.reason),s.reason){case"deactivated":case"timeout":return void this.subscribe();case"probation":case"giveup":return void(s.params&&s.params["retry-after"]?this.timers.sub_duration=e.Timers.setTimeout(r.subscribe.bind(r),s.params["retry-after"]):this.subscribe())}this.close()}else"terminated"===s.state&&(this.terminateDialog(),e.Timers.clearTimeout(this.timers.N),e.Timers.clearTimeout(this.timers.sub_duration),delete this.ua.subscriptions[this.id]);else t.reply(489)},failed:function(e,t){return this.close(),this.emit("failed",e,t),this.emit("rejected",e,t),this},onDialogError:function(t){this.failed(t,e.C.causes.DIALOG_ERROR)},matchEvent:function(e){var t;return e.hasHeader("Event")?e.hasHeader("Subscription-State")?(t=e.parseHeader("event").event,this.event===t||(this.logger.warn("event match failed"),e.reply(481,"Event Match Failed"),!1)):(this.logger.warn("missing Subscription-State header"),!1):(this.logger.warn("missing Event header"),!1)}}}},function(e,t,i){"use strict";e.exports=function(e,t){function s(t){if(t instanceof Function)return t.initialize||(t.initialize=function(){return e.Utils.Promise.resolve()}),t}var r,n={STATUS_INIT:0,STATUS_STARTING:1,STATUS_READY:2,STATUS_USER_CLOSED:3,STATUS_NOT_READY:4,CONFIGURATION_ERROR:1,NETWORK_ERROR:2,ALLOWED_METHODS:["ACK","CANCEL","INVITE","MESSAGE","BYE","OPTIONS","INFO","NOTIFY","REFER"],ACCEPTED_BODY_TYPES:["application/sdp","application/dtmf-relay"],MAX_FORWARDS:70,TAG_LENGTH:10};((r=function(t){function i(e){return s.emit.bind(s,e)}var s=this;n.ACCEPTED_BODY_TYPES=n.ACCEPTED_BODY_TYPES.toString(),this.log=new e.LoggerFactory,this.logger=this.getLogger("sip.ua"),this.cache={credentials:{}},this.configuration={},this.dialogs={},this.applicants={},this.data={},this.sessions={},this.subscriptions={},this.earlySubscriptions={},this.transport=null,this.contact=null,this.status=n.STATUS_INIT,this.error=null,this.transactions={nist:{},nict:{},ist:{},ict:{}},this.transportRecoverAttempts=0,this.transportRecoveryTimer=null,Object.defineProperties(this,{transactionsCount:{get:function(){var e,t=["nist","nict","ist","ict"],i=0;for(e in t)i+=Object.keys(this.transactions[t[e]]).length;return i}},nictTransactionsCount:{get:function(){return Object.keys(this.transactions.nict).length}},nistTransactionsCount:{get:function(){return Object.keys(this.transactions.nist).length}},ictTransactionsCount:{get:function(){return Object.keys(this.transactions.ict).length}},istTransactionsCount:{get:function(){return Object.keys(this.transactions.ist).length}}}),void 0===t?t={}:("string"==typeof t||t instanceof String)&&(t={uri:t}),t.log&&(t.log.hasOwnProperty("builtinEnabled")&&(this.log.builtinEnabled=t.log.builtinEnabled),t.log.hasOwnProperty("level")&&(this.log.level=t.log.level),t.log.hasOwnProperty("connector")&&(this.log.connector=t.log.connector));try{this.loadConfig(t)}catch(e){throw this.status=n.STATUS_NOT_READY,this.error=n.CONFIGURATION_ERROR,e}this.registerContext=new e.RegisterContext(this),this.registerContext.on("failed",i("registrationFailed")),this.registerContext.on("registered",i("registered")),this.registerContext.on("unregistered",i("unregistered")),this.configuration.autostart&&this.start()}).prototype=Object.create(e.EventEmitter.prototype)).register=function(e){return this.configuration.register=!0,this.registerContext.register(e),this},r.prototype.unregister=function(e){this.configuration.register=!1;var t=this.registerContext;return this.afterConnected(t.unregister.bind(t,e)),this},r.prototype.isRegistered=function(){return this.registerContext.registered},r.prototype.isConnected=function(){return!!this.transport&&this.transport.connected},r.prototype.afterConnected=function(e){this.isConnected()?e():this.once("connected",e)},r.prototype.invite=function(t,i,s){var r=new e.InviteClientContext(this,t,i,s);return this.afterConnected(r.invite.bind(r)),this.emit("inviteSent",r),r},r.prototype.subscribe=function(t,i,s){var r=new e.Subscription(this,t,i,s);return this.afterConnected(r.subscribe.bind(r)),r},r.prototype.message=function(t,i,s){if(void 0===i)throw new TypeError("Not enough arguments");return(s=Object.create(s||Object.prototype)).contentType||(s.contentType="text/plain"),s.body=i,this.request(e.C.MESSAGE,t,s)},r.prototype.request=function(t,i,s){var r=new e.ClientContext(this,t,i,s);return this.afterConnected(r.send.bind(r)),r},r.prototype.stop=function(){function i(){0===a.nistTransactionsCount&&0===a.nictTransactionsCount&&(a.removeListener("transactionDestroyed",i),a.transport.disconnect())}var s,r,o,a=this;if(this.logger.log("user requested closure..."),this.status===n.STATUS_USER_CLOSED)return this.logger.warn("UA already closed"),this;e.Timers.clearTimeout(this.transportRecoveryTimer),this.logger.log("closing registerContext"),this.registerContext.close();for(s in this.sessions)this.logger.log("closing session "+s),this.sessions[s].terminate();for(r in this.subscriptions)this.logger.log("unsubscribing from subscription "+r),this.subscriptions[r].close();for(r in this.earlySubscriptions)this.logger.log("unsubscribing from early subscription "+r),this.earlySubscriptions[r].close();for(o in this.applicants)this.applicants[o].close();return this.status=n.STATUS_USER_CLOSED,0===this.nistTransactionsCount&&0===this.nictTransactionsCount?this.transport.disconnect():this.on("transactionDestroyed",i),"function"==typeof t.removeEventListener&&(global.chrome&&global.chrome.app&&global.chrome.app.runtime||t.removeEventListener("unload",this.environListener)),this},r.prototype.start=function(){var i;return this.logger.log("user requested startup..."),this.status===n.STATUS_INIT?(i=this.getNextWsServer(),this.status=n.STATUS_STARTING,new e.Transport(this,i)):this.status===n.STATUS_USER_CLOSED?(this.logger.log("resuming"),this.status=n.STATUS_READY,this.transport.connect()):this.status===n.STATUS_STARTING?this.logger.log("UA is in STARTING status, not opening new connection"):this.status===n.STATUS_READY?this.logger.log("UA is in READY status, not resuming"):this.logger.error("Connection is down. Auto-Recovery system is trying to connect"),this.configuration.autostop&&"function"==typeof t.addEventListener&&(global.chrome&&global.chrome.app&&global.chrome.app.runtime||(this.environListener=this.stop.bind(this),t.addEventListener("unload",this.environListener))),this},r.prototype.normalizeTarget=function(t){return e.Utils.normalizeTarget(t,this.configuration.hostportParams)},r.prototype.saveCredentials=function(e){return this.cache.credentials[e.realm]=this.cache.credentials[e.realm]||{},this.cache.credentials[e.realm][e.uri]=e,this},r.prototype.getCredentials=function(e){var t,i;return t=e.ruri.host,this.cache.credentials[t]&&this.cache.credentials[t][e.ruri]&&((i=this.cache.credentials[t][e.ruri]).method=e.method),i},r.prototype.getLogger=function(e,t){return this.log.getLogger(e,t)},r.prototype.onTransportClosed=function(t){var i,s,r,n=["nict","ict","nist","ist"];for(t.server.status=e.Transport.C.STATUS_DISCONNECTED,this.logger.log("connection state set to "+e.Transport.C.STATUS_DISCONNECTED),r=n.length,i=0;i<r;i++)for(s in this.transactions[n[i]])this.transactions[n[i]][s].onTransportError();this.contact.pub_gruu||this.closeSessionsOnTransportError()},r.prototype.onTransportError=function(t){var i;this.logger.log("transport "+t.server.ws_uri+" failed | connection state set to "+e.Transport.C.STATUS_ERROR),t.server.status=e.Transport.C.STATUS_ERROR,this.emit("disconnected",{transport:t}),this.status!==n.STATUS_USER_CLOSED&&((i=this.getNextWsServer())?new e.Transport(this,i):(this.closeSessionsOnTransportError(),this.error&&this.error===n.NETWORK_ERROR||(this.status=n.STATUS_NOT_READY,this.error=n.NETWORK_ERROR),this.recoverTransport()))},r.prototype.onTransportConnected=function(t){this.transport=t,this.transportRecoverAttempts=0,t.server.status=e.Transport.C.STATUS_READY,this.logger.log("connection state set to "+e.Transport.C.STATUS_READY),this.status!==n.STATUS_USER_CLOSED&&(this.status=n.STATUS_READY,this.error=null,this.configuration.register&&this.configuration.authenticationFactory.initialize().then(function(){this.registerContext.onTransportConnected()}.bind(this)),this.emit("connected",{transport:t}))},r.prototype.onTransportConnecting=function(e,t){this.emit("connecting",{transport:e,attempts:t})},r.prototype.newTransaction=function(e){this.transactions[e.type][e.id]=e,this.emit("newTransaction",{transaction:e})},r.prototype.destroyTransaction=function(e){delete this.transactions[e.type][e.id],this.emit("transactionDestroyed",{transaction:e})},r.prototype.receiveRequest=function(t){function i(e){return e&&e.user===t.ruri.user}var s,r,o,a,c,h,u=t.method,l=this;if(!(i(this.configuration.uri)||i(this.contact.uri)||i(this.contact.pub_gruu)||i(this.contact.temp_gruu)))return this.logger.warn("Request-URI does not point to us"),void(t.method!==e.C.ACK&&t.reply_sl(404));if(t.ruri.scheme!==e.C.SIPS){if(!e.Transactions.checkTransaction(this,t))if(u===e.C.OPTIONS?(new e.Transactions.NonInviteServerTransaction(t,this),t.reply(200,null,["Allow: "+e.UA.C.ALLOWED_METHODS.toString(),"Accept: "+n.ACCEPTED_BODY_TYPES])):u===e.C.MESSAGE?((o=new e.ServerContext(this,t)).body=t.body,o.content_type=t.getHeader("Content-Type")||"text/plain",t.reply(200,null),this.emit("message",o)):u!==e.C.INVITE&&u!==e.C.ACK&&new e.ServerContext(this,t),t.to_tag)(s=this.findDialog(t))?(u===e.C.INVITE&&new e.Transactions.InviteServerTransaction(t,this),s.receiveRequest(t)):u===e.C.NOTIFY?(r=this.findSession(t),a=this.findEarlySubscription(t),r?r.receiveRequest(t):a?a.receiveRequest(t):(this.logger.warn("received NOTIFY request for a non existent session or subscription"),t.reply(481,"Subscription does not exist"))):u!==e.C.ACK&&t.reply(481);else switch(u){case e.C.INVITE:if(c=this.configuration.replaces!==e.C.supported.UNSUPPORTED&&t.parseHeader("replaces")){if(!(h=this.dialogs[c.call_id+c.replaces_to_tag+c.replaces_from_tag]))return void t.reply_sl(481,null);if(h.owner.status===e.Session.C.STATUS_TERMINATED)return void t.reply_sl(603,null);if(h.state===e.Dialog.C.STATUS_CONFIRMED&&c.early_only)return void t.reply_sl(486,null)}(r=new e.InviteServerContext(this,t)).replacee=h&&h.owner,l.emit("invite",r);break;case e.C.BYE:t.reply(481);break;case e.C.CANCEL:(r=this.findSession(t))?r.receiveRequest(t):this.logger.warn("received CANCEL request for a non existent session");break;case e.C.ACK:break;case e.C.NOTIFY:this.configuration.allowLegacyNotifications&&this.listeners("notify").length>0?(t.reply(200,null),l.emit("notify",{request:t})):t.reply(481,"Subscription does not exist");break;default:t.reply(405)}}else t.reply_sl(416)},r.prototype.findSession=function(e){return this.sessions[e.call_id+e.from_tag]||this.sessions[e.call_id+e.to_tag]||null},r.prototype.findDialog=function(e){return this.dialogs[e.call_id+e.from_tag+e.to_tag]||this.dialogs[e.call_id+e.to_tag+e.from_tag]||null},r.prototype.findEarlySubscription=function(e){return this.earlySubscriptions[e.call_id+e.to_tag+e.getHeader("event")]||null},r.prototype.getNextWsServer=function(){var t,i,s,r=[];for(i=this.configuration.wsServers.length,t=0;t<i;t++)(s=this.configuration.wsServers[t]).status!==e.Transport.C.STATUS_ERROR&&(0===r.length?r.push(s):s.weight>r[0].weight?r=[s]:s.weight===r[0].weight&&r.push(s));return t=Math.floor(Math.random()*r.length),r[t]},r.prototype.closeSessionsOnTransportError=function(){var e;for(e in this.sessions)this.sessions[e].onTransportError();this.registerContext.onTransportClosed()},r.prototype.recoverTransport=function(t){var i,s,r,n,o;for(n=(t=t||this).transportRecoverAttempts,s=t.configuration.wsServers.length,i=0;i<s;i++)t.configuration.wsServers[i].status=0;o=t.getNextWsServer(),(r=Math.floor(Math.random()*Math.pow(2,n)+1)*t.configuration.connectionRecoveryMinInterval)>t.configuration.connectionRecoveryMaxInterval&&(this.logger.log("time for next connection attempt exceeds connectionRecoveryMaxInterval, resetting counter"),r=t.configuration.connectionRecoveryMinInterval,n=0),this.logger.log("next connection attempt in "+r+" seconds"),this.transportRecoveryTimer=e.Timers.setTimeout(function(){t.transportRecoverAttempts=n+1,new e.Transport(t,o)},1e3*r)},r.prototype.loadConfig=function(t){function r(e,i){var s=e.replace(/([a-z][A-Z])/g,function(e){return e[0]+"_"+e[1].toLowerCase()});if(e!==s){var r=t.hasOwnProperty(e);t.hasOwnProperty(s)&&(i.warn(s+" is deprecated, please use "+e),r&&i.warn(e+" overriding "+s)),t[e]=r?t[e]:t[s]}}var n,o,a,c,h,u={viaHost:e.Utils.createRandomToken(12)+".invalid",uri:new e.URI("sip","anonymous."+e.Utils.createRandomToken(6),"anonymous.invalid",null,null),wsServers:[{scheme:"WSS",sip_uri:"<sip:edge.sip.onsip.com;transport=ws;lr>",status:0,weight:0,ws_uri:"wss://edge.sip.onsip.com"}],custom:{},displayName:"",password:null,registerExpires:600,register:!0,registrarServer:null,wsServerMaxReconnection:3,wsServerReconnectionTimeout:4,connectionRecoveryMinInterval:2,connectionRecoveryMaxInterval:30,keepAliveInterval:0,extraSupported:[],usePreloadedRoute:!1,userAgentString:e.C.USER_AGENT,noAnswerTimeout:60,traceSip:!1,hackViaTcp:!1,hackIpInContact:!1,hackWssInTransport:!1,hackAllowUnregisteredOptionTags:!1,sessionDescriptionHandlerFactoryOptions:{constraints:{},peerConnectionOptions:{iceCheckingTimeout:5e3,rtcConfiguration:{}}},contactName:e.Utils.createRandomToken(8),contactTransport:"ws",forceRport:!1,autostart:!0,autostop:!0,rel100:e.C.supported.UNSUPPORTED,replaces:e.C.supported.UNSUPPORTED,sessionDescriptionHandlerFactory:i(38)(e).defaultFactory,authenticationFactory:s(function(t){return new e.DigestAuthentication(t)}),allowLegacyNotifications:!1},l=this.getConfigurationCheck();for(n in l.mandatory){if(r(n,this.logger),!t.hasOwnProperty(n))throw new e.Exceptions.ConfigurationError(n);if(o=t[n],void 0===(a=l.mandatory[n](o)))throw new e.Exceptions.ConfigurationError(n,o);u[n]=a}for(n in l.optional)if(r(n,this.logger),t.hasOwnProperty(n)){if((o=t[n])instanceof Array&&0===o.length)continue;if(null===o||""===o||void 0===o)continue;if("number"==typeof o&&isNaN(o))continue;if(void 0===(a=l.optional[n](o)))throw new e.Exceptions.ConfigurationError(n,o);u[n]=a}if(u.connectionRecoveryMaxInterval<u.connectionRecoveryMinInterval)throw new e.Exceptions.ConfigurationError("connectionRecoveryMaxInterval",u.connectionRecoveryMaxInterval);0===u.displayName&&(u.displayName="0"),u.instanceId||(u.instanceId=e.Utils.newUUID()),u.sipjsId=e.Utils.createRandomToken(5),(c=u.uri.clone()).user=null,u.hostportParams=c.toRaw().replace(/^sip:/i,""),u.authorizationUser||(u.authorizationUser=u.uri.user),u.registrarServer||((h=u.uri.clone()).user=null,u.registrarServer=h),u.noAnswerTimeout=1e3*u.noAnswerTimeout,u.hackIpInContact&&("boolean"==typeof u.hackIpInContact?u.viaHost=e.Utils.getRandomTestNetIP():"string"==typeof u.hackIpInContact&&(u.viaHost=u.hackIpInContact)),u.hackWssInTransport&&(u.contactTransport="wss"),this.contact={pub_gruu:null,temp_gruu:null,uri:new e.URI("sip",u.contactName,u.viaHost,null,{transport:u.contactTransport}),toString:function(e){var t=(e=e||{}).anonymous||null,i=e.outbound||null,s="<";return s+=t?(this.temp_gruu||"sip:anonymous@anonymous.invalid;transport="+u.contactTransport).toString():(this.pub_gruu||this.uri).toString(),i&&(s+=";ob"),s+=">"}};var d={};for(n in u)d[n]={value:u[n],writable:"register"===n||"custom"===n,configurable:!1};Object.defineProperties(this.configuration,d),this.logger.log("configuration parameters after validation:");for(n in u)switch(n){case"uri":case"registrarServer":case"sessionDescriptionHandlerFactory":this.logger.log("\xb7 "+n+": "+u[n]);break;case"password":this.logger.log("\xb7 "+n+": NOT SHOWN");break;default:this.logger.log("\xb7 "+n+": "+JSON.stringify(u[n]))}},r.prototype.getConfigurationCheck=function(){return{mandatory:{},optional:{uri:function(t){var i;return/^sip:/i.test(t)||(t=e.C.SIP+":"+t),(i=e.URI.parse(t))&&i.user?i:void 0},wsServers:function(t){var i,s,r;if("string"==typeof t)t=[{ws_uri:t}];else{if(!(t instanceof Array))return;for(s=t.length,i=0;i<s;i++)"string"==typeof t[i]&&(t[i]={ws_uri:t[i]})}if(0===t.length)return!1;for(s=t.length,i=0;i<s;i++){if(!t[i].ws_uri)return;if(t[i].weight&&!Number(t[i].weight))return;if(-1===(r=e.Grammar.parse(t[i].ws_uri,"absoluteURI")))return;if(["wss","ws","udp"].indexOf(r.scheme)<0)return;t[i].sip_uri="<sip:"+r.host+(r.port?":"+r.port:"")+";transport="+r.scheme.replace(/^wss$/i,"ws")+";lr>",t[i].weight||(t[i].weight=0),t[i].status=0,t[i].scheme=r.scheme.toUpperCase()}return t},authorizationUser:function(t){return-1===e.Grammar.parse('"'+t+'"',"quoted_string")?void 0:t},connectionRecoveryMaxInterval:function(t){var i;if(e.Utils.isDecimal(t)&&(i=Number(t))>0)return i},connectionRecoveryMinInterval:function(t){var i;if(e.Utils.isDecimal(t)&&(i=Number(t))>0)return i},displayName:function(t){return-1===e.Grammar.parse('"'+t+'"',"displayName")?void 0:t},hackViaTcp:function(e){if("boolean"==typeof e)return e},hackIpInContact:function(t){return"boolean"==typeof t?t:"string"==typeof t&&-1!==e.Grammar.parse(t,"host")?t:void 0},hackWssInTransport:function(e){if("boolean"==typeof e)return e},hackAllowUnregisteredOptionTags:function(e){if("boolean"==typeof e)return e},contactTransport:function(e){if("string"==typeof e)return e},forceRport:function(e){if("boolean"==typeof e)return e},instanceId:function(t){if("string"==typeof t)return/^uuid:/i.test(t)&&(t=t.substr(5)),-1===e.Grammar.parse(t,"uuid")?void 0:t},keepAliveInterval:function(t){var i;if(e.Utils.isDecimal(t)&&(i=Number(t))>0)return i},extraSupported:function(e){var t,i;if(e instanceof Array){for(i=e.length,t=0;t<i;t++)if("string"!=typeof e[t])return;return e}},noAnswerTimeout:function(t){var i;if(e.Utils.isDecimal(t)&&(i=Number(t))>0)return i},password:function(e){return String(e)},rel100:function(t){return t===e.C.supported.REQUIRED?e.C.supported.REQUIRED:t===e.C.supported.SUPPORTED?e.C.supported.SUPPORTED:e.C.supported.UNSUPPORTED},replaces:function(t){return t===e.C.supported.REQUIRED?e.C.supported.REQUIRED:t===e.C.supported.SUPPORTED?e.C.supported.SUPPORTED:e.C.supported.UNSUPPORTED},register:function(e){if("boolean"==typeof e)return e},registerExpires:function(t){var i;if(e.Utils.isDecimal(t)&&(i=Number(t))>0)return i},registrarServer:function(t){var i;if("string"==typeof t)return/^sip:/i.test(t)||(t=e.C.SIP+":"+t),(i=e.URI.parse(t))?i.user?void 0:i:void 0},traceSip:function(e){if("boolean"==typeof e)return e},rtcpMuxPolicy:function(e){if("string"==typeof e)return e},userAgentString:function(e){if("string"==typeof e)return e},usePreloadedRoute:function(e){if("boolean"==typeof e)return e},wsServerMaxReconnection:function(t){var i;if(e.Utils.isDecimal(t)&&(i=Number(t))>0)return i},wsServerReconnectionTimeout:function(t){var i;if(e.Utils.isDecimal(t)&&(i=Number(t))>0)return i},autostart:function(e){if("boolean"==typeof e)return e},autostop:function(e){if("boolean"==typeof e)return e},sessionDescriptionHandlerFactory:function(e){if(e instanceof Function)return e},sessionDescriptionHandlerFactoryOptions:function(e){if("object"==typeof e)return e},authenticationFactory:s,allowLegacyNotifications:function(e){if("boolean"==typeof e)return e},custom:function(e){if("object"==typeof e)return e},contactName:function(e){if("string"==typeof e)return e}}}},r.C=n,e.UA=r}},function(e,t,i){"use strict";e.exports=function(e){var t=function(e,t){this.options=t||{},this.logger=e.ua.getLogger("sip.invitecontext.sessionDescriptionHandler",e.id),this.session=e,this.CONTENT_TYPE="application/sdp",this.modifiers=this.options.modifiers||[],Array.isArray(this.modifiers)||(this.modifiers=[this.modifiers]);var i=global.window||global;this.WebRTC={MediaStream:i.MediaStream,getUserMedia:i.navigator.mediaDevices.getUserMedia.bind(i.navigator.mediaDevices),RTCPeerConnection:i.RTCPeerConnection,RTCSessionDescription:i.RTCSessionDescription},this.initPeerConnection(this.options.peerConnectionOptions),this.constraints=this.checkAndDefaultConstraints(this.options.constraints),this.session.emit("SessionDescriptionHandler-created",this)};return t.defaultFactory=function(e,i){return new t(e,i)},t.prototype=Object.create(e.SessionDescriptionHandler.prototype,{close:{writable:!0,value:function(){this.logger.log("closing PeerConnection"),this.peerConnection&&"closed"!==this.peerConnection.signalingState&&(this.peerConnection.getSenders?this.peerConnection.getSenders().forEach(function(e){e.track&&e.track.stop()}):(this.logger.warn("Using getLocalStreams which is deprecated"),this.peerConnection.getLocalStreams().forEach(function(e){e.getTracks().forEach(function(e){e.stop()})})),this.peerConnection.getReceivers?this.peerConnection.getReceivers().forEach(function(e){e.track&&e.track.stop()}):(this.logger.warn("Using getRemoteStreams which is deprecated"),this.peerConnection.getRemoteStreams().forEach(function(e){e.getTracks().forEach(function(e){e.stop()})})),this.peerConnection.close())}},getDescription:{writable:!0,value:function(t,i){var s=this,r=!0;return this.session.disableRenegotiation?(this.logger.warn('The flag "disableRenegotiation" is set to true for this session description handler. We will not try to renegotiate.'),e.Utils.Promise.reject(new e.Exceptions.RenegotiationError("disableRenegotiation flag set to true for this session description handler"))):((t=t||{}).peerConnectionOptions&&this.initPeerConnection(t.peerConnectionOptions),this.constraints&&t.constraints&&this.constraints===t.constraints&&(r=!1),this.constraints=Object.assign(this.constraints,t.constraints),this.constraints=this.checkAndDefaultConstraints(this.constraints),i=i||[],Array.isArray(i)||(i=[i]),i=i.concat(this.modifiers),!r&&this.peerConnection.localDescription&&this.peerConnection.localDescription.sdp&&""!==this.peerConnection.localDescription.sdp?this.createOfferOrAnswer({},i).then(function(e){return{body:e,contentType:s.CONTENT_TYPE}}):(s.logger.log("acquiring local media"),this.acquire(s.constraints).then(function(e){return s.logger.log("acquired local media streams"),e},function(e){throw s.logger.error("unable to acquire streams"),s.logger.error(e),e}).then(function(t){try{(t=[].concat(t)).forEach(function(e){s.peerConnection.addTrack?e.getTracks().forEach(function(t){s.peerConnection.addTrack(t,e)}):s.peerConnection.addStream(e)},this)}catch(t){return s.logger.error("error adding stream"),s.logger.error(t),e.Utils.Promise.reject(t)}return e.Utils.Promise.resolve()}).then(function(){return s.createOfferOrAnswer(t.RTCOfferOptions,i)}).then(function(e){return{body:e,contentType:s.CONTENT_TYPE}}).catch(function(e){throw this.session.disableRenegotiation=!0,e})))}},hasDescription:{writable:!0,value:function(e){return e===this.CONTENT_TYPE}},holdModifier:{writable:!0,value:function(t){return/a=(sendrecv|sendonly|recvonly|inactive)/.test(t.sdp)?(t.sdp=t.sdp.replace(/a=sendrecv\r\n/g,"a=sendonly\r\n"),t.sdp=t.sdp.replace(/a=recvonly\r\n/g,"a=inactive\r\n")):t.sdp=t.sdp.replace(/(m=[^\r]*\r\n)/g,"$1a=sendonly\r\n"),e.Utils.Promise.resolve(t)}},setDescription:{writable:!0,value:function(t,i,s){var r=this,n="undefined"!=typeof InstallTrigger;if(!this.session.disableRenegotiation&&n&&this.peerConnection&&this.isVideoHold(t)&&(this.session.disableRenegotiation=!0),this.session.disableRenegotiation)return this.logger.warn('The flag "disableRenegotiation" is set to true for this session description handler. We will not try to renegotiate.'),e.Utils.Promise.reject(new e.Exceptions.RenegotiationError("disableRenegotiation flag set to true for this session description handler"));(i=i||{}).peerConnectionOptions&&this.initPeerConnection(i.peerConnectionOptions),this.constraints=Object.assign(this.constraints,i.constraints),this.constraints=this.checkAndDefaultConstraints(this.constraints),s=s||[],Array.isArray(s)||(s=[s]),s=s.concat(this.modifiers);var o={type:this.hasOffer("local")?"answer":"offer",sdp:t};return e.Utils.reducePromises(s,o).catch(function(e){throw r.logger.error("The modifiers did not resolve successfully"),r.logger.error(e),e}).then(function(e){return r.emit("setDescription",e),r.peerConnection.setRemoteDescription(new r.WebRTC.RTCSessionDescription(e))}).catch(function(e){throw r.session.disableRenegotiation=!0,r.logger.error(e),r.emit("peerConnection-setRemoteDescriptionFailed",e),e}).then(function(){r.peerConnection.getRemoteStreams?r.emit("setRemoteDescription",r.peerConnection.getRemoteStreams()):r.emit("setRemoteDescription",r.peerConnection.getReceivers()),r.emit("confirmed",r)})}},createOfferOrAnswer:{writable:!0,value:function(t,i){var s,r=this,n=this.peerConnection;return t=t||{},s=r.hasOffer("remote")?"createAnswer":"createOffer",n[s](t).catch(function(e){throw r.emit("peerConnection-"+s+"Failed",e),e}).then(function(t){return e.Utils.reducePromises(i,t)}).then(function(e){return r.logger.log(e),n.setLocalDescription(e)}).catch(function(e){throw r.emit("peerConnection-SetLocalDescriptionFailed",e),e}).then(function(){return new e.Utils.Promise(function(e){"complete"!==n.iceGatheringState||"connected"!==n.iceConnectionState&&"completed"!==n.iceConnectionState?r.onIceCompleted.promise.then(e):e()})}).then(function(){var e=r.peerConnection.localDescription;return r.emit("getDescription",e),e.sdp}).catch(function(t){throw r.logger.error(t),new e.Exceptions.GetDescriptionError(t)})}},addDefaultIceServers:{writable:!0,value:function(e){return e.iceServers||(e.iceServers=[{urls:"stun:stun.l.google.com:19302"}]),e}},checkAndDefaultConstraints:{writable:!0,value:function(e){var t={audio:!0,video:!0};return e=e||t,0===Object.keys(e).length&&e.constructor===Object?t:e}},initPeerConnection:{writable:!0,value:function(t){var i=this;(t=t||{}).rtcConfiguration=t.rtcConfiguration||{},t.rtcConfiguration=this.addDefaultIceServers(t.rtcConfiguration),this.onIceCompleted=e.Utils.defer(),this.onIceCompleted.promise.then(function(t){i.emit("iceGatheringComplete",t),i.iceCheckingTimer&&(e.Timers.clearTimeout(i.iceCheckingTimer),i.iceCheckingTimer=null)}),this.peerConnection&&this.peerConnection.close(),this.peerConnection=new this.WebRTC.RTCPeerConnection(t.rtcConfiguration),this.session.emit("peerConnection-created",this.peerConnection),this.peerConnection.ontrack=function(e){i.logger.log("track added"),i.emit("addTrack",e)},this.peerConnection.onaddstream=function(e){i.logger.warn("Using deprecated stream API"),i.logger.log("stream added"),i.emit("addStream",e)},this.peerConnection.onremovestream=function(e){i.logger.log("stream removed: "+e.stream.id)},this.startIceCheckingTimer=function(){!i.iceCheckingTimer&&t.iceCheckingTimeout&&(i.iceCheckingTimer=e.Timers.setTimeout(function(){i.logger.log("RTCIceChecking Timeout Triggered after "+t.iceCheckingTimeout+" milliseconds"),i.onIceCompleted.resolve(this)}.bind(this.peerConnection),t.iceCheckingTimeout))},this.peerConnection.onicecandidate=function(e){i.emit("iceCandidate",e),e.candidate?(i.logger.log("ICE candidate received: "+(null===e.candidate.candidate?null:e.candidate.candidate.trim())),i.startIceCheckingTimer()):i.onIceCompleted.resolve(this)},this.peerConnection.onicegatheringstatechange=function(){i.logger.log("RTCIceGatheringState changed: "+this.iceGatheringState),"gathering"===this.iceGatheringState&&i.emit("iceGathering",this),"complete"===this.iceGatheringState&&i.onIceCompleted.resolve(this)},this.peerConnection.oniceconnectionstatechange=function(){var e;switch("checking"===this.iceConnectionState&&i.startIceCheckingTimer(),this.iceConnectionState){case"new":e="iceConnection";break;case"checking":e="iceConnectionChecking";break;case"connected":e="iceConnectionConnected";break;case"completed":e="iceConnectionCompleted";break;case"failed":e="iceConnectionFailed";break;case"disconnected":e="iceConnectionDisconnected";break;case"closed":e="iceConnectionClosed";break;default:return void i.logger.warn("Unknown iceConnection state:",this.iceConnectionState)}i.emit(e,this)}}},acquire:{writable:!0,value:function(t){return t=this.checkAndDefaultConstraints(t),new e.Utils.Promise(function(e,i){this.emit("userMediaRequest",t);var s=function(e,t){var i=Array.prototype.slice.call(arguments,2),s=[e].concat(i);return this.emit.apply(this,s),t.apply(null,i)}.bind(this);t.audio||t.video?this.WebRTC.getUserMedia(t).then(s.bind(this,"userMedia",function(t){e(t)}),s.bind(this,"userMediaFailed",function(e){throw i(e),e})):e([])}.bind(this))}},isVideoHold:{writable:!0,value:function(e){return-1!==e.search(/^(m=video.*?)[\s\S]*^(a=sendonly?)/gm)}},hasOffer:{writable:!0,value:function(e){var t="have-"+e+"-offer";return this.peerConnection.signalingState===t}}}),t}},function(e,t,i){"use strict";e.exports=function(e){function t(t,i,s){var r,n=e.Utils.buildStatusLine(t),o=i.getHeaders("via"),a=o.length,c=0;for(c;c<a;c++)n+="Via: "+o[c]+"\r\n";r=i.getHeader("To"),i.to_tag||(r+=";tag="+e.Utils.newTag()),n+="To: "+r+"\r\n",n+="From: "+i.getHeader("From")+"\r\n",n+="Call-ID: "+i.call_id+"\r\n",n+="CSeq: "+i.cseq+" "+i.method+"\r\n",n+="\r\n",s.send(n)}var i,s=[],r=[],n=[];s.push(function(e,i,s){if(!e.ruri||"sip"!==e.ruri.scheme)return t(416,e,s),!1}),s.push(function(e,i,s){if(!e.to_tag&&e.call_id.substr(0,5)===i.configuration.sipjsId)return t(482,e,s),!1}),s.push(function(i,s,r){if(e.Utils.str_utf8_length(i.body)<i.getHeader("content-length"))return t(400,i,r),!1}),s.push(function(i,s,r){var n,o,a=i.from_tag,c=i.call_id,h=i.cseq;if(!i.to_tag)if(i.method===e.C.INVITE){if(n=s.transactions.ist[i.via_branch])return;for(o in s.transactions.ist)if((n=s.transactions.ist[o]).request.from_tag===a&&n.request.call_id===c&&n.request.cseq===h)return t(482,i,r),!1}else{if(n=s.transactions.nist[i.via_branch])return;for(o in s.transactions.nist)if((n=s.transactions.nist[o]).request.from_tag===a&&n.request.call_id===c&&n.request.cseq===h)return t(482,i,r),!1}}),r.push(function(e,t){if(e.getHeaders("via").length>1)return t.getLogger("sip.sanitycheck").warn("More than one Via header field present in the response. Dropping the response"),!1}),r.push(function(e,t){var i=t.configuration.viaHost;if(e.via.host!==i||void 0!==e.via.port)return t.getLogger("sip.sanitycheck").warn("Via sent-by in the response does not match UA Via host value. Dropping the response"),!1}),r.push(function(t,i){if(e.Utils.str_utf8_length(t.body)<t.getHeader("content-length"))return i.getLogger("sip.sanitycheck").warn("Message body length is lower than the value in Content-Length header field. Dropping the response"),!1}),n.push(function(e,t){for(var i=["from","to","call_id","cseq","via"],s=i.length;s--;)if(!e.hasHeader(i[s]))return t.getLogger("sip.sanitycheck").warn("Missing mandatory header field : "+i[s]+". Dropping the response"),!1}),i=function(t,i,o){var a;for(a=n.length;a--;)if(!1===n[a](t,i,o))return!1;if(t instanceof e.IncomingRequest){for(a=s.length;a--;)if(!1===s[a](t,i,o))return!1}else if(t instanceof e.IncomingResponse)for(a=r.length;a--;)if(!1===r[a](t,i,o))return!1;return!0},e.sanityCheck=i}},function(e,t,i){"use strict";e.exports=function(e){var t;return t=function(e){this.logger=e.getLogger("sipjs.digestauthentication"),this.username=e.configuration.authorizationUser,this.password=e.configuration.password,this.cnonce=null,this.nc=0,this.ncHex="00000000",this.response=null},t.prototype.authenticate=function(t,i){if(this.algorithm=i.algorithm,this.realm=i.realm,this.nonce=i.nonce,this.opaque=i.opaque,this.stale=i.stale,this.algorithm){if("MD5"!==this.algorithm)return this.logger.warn('challenge with Digest algorithm different than "MD5", authentication aborted'),!1}else this.algorithm="MD5";if(!this.realm)return this.logger.warn("challenge without Digest realm, authentication aborted"),!1;if(!this.nonce)return this.logger.warn("challenge without Digest nonce, authentication aborted"),!1;if(i.qop)if(i.qop.indexOf("auth")>-1)this.qop="auth";else{if(!(i.qop.indexOf("auth-int")>-1))return this.logger.warn('challenge without Digest qop different than "auth" or "auth-int", authentication aborted'),!1;this.qop="auth-int"}else this.qop=null;return this.method=t.method,this.uri=t.ruri,this.cnonce=e.createRandomToken(12),this.nc+=1,this.updateNcHex(),4294967296===this.nc&&(this.nc=1,this.ncHex="00000001"),this.calculateResponse(),!0},t.prototype.calculateResponse=function(){var t,i;t=e.calculateMD5(this.username+":"+this.realm+":"+this.password),"auth"===this.qop?(i=e.calculateMD5(this.method+":"+this.uri),this.response=e.calculateMD5(t+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth:"+i)):"auth-int"===this.qop?(i=e.calculateMD5(this.method+":"+this.uri+":"+e.calculateMD5(this.body?this.body:"")),this.response=e.calculateMD5(t+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth-int:"+i)):null===this.qop&&(i=e.calculateMD5(this.method+":"+this.uri),this.response=e.calculateMD5(t+":"+this.nonce+":"+i))},t.prototype.toString=function(){var e=[];if(!this.response)throw new Error("response field does not exist, cannot generate Authorization header");return e.push("algorithm="+this.algorithm),e.push('username="'+this.username+'"'),e.push('realm="'+this.realm+'"'),e.push('nonce="'+this.nonce+'"'),e.push('uri="'+this.uri+'"'),e.push('response="'+this.response+'"'),this.opaque&&e.push('opaque="'+this.opaque+'"'),this.qop&&(e.push("qop="+this.qop),e.push('cnonce="'+this.cnonce+'"'),e.push("nc="+this.ncHex)),"Digest "+e.join(", ")},t.prototype.updateNcHex=function(){var e=Number(this.nc).toString(16);this.ncHex="00000000".substr(0,8-e.length)+e},t}},function(e,t,i){"use strict";var s=i(42);e.exports=function(e){return{parse:function(t,i){var r={startRule:i,SIP:e};try{s.parse(t,r)}catch(e){r.data=-1}return r.data}}}},function(e,t,i){"use strict";function s(e,t,i,r){this.message=e,this.expected=t,this.found=i,this.location=r,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,s)}!function(e,t){function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i}(s,Error),s.buildMessage=function(e,t){function i(e){return e.charCodeAt(0).toString(16).toUpperCase()}function s(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(e){return"\\x0"+i(e)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(e){return"\\x"+i(e)})}function r(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(e){return"\\x0"+i(e)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(e){return"\\x"+i(e)})}function n(e){return o[e.type](e)}var o={literal:function(e){return'"'+s(e.text)+'"'},class:function(e){var t,i="";for(t=0;t<e.parts.length;t++)i+=e.parts[t]instanceof Array?r(e.parts[t][0])+"-"+r(e.parts[t][1]):r(e.parts[t]);return"["+(e.inverted?"^":"")+i+"]"},any:function(e){return"any character"},end:function(e){return"end of input"},other:function(e){return e.description}};return"Expected "+function(e){var t,i,s=new Array(e.length);for(t=0;t<e.length;t++)s[t]=n(e[t]);if(s.sort(),s.length>0){for(t=1,i=1;t<s.length;t++)s[t-1]!==s[t]&&(s[i]=s[t],i++);s.length=i}switch(s.length){case 1:return s[0];case 2:return s[0]+" or "+s[1];default:return s.slice(0,-1).join(", ")+", or "+s[s.length-1]}}(e)+" but "+function(e){return e?'"'+s(e)+'"':"end of input"}(t)+" found."},e.exports={SyntaxError:s,parse:function(e,t){function i(){return e.substring(S,E)}function r(){return c(S,E)}function n(e,t){return{type:"literal",text:e,ignoreCase:t}}function o(e,t,i){return{type:"class",parts:e,inverted:t,ignoreCase:i}}function a(t){var i,s=y[t];if(s)return s;for(i=t-1;!y[i];)i--;for(s={line:(s=y[i]).line,column:s.column};i<t;)10===e.charCodeAt(i)?(s.line++,s.column=1):s.column++,i++;return y[t]=s,s}function c(e,t){var i=a(e),s=a(t);return{start:{offset:e,line:i.line,column:i.column},end:{offset:t,line:s.line,column:s.column}}}function h(e){E<C||(E>C&&(C=E,A=[]),A.push(e))}function u(e,t,i){return new s(s.buildMessage(e,t),e,t,i)}function l(e){var t,i=new Array(e.length);for(t=0;t<e.length;t++)i[t]=e.charCodeAt(t)-32;return i}function d(t){for(var i,s,r=v[t],n=0,o=[],a=r.length,c=[],u=[];;){for(;n<a;)switch(r[n]){case 0:u.push(_[r[n+1]]),n+=2;break;case 1:u.push(void 0),n++;break;case 2:u.push(null),n++;break;case 3:u.push(g),n++;break;case 4:u.push([]),n++;break;case 5:u.push(E),n++;break;case 6:u.pop(),n++;break;case 7:E=u.pop(),n++;break;case 8:u.length-=r[n+1],n+=2;break;case 9:u.splice(-2,1),n++;break;case 10:u[u.length-2].push(u.pop()),n++;break;case 11:u.push(u.splice(u.length-r[n+1],r[n+1])),n+=2;break;case 12:u.push(e.substring(u.pop(),E)),n++;break;case 13:c.push(a),o.push(n+3+r[n+1]+r[n+2]),u[u.length-1]?(a=n+3+r[n+1],n+=3):(a=n+3+r[n+1]+r[n+2],n+=3+r[n+1]);break;case 14:c.push(a),o.push(n+3+r[n+1]+r[n+2]),u[u.length-1]===g?(a=n+3+r[n+1],n+=3):(a=n+3+r[n+1]+r[n+2],n+=3+r[n+1]);break;case 15:c.push(a),o.push(n+3+r[n+1]+r[n+2]),u[u.length-1]!==g?(a=n+3+r[n+1],n+=3):(a=n+3+r[n+1]+r[n+2],n+=3+r[n+1]);break;case 16:u[u.length-1]!==g?(c.push(a),o.push(n),a=n+2+r[n+1],n+=2):n+=2+r[n+1];break;case 17:c.push(a),o.push(n+3+r[n+1]+r[n+2]),e.length>E?(a=n+3+r[n+1],n+=3):(a=n+3+r[n+1]+r[n+2],n+=3+r[n+1]);break;case 18:c.push(a),o.push(n+4+r[n+2]+r[n+3]),e.substr(E,_[r[n+1]].length)===_[r[n+1]]?(a=n+4+r[n+2],n+=4):(a=n+4+r[n+2]+r[n+3],n+=4+r[n+2]);break;case 19:c.push(a),o.push(n+4+r[n+2]+r[n+3]),e.substr(E,_[r[n+1]].length).toLowerCase()===_[r[n+1]]?(a=n+4+r[n+2],n+=4):(a=n+4+r[n+2]+r[n+3],n+=4+r[n+2]);break;case 20:c.push(a),o.push(n+4+r[n+2]+r[n+3]),_[r[n+1]].test(e.charAt(E))?(a=n+4+r[n+2],n+=4):(a=n+4+r[n+2]+r[n+3],n+=4+r[n+2]);break;case 21:u.push(e.substr(E,r[n+1])),E+=r[n+1],n+=2;break;case 22:u.push(_[r[n+1]]),E+=_[r[n+1]].length,n+=2;break;case 23:u.push(g),0===R&&h(_[r[n+1]]),n+=2;break;case 24:S=u[u.length-1-r[n+1]],n+=2;break;case 25:S=E,n++;break;case 26:for(i=r.slice(n+4,n+4+r[n+3]),s=0;s<r[n+3];s++)i[s]=u[u.length-1-i[s]];u.splice(u.length-r[n+2],r[n+2],_[r[n+1]].apply(null,i)),n+=4+r[n+3];break;case 27:u.push(d(r[n+1])),n+=2;break;case 28:R++,n++;break;case 29:R--,n++;break;default:throw new Error("Invalid opcode: "+r[n]+".")}if(!(c.length>0))break;a=c.pop(),n=o.pop()}return u[0]}function p(e,t){return[e].concat(t)}t=void 0!==t?t:{};var f,g={},m={Contact:118,Name_Addr_Header:155,Record_Route:175,Request_Response:81,SIP_URI:45,Subscription_State:185,Supported:190,Require:181,Via:193,absoluteURI:84,Call_ID:117,Content_Disposition:129,Content_Length:134,Content_Type:135,CSeq:145,displayName:121,Event:148,From:150,host:52,Max_Forwards:153,Min_SE:212,Proxy_Authenticate:156,quoted_string:40,Refer_To:177,Replaces:178,Session_Expires:209,stun_URI:216,To:191,turn_URI:222,uuid:225,WWW_Authenticate:208,challenge:157},T=118,_=["\r\n",n("\r\n",!1),/^[0-9]/,o([["0","9"]],!1,!1),/^[a-zA-Z]/,o([["a","z"],["A","Z"]],!1,!1),/^[0-9a-fA-F]/,o([["0","9"],["a","f"],["A","F"]],!1,!1),/^[\0-\xFF]/,o([["\0","\xff"]],!1,!1),/^["]/,o(['"'],!1,!1)," ",n(" ",!1),"\t",n("\t",!1),/^[a-zA-Z0-9]/,o([["a","z"],["A","Z"],["0","9"]],!1,!1),";",n(";",!1),"/",n("/",!1),"?",n("?",!1),":",n(":",!1),"@",n("@",!1),"&",n("&",!1),"=",n("=",!1),"+",n("+",!1),"$",n("$",!1),",",n(",",!1),"-",n("-",!1),"_",n("_",!1),".",n(".",!1),"!",n("!",!1),"~",n("~",!1),"*",n("*",!1),"'",n("'",!1),"(",n("(",!1),")",n(")",!1),"%",n("%",!1),function(){return" "},function(){return":"},/^[!-~]/,o([["!","~"]],!1,!1),/^[\x80-\uFFFF]/,o([["\x80","\uffff"]],!1,!1),/^[\x80-\xBF]/,o([["\x80","\xbf"]],!1,!1),/^[a-f]/,o([["a","f"]],!1,!1),"`",n("`",!1),"<",n("<",!1),">",n(">",!1),"\\",n("\\",!1),"[",n("[",!1),"]",n("]",!1),"{",n("{",!1),"}",n("}",!1),function(){return"*"},function(){return"/"},function(){return"="},function(){return"("},function(){return")"},function(){return">"},function(){return"<"},function(){return","},function(){return";"},function(){return":"},function(){return'"'},/^[!-']/,o([["!","'"]],!1,!1),/^[*-[]/,o([["*","["]],!1,!1),/^[\]-~]/,o([["]","~"]],!1,!1),function(e){return e},/^[#-[]/,o([["#","["]],!1,!1),/^[\0-\t]/,o([["\0","\t"]],!1,!1),/^[\x0B-\f]/,o([["\v","\f"]],!1,!1),/^[\x0E-\x7F]/,o([["\x0e","\x7f"]],!1,!1),function(){t.data.uri=new t.SIP.URI(t.data.scheme,t.data.user,t.data.host,t.data.port),delete t.data.scheme,delete t.data.user,delete t.data.host,delete t.data.host_type,delete t.data.port},function(){t.data.uri=new t.SIP.URI(t.data.scheme,t.data.user,t.data.host,t.data.port,t.data.uri_params,t.data.uri_headers),delete t.data.scheme,delete t.data.user,delete t.data.host,delete t.data.host_type,delete t.data.port,delete t.data.uri_params,"SIP_URI"===t.startRule&&(t.data=t.data.uri)},"sips",n("sips",!0),"sip",n("sip",!0),function(e){t.data.scheme=e},function(){t.data.user=decodeURIComponent(i().slice(0,-1))},function(){t.data.password=i()},function(){return t.data.host=i(),t.data.host},function(){return t.data.host_type="domain",i()},/^[a-zA-Z0-9_\-]/,o([["a","z"],["A","Z"],["0","9"],"_","-"],!1,!1),/^[a-zA-Z0-9\-]/,o([["a","z"],["A","Z"],["0","9"],"-"],!1,!1),function(){return t.data.host_type="IPv6",i()},"::",n("::",!1),function(){return t.data.host_type="IPv6",i()},function(){return t.data.host_type="IPv4",i()},"25",n("25",!1),/^[0-5]/,o([["0","5"]],!1,!1),"2",n("2",!1),/^[0-4]/,o([["0","4"]],!1,!1),"1",n("1",!1),/^[1-9]/,o([["1","9"]],!1,!1),function(e){return e=parseInt(e.join("")),t.data.port=e,e},"transport=",n("transport=",!0),"udp",n("udp",!0),"tcp",n("tcp",!0),"sctp",n("sctp",!0),"tls",n("tls",!0),function(e){t.data.uri_params||(t.data.uri_params={}),t.data.uri_params.transport=e.toLowerCase()},"user=",n("user=",!0),"phone",n("phone",!0),"ip",n("ip",!0),function(e){t.data.uri_params||(t.data.uri_params={}),t.data.uri_params.user=e.toLowerCase()},"method=",n("method=",!0),function(e){t.data.uri_params||(t.data.uri_params={}),t.data.uri_params.method=e},"ttl=",n("ttl=",!0),function(e){t.data.params||(t.data.params={}),t.data.params.ttl=e},"maddr=",n("maddr=",!0),function(e){t.data.uri_params||(t.data.uri_params={}),t.data.uri_params.maddr=e},"lr",n("lr",!0),function(){t.data.uri_params||(t.data.uri_params={}),t.data.uri_params.lr=void 0},function(e,i){t.data.uri_params||(t.data.uri_params={}),i=null===i?void 0:i[1],t.data.uri_params[e.toLowerCase()]=i&&i.toLowerCase()},function(e,i){e=e.join("").toLowerCase(),i=i.join(""),t.data.uri_headers||(t.data.uri_headers={}),t.data.uri_headers[e]?t.data.uri_headers[e].push(i):t.data.uri_headers[e]=[i]},function(){"Refer_To"===t.startRule&&(t.data.uri=new t.SIP.URI(t.data.scheme,t.data.user,t.data.host,t.data.port,t.data.uri_params,t.data.uri_headers),delete t.data.scheme,delete t.data.user,delete t.data.host,delete t.data.host_type,delete t.data.port,delete t.data.uri_params)},"//",n("//",!1),function(){t.data.scheme=i()},n("SIP",!0),function(){t.data.sip_version=i()},"INVITE",n("INVITE",!1),"ACK",n("ACK",!1),"VXACH",n("VXACH",!1),"OPTIONS",n("OPTIONS",!1),"BYE",n("BYE",!1),"CANCEL",n("CANCEL",!1),"REGISTER",n("REGISTER",!1),"SUBSCRIBE",n("SUBSCRIBE",!1),"NOTIFY",n("NOTIFY",!1),"REFER",n("REFER",!1),function(){return t.data.method=i(),t.data.method},function(e){t.data.status_code=parseInt(e.join(""))},function(){t.data.reason_phrase=i()},function(){t.data=i()},function(){var e,i;for(i=t.data.multi_header.length,e=0;e<i;e++)if(null===t.data.multi_header[e].parsed){t.data=null;break}null!==t.data?t.data=t.data.multi_header:t.data=-1},function(){var e;t.data.multi_header||(t.data.multi_header=[]);try{e=new t.SIP.NameAddrHeader(t.data.uri,t.data.displayName,t.data.params),delete t.data.uri,delete t.data.displayName,delete t.data.params}catch(t){e=null}t.data.multi_header.push({position:E,offset:r().start.offset,parsed:e})},function(e){'"'===(e=i().trim())[0]&&(e=e.substring(1,e.length-1)),t.data.displayName=e},"q",n("q",!0),function(e){t.data.params||(t.data.params={}),t.data.params.q=e},"expires",n("expires",!0),function(e){t.data.params||(t.data.params={}),t.data.params.expires=e},function(e){return parseInt(e.join(""))},"0",n("0",!1),function(){return parseFloat(i())},function(e,i){t.data.params||(t.data.params={}),i=null===i?void 0:i[1],t.data.params[e.toLowerCase()]=i},"render",n("render",!0),"session",n("session",!0),"icon",n("icon",!0),"alert",n("alert",!0),function(){"Content_Disposition"===t.startRule&&(t.data.type=i().toLowerCase())},"handling",n("handling",!0),"optional",n("optional",!0),"required",n("required",!0),function(e){t.data=parseInt(e.join(""))},function(){t.data=i()},"text",n("text",!0),"image",n("image",!0),"audio",n("audio",!0),"video",n("video",!0),"application",n("application",!0),"message",n("message",!0),"multipart",n("multipart",!0),"x-",n("x-",!0),function(e){t.data.value=parseInt(e.join(""))},function(e){t.data=e},function(e){t.data.event=e.toLowerCase()},function(){var e=t.data.tag;t.data=new t.SIP.NameAddrHeader(t.data.uri,t.data.displayName,t.data.params),e&&t.data.setParam("tag",e)},"tag",n("tag",!0),function(e){t.data.tag=e},function(e){t.data=parseInt(e.join(""))},function(e){t.data=e},function(){t.data=new t.SIP.NameAddrHeader(t.data.uri,t.data.displayName,t.data.params)},"digest",n("Digest",!0),"realm",n("realm",!0),function(e){t.data.realm=e},"domain",n("domain",!0),"nonce",n("nonce",!0),function(e){t.data.nonce=e},"opaque",n("opaque",!0),function(e){t.data.opaque=e},"stale",n("stale",!0),"true",n("true",!0),function(){t.data.stale=!0},"false",n("false",!0),function(){t.data.stale=!1},"algorithm",n("algorithm",!0),"md5",n("MD5",!0),"md5-sess",n("MD5-sess",!0),function(e){t.data.algorithm=e.toUpperCase()},"qop",n("qop",!0),"auth-int",n("auth-int",!0),"auth",n("auth",!0),function(e){t.data.qop||(t.data.qop=[]),t.data.qop.push(e.toLowerCase())},function(e){t.data.value=parseInt(e.join(""))},function(){var e,i;for(i=t.data.multi_header.length,e=0;e<i;e++)if(null===t.data.multi_header[e].parsed){t.data=null;break}null!==t.data?t.data=t.data.multi_header:t.data=-1},function(){var e;t.data.multi_header||(t.data.multi_header=[]);try{e=new t.SIP.NameAddrHeader(t.data.uri,t.data.displayName,t.data.params),delete t.data.uri,delete t.data.displayName,delete t.data.params}catch(t){e=null}t.data.multi_header.push({position:E,offset:r().start.offset,parsed:e})},function(){t.data=new t.SIP.NameAddrHeader(t.data.uri,t.data.displayName,t.data.params)},function(){t.data.replaces_from_tag&&t.data.replaces_to_tag||(t.data=-1)},function(){t.data={call_id:t.data}},"from-tag",n("from-tag",!0),function(e){t.data.replaces_from_tag=e},"to-tag",n("to-tag",!0),function(e){t.data.replaces_to_tag=e},"early-only",n("early-only",!0),function(){t.data.early_only=!0},function(e,t){return t},function(e,t){return p(e,t)},function(e){"Require"===t.startRule&&(t.data=e||[])},function(e){t.data.value=parseInt(e.join(""))},"active",n("active",!0),"pending",n("pending",!0),"terminated",n("terminated",!0),function(){t.data.state=i()},"reason",n("reason",!0),function(e){void 0!==e&&(t.data.reason=e)},function(e){void 0!==e&&(t.data.expires=e)},"retry_after",n("retry_after",!0),function(e){void 0!==e&&(t.data.retry_after=e)},"deactivated",n("deactivated",!0),"probation",n("probation",!0),"rejected",n("rejected",!0),"timeout",n("timeout",!0),"giveup",n("giveup",!0),"noresource",n("noresource",!0),"invariant",n("invariant",!0),function(e){"Supported"===t.startRule&&(t.data=e||[])},function(){var e=t.data.tag;t.data=new t.SIP.NameAddrHeader(t.data.uri,t.data.displayName,t.data.params),e&&t.data.setParam("tag",e)},"ttl",n("ttl",!0),function(e){t.data.ttl=e},"maddr",n("maddr",!0),function(e){t.data.maddr=e},"received",n("received",!0),function(e){t.data.received=e},"branch",n("branch",!0),function(e){t.data.branch=e},"rport",n("rport",!0),function(){"undefined"!=typeof response_port&&(t.data.rport=response_port.join(""))},function(e){t.data.protocol=e},n("UDP",!0),n("TCP",!0),n("TLS",!0),n("SCTP",!0),function(e){t.data.transport=e},function(){t.data.host=i()},function(e){t.data.port=parseInt(e.join(""))},function(e){return parseInt(e.join(""))},function(e){"Session_Expires"===t.startRule&&(t.data.deltaSeconds=e)},"refresher",n("refresher",!1),"uas",n("uas",!1),"uac",n("uac",!1),function(e){"Session_Expires"===t.startRule&&(t.data.refresher=e)},function(e){"Min_SE"===t.startRule&&(t.data=e)},"stuns",n("stuns",!0),"stun",n("stun",!0),function(e){t.data.scheme=e},function(e){t.data.host=e},"?transport=",n("?transport=",!1),"turns",n("turns",!0),"turn",n("turn",!0),function(){t.data.transport=transport},function(){t.data=i()}],v=[l('2 ""6 7!'),l('4"""5!7#'),l('4$""5!7%'),l('4&""5!7\''),l(";'.# &;("),l('4(""5!7)'),l('4*""5!7+'),l('2,""6,7-'),l('2.""6.7/'),l('40""5!71'),l('22""6273.\x89 &24""6475.} &26""6677.q &28""6879.e &2:""6:7;.Y &2<""6<7=.M &2>""6>7?.A &2@""6@7A.5 &2B""6B7C.) &2D""6D7E'),l(";).# &;,"),l('2F""6F7G.} &2H""6H7I.q &2J""6J7K.e &2L""6L7M.Y &2N""6N7O.M &2P""6P7Q.A &2R""6R7S.5 &2T""6T7U.) &2V""6V7W'),l('%%2X""6X7Y/5#;#/,$;#/#$+#)(#\'#("\'#&\'#/"!&,)'),l('%%$;$0#*;$&/,#; /#$+")("\'#&\'#." &"/=#$;$/&#0#*;$&&&#/\'$8":Z" )("\'#&\'#'),l(';.." &"'),l("%$;'.# &;(0)*;'.# &;(&/?#28\"\"6879/0$;//'$8#:[# )(#'#(\"'#&'#"),l('%%$;2/&#0#*;2&&&#/g#$%$;.0#*;.&/,#;2/#$+")("\'#&\'#0=*%$;.0#*;.&/,#;2/#$+")("\'#&\'#&/#$+")("\'#&\'#/"!&,)'),l('4\\""5!7].# &;3'),l('4^""5!7_'),l('4`""5!7a'),l(';!.) &4b""5!7c'),l('%$;).\x95 &2F""6F7G.\x89 &2J""6J7K.} &2L""6L7M.q &2X""6X7Y.e &2P""6P7Q.Y &2H""6H7I.M &2@""6@7A.A &2d""6d7e.5 &2R""6R7S.) &2N""6N7O/\x9e#0\x9b*;).\x95 &2F""6F7G.\x89 &2J""6J7K.} &2L""6L7M.q &2X""6X7Y.e &2P""6P7Q.Y &2H""6H7I.M &2@""6@7A.A &2d""6d7e.5 &2R""6R7S.) &2N""6N7O&&&#/"!&,)'),l('%$;).\x89 &2F""6F7G.} &2L""6L7M.q &2X""6X7Y.e &2P""6P7Q.Y &2H""6H7I.M &2@""6@7A.A &2d""6d7e.5 &2R""6R7S.) &2N""6N7O/\x92#0\x8f*;).\x89 &2F""6F7G.} &2L""6L7M.q &2X""6X7Y.e &2P""6P7Q.Y &2H""6H7I.M &2@""6@7A.A &2d""6d7e.5 &2R""6R7S.) &2N""6N7O&&&#/"!&,)'),l('2T""6T7U.\xe3 &2V""6V7W.\xd7 &2f""6f7g.\xcb &2h""6h7i.\xbf &2:""6:7;.\xb3 &2D""6D7E.\xa7 &22""6273.\x9b &28""6879.\x8f &2j""6j7k.\x83 &;&.} &24""6475.q &2l""6l7m.e &2n""6n7o.Y &26""6677.M &2>""6>7?.A &2p""6p7q.5 &2r""6r7s.) &;\'.# &;('),l('%$;).\u012b &2F""6F7G.\u011f &2J""6J7K.\u0113 &2L""6L7M.\u0107 &2X""6X7Y.\xfb &2P""6P7Q.\xef &2H""6H7I.\xe3 &2@""6@7A.\xd7 &2d""6d7e.\xcb &2R""6R7S.\xbf &2N""6N7O.\xb3 &2T""6T7U.\xa7 &2V""6V7W.\x9b &2f""6f7g.\x8f &2h""6h7i.\x83 &28""6879.w &2j""6j7k.k &;&.e &24""6475.Y &2l""6l7m.M &2n""6n7o.A &26""6677.5 &2p""6p7q.) &2r""6r7s/\u0134#0\u0131*;).\u012b &2F""6F7G.\u011f &2J""6J7K.\u0113 &2L""6L7M.\u0107 &2X""6X7Y.\xfb &2P""6P7Q.\xef &2H""6H7I.\xe3 &2@""6@7A.\xd7 &2d""6d7e.\xcb &2R""6R7S.\xbf &2N""6N7O.\xb3 &2T""6T7U.\xa7 &2V""6V7W.\x9b &2f""6f7g.\x8f &2h""6h7i.\x83 &28""6879.w &2j""6j7k.k &;&.e &24""6475.Y &2l""6l7m.M &2n""6n7o.A &26""6677.5 &2p""6p7q.) &2r""6r7s&&&#/"!&,)'),l("%;//?#2P\"\"6P7Q/0$;//'$8#:t# )(#'#(\"'#&'#"),l("%;//?#24\"\"6475/0$;//'$8#:u# )(#'#(\"'#&'#"),l("%;//?#2>\"\"6>7?/0$;//'$8#:v# )(#'#(\"'#&'#"),l("%;//?#2T\"\"6T7U/0$;//'$8#:w# )(#'#(\"'#&'#"),l("%;//?#2V\"\"6V7W/0$;//'$8#:x# )(#'#(\"'#&'#"),l('%2h""6h7i/0#;//\'$8":y" )("\'#&\'#'),l('%;//6#2f""6f7g/\'$8":z" )("\'#&\'#'),l("%;//?#2D\"\"6D7E/0$;//'$8#:{# )(#'#(\"'#&'#"),l("%;//?#22\"\"6273/0$;//'$8#:|# )(#'#(\"'#&'#"),l("%;//?#28\"\"6879/0$;//'$8#:}# )(#'#(\"'#&'#"),l("%;//0#;&/'$8\":~\" )(\"'#&'#"),l("%;&/0#;//'$8\":~\" )(\"'#&'#"),l("%;=/T#$;G.) &;K.# &;F0/*;G.) &;K.# &;F&/,$;>/#$+#)(#'#(\"'#&'#"),l('4\x7f""5!7\x80.A &4\x81""5!7\x82.5 &4\x83""5!7\x84.) &;3.# &;.'),l("%%;//Q#;&/H$$;J.# &;K0)*;J.# &;K&/,$;&/#$+$)($'#(#'#(\"'#&'#/\"!&,)"),l("%;//]#;&/T$%$;J.# &;K0)*;J.# &;K&/\"!&,)/1$;&/($8$:\x85$!!)($'#(#'#(\"'#&'#"),l(';..G &2L""6L7M.; &4\x86""5!7\x87./ &4\x83""5!7\x84.# &;3'),l('%2j""6j7k/J#4\x88""5!7\x89.5 &4\x8a""5!7\x8b.) &4\x8c""5!7\x8d/#$+")("\'#&\'#'),l("%;N/M#28\"\"6879/>$;O.\" &\"/0$;S/'$8$:\x8e$ )($'#(#'#(\"'#&'#"),l("%;N/d#28\"\"6879/U$;O.\" &\"/G$;S/>$;_/5$;l.\" &\"/'$8&:\x8f& )(&'#(%'#($'#(#'#(\"'#&'#"),l('%3\x90""5$7\x91.) &3\x92""5#7\x93/\' 8!:\x94!! )'),l('%;P/]#%28""6879/,#;R/#$+")("\'#&\'#." &"/6$2:""6:7;/\'$8#:\x95# )(#\'#("\'#&\'#'),l("$;+.) &;-.# &;Q/2#0/*;+.) &;-.# &;Q&&&#"),l('2<""6<7=.q &2>""6>7?.e &2@""6@7A.Y &2B""6B7C.M &2D""6D7E.A &22""6273.5 &26""6677.) &24""6475'),l('%$;+._ &;-.Y &2<""6<7=.M &2>""6>7?.A &2@""6@7A.5 &2B""6B7C.) &2D""6D7E0e*;+._ &;-.Y &2<""6<7=.M &2>""6>7?.A &2@""6@7A.5 &2B""6B7C.) &2D""6D7E&/& 8!:\x96! )'),l('%;T/J#%28""6879/,#;^/#$+")("\'#&\'#." &"/#$+")("\'#&\'#'),l("%;U.) &;\\.# &;X/& 8!:\x97! )"),l('%$%;V/2#2J""6J7K/#$+")("\'#&\'#0<*%;V/2#2J""6J7K/#$+")("\'#&\'#&/D#;W/;$2J""6J7K." &"/\'$8#:\x98# )(#\'#("\'#&\'#'),l('$4\x99""5!7\x9a/,#0)*4\x99""5!7\x9a&&&#'),l('%4$""5!7%/?#$4\x9b""5!7\x9c0)*4\x9b""5!7\x9c&/#$+")("\'#&\'#'),l('%2l""6l7m/?#;Y/6$2n""6n7o/\'$8#:\x9d# )(#\'#("\'#&\'#'),l('%%;Z/\xb3#28""6879/\xa4$;Z/\x9b$28""6879/\x8c$;Z/\x83$28""6879/t$;Z/k$28""6879/\\$;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$+-)(-\'#(,\'#(+\'#(*\'#()\'#((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.\u0790 &%2\x9e""6\x9e7\x9f/\xa4#;Z/\x9b$28""6879/\x8c$;Z/\x83$28""6879/t$;Z/k$28""6879/\\$;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$+,)(,\'#(+\'#(*\'#()\'#((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.\u06f9 &%2\x9e""6\x9e7\x9f/\x8c#;Z/\x83$28""6879/t$;Z/k$28""6879/\\$;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$+*)(*\'#()\'#((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.\u067a &%2\x9e""6\x9e7\x9f/t#;Z/k$28""6879/\\$;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$+()((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.\u0613 &%2\x9e""6\x9e7\x9f/\\#;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$+&)(&\'#(%\'#($\'#(#\'#("\'#&\'#.\u05c4 &%2\x9e""6\x9e7\x9f/D#;Z/;$28""6879/,$;[/#$+$)($\'#(#\'#("\'#&\'#.\u058d &%2\x9e""6\x9e7\x9f/,#;[/#$+")("\'#&\'#.\u056e &%2\x9e""6\x9e7\x9f/,#;Z/#$+")("\'#&\'#.\u054f &%;Z/\x9b#2\x9e""6\x9e7\x9f/\x8c$;Z/\x83$28""6879/t$;Z/k$28""6879/\\$;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$++)(+\'#(*\'#()\'#((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.\u04c7 &%;Z/\xaa#%28""6879/,#;Z/#$+")("\'#&\'#." &"/\x83$2\x9e""6\x9e7\x9f/t$;Z/k$28""6879/\\$;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$+*)(*\'#()\'#((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.\u0430 &%;Z/\xb9#%28""6879/,#;Z/#$+")("\'#&\'#." &"/\x92$%28""6879/,#;Z/#$+")("\'#&\'#." &"/k$2\x9e""6\x9e7\x9f/\\$;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$+))()\'#((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.\u038a &%;Z/\xc8#%28""6879/,#;Z/#$+")("\'#&\'#." &"/\xa1$%28""6879/,#;Z/#$+")("\'#&\'#." &"/z$%28""6879/,#;Z/#$+")("\'#&\'#." &"/S$2\x9e""6\x9e7\x9f/D$;Z/;$28""6879/,$;[/#$+()((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.\u02d5 &%;Z/\xd7#%28""6879/,#;Z/#$+")("\'#&\'#." &"/\xb0$%28""6879/,#;Z/#$+")("\'#&\'#." &"/\x89$%28""6879/,#;Z/#$+")("\'#&\'#." &"/b$%28""6879/,#;Z/#$+")("\'#&\'#." &"/;$2\x9e""6\x9e7\x9f/,$;[/#$+\')(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.\u0211 &%;Z/\xfe#%28""6879/,#;Z/#$+")("\'#&\'#." &"/\xd7$%28""6879/,#;Z/#$+")("\'#&\'#." &"/\xb0$%28""6879/,#;Z/#$+")("\'#&\'#." &"/\x89$%28""6879/,#;Z/#$+")("\'#&\'#." &"/b$%28""6879/,#;Z/#$+")("\'#&\'#." &"/;$2\x9e""6\x9e7\x9f/,$;Z/#$+()((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.\u0126 &%;Z/\u011c#%28""6879/,#;Z/#$+")("\'#&\'#." &"/\xf5$%28""6879/,#;Z/#$+")("\'#&\'#." &"/\xce$%28""6879/,#;Z/#$+")("\'#&\'#." &"/\xa7$%28""6879/,#;Z/#$+")("\'#&\'#." &"/\x80$%28""6879/,#;Z/#$+")("\'#&\'#." &"/Y$%28""6879/,#;Z/#$+")("\'#&\'#." &"/2$2\x9e""6\x9e7\x9f/#$+()((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#/& 8!:\xa0! )'),l('%;#/M#;#." &"/?$;#." &"/1$;#." &"/#$+$)($\'#(#\'#("\'#&\'#'),l("%;Z/;#28\"\"6879/,$;Z/#$+#)(#'#(\"'#&'#.# &;\\"),l("%;]/o#2J\"\"6J7K/`$;]/W$2J\"\"6J7K/H$;]/?$2J\"\"6J7K/0$;]/'$8':\xa1' )(''#(&'#(%'#($'#(#'#(\"'#&'#"),l('%2\xa2""6\xa27\xa3/2#4\xa4""5!7\xa5/#$+")("\'#&\'#.\x98 &%2\xa6""6\xa67\xa7/;#4\xa8""5!7\xa9/,$;!/#$+#)(#\'#("\'#&\'#.j &%2\xaa""6\xaa7\xab/5#;!/,$;!/#$+#)(#\'#("\'#&\'#.B &%4\xac""5!7\xad/,#;!/#$+")("\'#&\'#.# &;!'),l('%%;!." &"/[#;!." &"/M$;!." &"/?$;!." &"/1$;!." &"/#$+%)(%\'#($\'#(#\'#("\'#&\'#/\' 8!:\xae!! )'),l('$%22""6273/,#;`/#$+")("\'#&\'#0<*%22""6273/,#;`/#$+")("\'#&\'#&'),l(";a.A &;b.; &;c.5 &;d./ &;e.) &;f.# &;g"),l('%3\xaf""5*7\xb0/a#3\xb1""5#7\xb2.G &3\xb3""5#7\xb4.; &3\xb5""5$7\xb6./ &3\xb7""5#7\xb8.# &;6/($8":\xb9"! )("\'#&\'#'),l('%3\xba""5%7\xbb/I#3\xbc""5%7\xbd./ &3\xbe""5"7\xbf.# &;6/($8":\xc0"! )("\'#&\'#'),l('%3\xc1""5\'7\xc2/1#;\x8f/($8":\xc3"! )("\'#&\'#'),l('%3\xc4""5$7\xc5/1#;\xef/($8":\xc6"! )("\'#&\'#'),l('%3\xc7""5&7\xc8/1#;T/($8":\xc9"! )("\'#&\'#'),l('%3\xca""5"7\xcb/N#%2>""6>7?/,#;6/#$+")("\'#&\'#." &"/\'$8":\xcc" )("\'#&\'#'),l('%;h/P#%2>""6>7?/,#;i/#$+")("\'#&\'#." &"/)$8":\xcd""! )("\'#&\'#'),l('%$;j/&#0#*;j&&&#/"!&,)'),l('%$;j/&#0#*;j&&&#/"!&,)'),l(";k.) &;+.# &;-"),l('2l""6l7m.e &2n""6n7o.Y &24""6475.M &28""6879.A &2<""6<7=.5 &2@""6@7A.) &2B""6B7C'),l('%26""6677/n#;m/e$$%2<""6<7=/,#;m/#$+")("\'#&\'#0<*%2<""6<7=/,#;m/#$+")("\'#&\'#&/#$+#)(#\'#("\'#&\'#'),l('%;n/A#2>""6>7?/2$;o/)$8#:\xce#"" )(#\'#("\'#&\'#'),l("$;p.) &;+.# &;-/2#0/*;p.) &;+.# &;-&&&#"),l("$;p.) &;+.# &;-0/*;p.) &;+.# &;-&"),l('2l""6l7m.e &2n""6n7o.Y &24""6475.M &26""6677.A &28""6879.5 &2@""6@7A.) &2B""6B7C'),l(";\x90.# &;r"),l("%;\x8f/G#;'/>$;s/5$;'/,$;\x84/#$+%)(%'#($'#(#'#(\"'#&'#"),l(";M.# &;t"),l("%;\x7f/E#28\"\"6879/6$;u.# &;x/'$8#:\xcf# )(#'#(\"'#&'#"),l('%;v.# &;w/J#%26""6677/,#;\x83/#$+")("\'#&\'#." &"/#$+")("\'#&\'#'),l('%2\xd0""6\xd07\xd1/:#;\x80/1$;w." &"/#$+#)(#\'#("\'#&\'#'),l('%24""6475/,#;{/#$+")("\'#&\'#'),l("%;z/3#$;y0#*;y&/#$+\")(\"'#&'#"),l(";*.) &;+.# &;-"),l(';+.\x8f &;-.\x89 &22""6273.} &26""6677.q &28""6879.e &2:""6:7;.Y &2<""6<7=.M &2>""6>7?.A &2@""6@7A.5 &2B""6B7C.) &2D""6D7E'),l('%;|/e#$%24""6475/,#;|/#$+")("\'#&\'#0<*%24""6475/,#;|/#$+")("\'#&\'#&/#$+")("\'#&\'#'),l('%$;~0#*;~&/e#$%22""6273/,#;}/#$+")("\'#&\'#0<*%22""6273/,#;}/#$+")("\'#&\'#&/#$+")("\'#&\'#'),l("$;~0#*;~&"),l(';+.w &;-.q &28""6879.e &2:""6:7;.Y &2<""6<7=.M &2>""6>7?.A &2@""6@7A.5 &2B""6B7C.) &2D""6D7E'),l('%%;"/\x87#$;".G &;!.A &2@""6@7A.5 &2F""6F7G.) &2J""6J7K0M*;".G &;!.A &2@""6@7A.5 &2F""6F7G.) &2J""6J7K&/#$+")("\'#&\'#/& 8!:\xd2! )'),l(";\x81.# &;\x82"),l('%%;O/2#2:""6:7;/#$+")("\'#&\'#." &"/,#;S/#$+")("\'#&\'#." &"'),l('$;+.\x83 &;-.} &2B""6B7C.q &2D""6D7E.e &22""6273.Y &28""6879.M &2:""6:7;.A &2<""6<7=.5 &2>""6>7?.) &2@""6@7A/\x8c#0\x89*;+.\x83 &;-.} &2B""6B7C.q &2D""6D7E.e &22""6273.Y &28""6879.M &2:""6:7;.A &2<""6<7=.5 &2>""6>7?.) &2@""6@7A&&&#'),l("$;y0#*;y&"),l('%3\x92""5#7\xd3/q#24""6475/b$$;!/&#0#*;!&&&#/L$2J""6J7K/=$$;!/&#0#*;!&&&#/\'$8%:\xd4% )(%\'#($\'#(#\'#("\'#&\'#'),l('2\xd5""6\xd57\xd6'),l('2\xd7""6\xd77\xd8'),l('2\xd9""6\xd97\xda'),l('2\xdb""6\xdb7\xdc'),l('2\xdd""6\xdd7\xde'),l('2\xdf""6\xdf7\xe0'),l('2\xe1""6\xe17\xe2'),l('2\xe3""6\xe37\xe4'),l('2\xe5""6\xe57\xe6'),l('2\xe7""6\xe77\xe8'),l("%;\x85.S &;\x86.M &;\x88.G &;\x89.A &;\x8a.; &;\x8b.5 &;\x8c./ &;\x8d.) &;\x8e.# &;6/& 8!:\xe9! )"),l("%;\x84/G#;'/>$;\x91/5$;'/,$;\x93/#$+%)(%'#($'#(#'#(\"'#&'#"),l("%;\x92/' 8!:\xea!! )"),l("%;!/5#;!/,$;!/#$+#)(#'#(\"'#&'#"),l("%$;*.A &;+.; &;-.5 &;3./ &;4.) &;'.# &;(0G*;*.A &;+.; &;-.5 &;3./ &;4.) &;'.# &;(&/& 8!:\xeb! )"),l("%;\xb5/Y#$%;A/,#;\xb5/#$+\")(\"'#&'#06*%;A/,#;\xb5/#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),l('%;9/N#%2:""6:7;/,#;9/#$+")("\'#&\'#." &"/\'$8":\xec" )("\'#&\'#'),l("%;:.c &%;\x97/Y#$%;A/,#;\x97/#$+\")(\"'#&'#06*%;A/,#;\x97/#$+\")(\"'#&'#&/#$+\")(\"'#&'#/& 8!:\xed! )"),l("%;L.# &;\x98/]#$%;B/,#;\x9a/#$+\")(\"'#&'#06*%;B/,#;\x9a/#$+\")(\"'#&'#&/'$8\":\xee\" )(\"'#&'#"),l("%;\x99.\" &\"/>#;@/5$;M/,$;?/#$+$)($'#(#'#(\"'#&'#"),l("%%;6/Y#$%;./,#;6/#$+\")(\"'#&'#06*%;./,#;6/#$+\")(\"'#&'#&/#$+\")(\"'#&'#.# &;H/' 8!:\xef!! )"),l(";\x9b.) &;\x9c.# &;\x9f"),l("%3\xf0\"\"5!7\xf1/:#;</1$;\x9e/($8#:\xf2#! )(#'#(\"'#&'#"),l("%3\xf3\"\"5'7\xf4/:#;</1$;\x9d/($8#:\xf5#! )(#'#(\"'#&'#"),l("%$;!/&#0#*;!&&&#/' 8!:\xf6!! )"),l('%2\xf7""6\xf77\xf8/o#%2J""6J7K/M#;!." &"/?$;!." &"/1$;!." &"/#$+$)($\'#(#\'#("\'#&\'#." &"/\'$8":\xf9" )("\'#&\'#'),l('%;6/J#%;</,#;\xa0/#$+")("\'#&\'#." &"/)$8":\xfa""! )("\'#&\'#'),l(";6.) &;T.# &;H"),l("%;\xa2/Y#$%;B/,#;\xa3/#$+\")(\"'#&'#06*%;B/,#;\xa3/#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),l('%3\xfb""5&7\xfc.G &3\xfd""5\'7\xfe.; &3\xff""5$7\u0100./ &3\u0101""5%7\u0102.# &;6/& 8!:\u0103! )'),l(";\xa4.# &;\x9f"),l('%3\u0104""5(7\u0105/M#;</D$3\u0106""5(7\u0107./ &3\u0108""5(7\u0109.# &;6/#$+#)(#\'#("\'#&\'#'),l("%;6/Y#$%;A/,#;6/#$+\")(\"'#&'#06*%;A/,#;6/#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),l("%$;!/&#0#*;!&&&#/' 8!:\u010a!! )"),l("%;\xa8/& 8!:\u010b! )"),l("%;\xa9/k#;;/b$;\xae/Y$$%;B/,#;\xaf/#$+\")(\"'#&'#06*%;B/,#;\xaf/#$+\")(\"'#&'#&/#$+$)($'#(#'#(\"'#&'#"),l(";\xaa.# &;\xab"),l('3\u010c""5$7\u010d.S &3\u010e""5%7\u010f.G &3\u0110""5%7\u0111.; &3\u0112""5%7\u0113./ &3\u0114""5+7\u0115.# &;\xac'),l('3\u0116""5\'7\u0117./ &3\u0118""5)7\u0119.# &;\xac'),l(";6.# &;\xad"),l('%3\u011a""5"7\u011b/,#;6/#$+")("\'#&\'#'),l(";\xac.# &;6"),l("%;6/5#;</,$;\xb0/#$+#)(#'#(\"'#&'#"),l(";6.# &;H"),l("%;\xb2/5#;./,$;\x8f/#$+#)(#'#(\"'#&'#"),l("%$;!/&#0#*;!&&&#/' 8!:\u011c!! )"),l("%;\x9d/' 8!:\u011d!! )"),l('%;\xb5/^#$%;B/,#;\x9f/#$+")("\'#&\'#06*%;B/,#;\x9f/#$+")("\'#&\'#&/($8":\u011e"!!)("\'#&\'#'),l('%%;7/e#$%2J""6J7K/,#;7/#$+")("\'#&\'#0<*%2J""6J7K/,#;7/#$+")("\'#&\'#&/#$+")("\'#&\'#/"!&,)'),l("%;L.# &;\x98/]#$%;B/,#;\xb7/#$+\")(\"'#&'#06*%;B/,#;\xb7/#$+\")(\"'#&'#&/'$8\":\u011f\" )(\"'#&'#"),l(";\xb8.# &;\x9f"),l("%3\u0120\"\"5#7\u0121/:#;</1$;6/($8#:\u0122#! )(#'#(\"'#&'#"),l("%$;!/&#0#*;!&&&#/' 8!:\u0123!! )"),l("%;\x9d/' 8!:\u0124!! )"),l("%$;\x990#*;\x99&/x#;@/o$;M/f$;?/]$$%;B/,#;\x9f/#$+\")(\"'#&'#06*%;B/,#;\x9f/#$+\")(\"'#&'#&/'$8%:\u0125% )(%'#($'#(#'#(\"'#&'#"),l(";\xbd"),l("%3\u0126\"\"5&7\u0127/k#;./b$;\xc0/Y$$%;A/,#;\xc0/#$+\")(\"'#&'#06*%;A/,#;\xc0/#$+\")(\"'#&'#&/#$+$)($'#(#'#(\"'#&'#.# &;\xbe"),l("%;6/k#;./b$;\xbf/Y$$%;A/,#;\xbf/#$+\")(\"'#&'#06*%;A/,#;\xbf/#$+\")(\"'#&'#&/#$+$)($'#(#'#(\"'#&'#"),l("%;6/;#;</2$;6.# &;H/#$+#)(#'#(\"'#&'#"),l(";\xc1.G &;\xc3.A &;\xc5.; &;\xc7.5 &;\xc8./ &;\xc9.) &;\xca.# &;\xbf"),l("%3\u0128\"\"5%7\u0129/5#;</,$;\xc2/#$+#)(#'#(\"'#&'#"),l("%;I/' 8!:\u012a!! )"),l("%3\u012b\"\"5&7\u012c/\x97#;</\x8e$;D/\x85$;\xc4/|$$%$;'/&#0#*;'&&&#/,#;\xc4/#$+\")(\"'#&'#0C*%$;'/&#0#*;'&&&#/,#;\xc4/#$+\")(\"'#&'#&/,$;E/#$+&)(&'#(%'#($'#(#'#(\"'#&'#"),l(";t.# &;w"),l("%3\u012d\"\"5%7\u012e/5#;</,$;\xc6/#$+#)(#'#(\"'#&'#"),l("%;I/' 8!:\u012f!! )"),l("%3\u0130\"\"5&7\u0131/:#;</1$;I/($8#:\u0132#! )(#'#(\"'#&'#"),l('%3\u0133""5%7\u0134/]#;</T$%3\u0135""5$7\u0136/& 8!:\u0137! ).4 &%3\u0138""5%7\u0139/& 8!:\u013a! )/#$+#)(#\'#("\'#&\'#'),l('%3\u013b""5)7\u013c/R#;</I$3\u013d""5#7\u013e./ &3\u013f""5(7\u0140.# &;6/($8#:\u0141#! )(#\'#("\'#&\'#'),l('%3\u0142""5#7\u0143/\x93#;</\x8a$;D/\x81$%;\xcb/e#$%2D""6D7E/,#;\xcb/#$+")("\'#&\'#0<*%2D""6D7E/,#;\xcb/#$+")("\'#&\'#&/#$+")("\'#&\'#/,$;E/#$+%)(%\'#($\'#(#\'#("\'#&\'#'),l('%3\u0144""5(7\u0145./ &3\u0146""5$7\u0147.# &;6/\' 8!:\u0148!! )'),l("%;6/Y#$%;A/,#;6/#$+\")(\"'#&'#06*%;A/,#;6/#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),l("%;\xce/G#;./>$;\xce/5$;./,$;\x8f/#$+%)(%'#($'#(#'#(\"'#&'#"),l("%$;!/&#0#*;!&&&#/' 8!:\u0149!! )"),l("%;\xd0/]#$%;A/,#;\xd0/#$+\")(\"'#&'#06*%;A/,#;\xd0/#$+\")(\"'#&'#&/'$8\":\u014a\" )(\"'#&'#"),l("%;\x98/]#$%;B/,#;\x9f/#$+\")(\"'#&'#06*%;B/,#;\x9f/#$+\")(\"'#&'#&/'$8\":\u014b\" )(\"'#&'#"),l('%;L.O &;\x98.I &%;@." &"/:#;t/1$;?." &"/#$+#)(#\'#("\'#&\'#/]#$%;B/,#;\x9f/#$+")("\'#&\'#06*%;B/,#;\x9f/#$+")("\'#&\'#&/\'$8":\u014c" )("\'#&\'#'),l("%;\xd3/]#$%;B/,#;\xd4/#$+\")(\"'#&'#06*%;B/,#;\xd4/#$+\")(\"'#&'#&/'$8\":\u014d\" )(\"'#&'#"),l("%;\x95/& 8!:\u014e! )"),l('%3\u014f""5(7\u0150/:#;</1$;6/($8#:\u0151#! )(#\'#("\'#&\'#.g &%3\u0152""5&7\u0153/:#;</1$;6/($8#:\u0154#! )(#\'#("\'#&\'#.: &%3\u0155""5*7\u0156/& 8!:\u0157! ).# &;\x9f'),l('%%;6/k#$%;A/2#;6/)$8":\u0158""$ )("\'#&\'#0<*%;A/2#;6/)$8":\u0158""$ )("\'#&\'#&/)$8":\u0159""! )("\'#&\'#." &"/\' 8!:\u015a!! )'),l("%;\xd7/Y#$%;A/,#;\xd7/#$+\")(\"'#&'#06*%;A/,#;\xd7/#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),l("%;\x98/Y#$%;B/,#;\x9f/#$+\")(\"'#&'#06*%;B/,#;\x9f/#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),l("%$;!/&#0#*;!&&&#/' 8!:\u015b!! )"),l("%;\xda/Y#$%;B/,#;\xdb/#$+\")(\"'#&'#06*%;B/,#;\xdb/#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),l('%3\u015c""5&7\u015d.; &3\u015e""5\'7\u015f./ &3\u0160""5*7\u0161.# &;6/& 8!:\u0162! )'),l("%3\u0163\"\"5&7\u0164/:#;</1$;\xdc/($8#:\u0165#! )(#'#(\"'#&'#.} &%3\xf3\"\"5'7\xf4/:#;</1$;\x9d/($8#:\u0166#! )(#'#(\"'#&'#.P &%3\u0167\"\"5+7\u0168/:#;</1$;\x9d/($8#:\u0169#! )(#'#(\"'#&'#.# &;\x9f"),l('3\u016a""5+7\u016b.k &3\u016c""5)7\u016d._ &3\u016e""5(7\u016f.S &3\u0170""5\'7\u0171.G &3\u0172""5&7\u0173.; &3\u0174""5*7\u0175./ &3\u0176""5)7\u0177.# &;6'),l(';1." &"'),l('%%;6/k#$%;A/2#;6/)$8":\u0158""$ )("\'#&\'#0<*%;A/2#;6/)$8":\u0158""$ )("\'#&\'#&/)$8":\u0159""! )("\'#&\'#." &"/\' 8!:\u0178!! )'),l("%;L.# &;\x98/]#$%;B/,#;\xe0/#$+\")(\"'#&'#06*%;B/,#;\xe0/#$+\")(\"'#&'#&/'$8\":\u0179\" )(\"'#&'#"),l(";\xb8.# &;\x9f"),l("%;\xe2/Y#$%;A/,#;\xe2/#$+\")(\"'#&'#06*%;A/,#;\xe2/#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),l("%;\xe9/k#;./b$;\xec/Y$$%;B/,#;\xe3/#$+\")(\"'#&'#06*%;B/,#;\xe3/#$+\")(\"'#&'#&/#$+$)($'#(#'#(\"'#&'#"),l(";\xe4.; &;\xe5.5 &;\xe6./ &;\xe7.) &;\xe8.# &;\x9f"),l("%3\u017a\"\"5#7\u017b/:#;</1$;\xef/($8#:\u017c#! )(#'#(\"'#&'#"),l("%3\u017d\"\"5%7\u017e/:#;</1$;T/($8#:\u017f#! )(#'#(\"'#&'#"),l("%3\u0180\"\"5(7\u0181/@#;</7$;\\.# &;Y/($8#:\u0182#! )(#'#(\"'#&'#"),l("%3\u0183\"\"5&7\u0184/:#;</1$;6/($8#:\u0185#! )(#'#(\"'#&'#"),l('%3\u0186""5%7\u0187/O#%;</3#$;!0#*;!&/#$+")("\'#&\'#." &"/\'$8":\u0188" )("\'#&\'#'),l("%;\xea/G#;;/>$;6/5$;;/,$;\xeb/#$+%)(%'#($'#(#'#(\"'#&'#"),l('%3\x92""5#7\xd3.# &;6/\' 8!:\u0189!! )'),l('%3\xb1""5#7\u018a.G &3\xb3""5#7\u018b.; &3\xb7""5#7\u018c./ &3\xb5""5$7\u018d.# &;6/\' 8!:\u018e!! )'),l('%;\xed/D#%;C/,#;\xee/#$+")("\'#&\'#." &"/#$+")("\'#&\'#'),l("%;U.) &;\\.# &;X/& 8!:\u018f! )"),l('%%;!." &"/[#;!." &"/M$;!." &"/?$;!." &"/1$;!." &"/#$+%)(%\'#($\'#(#\'#("\'#&\'#/\' 8!:\u0190!! )'),l('%%;!/?#;!." &"/1$;!." &"/#$+#)(#\'#("\'#&\'#/\' 8!:\u0191!! )'),l(";\xbd"),l('%;\x9d/^#$%;B/,#;\xf2/#$+")("\'#&\'#06*%;B/,#;\xf2/#$+")("\'#&\'#&/($8":\u0192"!!)("\'#&\'#'),l(";\xf3.# &;\x9f"),l('%2\u0193""6\u01937\u0194/L#;</C$2\u0195""6\u01957\u0196.) &2\u0197""6\u01977\u0198/($8#:\u0199#! )(#\'#("\'#&\'#'),l('%;\x9d/^#$%;B/,#;\x9f/#$+")("\'#&\'#06*%;B/,#;\x9f/#$+")("\'#&\'#&/($8":\u019a"!!)("\'#&\'#'),l("%;6/5#;0/,$;\xf6/#$+#)(#'#(\"'#&'#"),l("$;2.) &;4.# &;.0/*;2.) &;4.# &;.&"),l("$;%0#*;%&"),l("%;\xf9/;#28\"\"6879/,$;\xfa/#$+#)(#'#(\"'#&'#"),l('%3\u019b""5%7\u019c.) &3\u019d""5$7\u019e/\' 8!:\u019f!! )'),l('%;\xfb/J#%28""6879/,#;^/#$+")("\'#&\'#." &"/#$+")("\'#&\'#'),l("%;\\.) &;X.# &;\x82/' 8!:\u01a0!! )"),l(';".S &;!.M &2F""6F7G.A &2J""6J7K.5 &2H""6H7I.) &2N""6N7O'),l('2L""6L7M.\x95 &2B""6B7C.\x89 &2<""6<7=.} &2R""6R7S.q &2T""6T7U.e &2V""6V7W.Y &2P""6P7Q.M &2@""6@7A.A &2D""6D7E.5 &22""6273.) &2>""6>7?'),l('%;\xff/b#28""6879/S$;\xfa/J$%2\u01a1""6\u01a17\u01a2/,#;\xeb/#$+")("\'#&\'#." &"/#$+$)($\'#(#\'#("\'#&\'#'),l('%3\u01a3""5%7\u01a4.) &3\u01a5""5$7\u01a6/\' 8!:\u019f!! )'),l('%;\xeb/O#3\xb1""5#7\xb2.6 &3\xb3""5#7\xb4.* &$;+0#*;+&/\'$8":\u01a7" )("\'#&\'#'),l("%;\u0103/\x87#2F\"\"6F7G/x$;\u0102/o$2F\"\"6F7G/`$;\u0102/W$2F\"\"6F7G/H$;\u0102/?$2F\"\"6F7G/0$;\u0104/'$8):\u01a8) )()'#(('#(''#(&'#(%'#($'#(#'#(\"'#&'#"),l("%;#/>#;#/5$;#/,$;#/#$+$)($'#(#'#(\"'#&'#"),l("%;\u0102/,#;\u0102/#$+\")(\"'#&'#"),l("%;\u0102/5#;\u0102/,$;\u0102/#$+#)(#'#(\"'#&'#")],E=0,S=0,y=[{line:1,column:1}],C=0,A=[],R=0;if("startRule"in t){if(!(t.startRule in m))throw new Error("Can't start parsing from rule \""+t.startRule+'".');T=m[t.startRule]}if(t.data={},(f=d(T))!==g&&E===e.length)return f;throw f!==g&&E<e.length&&h({type:"end"}),u(A,C<e.length?e.charAt(C):null,C<e.length?c(C,C+1):c(C,C))}}},function(e,t,i){"use strict";e.exports=function(e){return{stripTcpCandidates:function(t){return t.sdp=t.sdp.replace(/^a=candidate:\d+ \d+ tcp .*?\r\n/gim,""),e.Utils.Promise.resolve(t)},stripTelephoneEvent:function(t){return t.sdp=t.sdp.replace(/^a=rtpmap:\d+ telephone-event\/d+/gim,""),e.Utils.Promise.resolve(t)},cleanJitsiSdpImageattr:function(t){return t.sdp=t.sdp.replace(/^(a=imageattr:.*?)(x|y)=\[0-/gm,"$1$2=[1:"),e.Utils.Promise.resolve(t)},stripG722:function(t){var i=t.sdp.match(/^m=audio.*$/gm)[0];i=i.split(" ");for(var s=3;s<i.length;s+=1)if("9"===i[s]){i.splice(s,1);var r=parseInt(i[1],10);r-=1,i[1]=r.toString()}return i=i.join(" "),t.sdp=t.sdp.replace(/^m=audio.*$/gm,i),t.sdp=t.sdp.replace(/^a=rtpmap:.*G722\/8000\r\n?/gm,"").replace(),e.Utils.Promise.resolve(t)}}}},function(e,t,i){"use strict";e.exports=function(e){var t={STATUS_NULL:0,STATUS_NEW:1,STATUS_CONNECTING:2,STATUS_CONNECTED:3,STATUS_COMPLETED:4},i=function(i){if(i.media.remote.video?this.video=!0:this.video=!1,i.media.remote.audio?this.audio=!0:this.audio=!1,this.audio||this.video){this.options=i;var s=global.navigator.userAgent.toLowerCase(),r=!1;s.indexOf("safari")>-1&&s.indexOf("chrome")<0&&(r=!0);var n={};return r&&(n.modifiers=[e.WebRTC.Modifiers.stripG722]),this.ua=new e.UA({wsServers:this.options.ua.wsServers,uri:this.options.ua.uri,authorizationUser:this.options.ua.authorizationUser,password:this.options.ua.password,displayName:this.options.ua.displayName,traceSip:this.options.ua.traceSip,userAgentString:this.options.ua.userAgentString,register:!0,sessionDescriptionHandlerFactoryOptions:n}),this.state=t.STATUS_NULL,this.logger=this.ua.getLogger("sip.simple"),this.ua.on("registered",function(){this.emit("registered",this.ua)}.bind(this)),this.ua.on("unregistered",function(){this.emit("unregistered",this.ua)}.bind(this)),this.ua.on("failed",function(){this.emit("unregistered",this.ua)}.bind(this)),this.ua.on("invite",function(e){if(this.state!==t.STATUS_NULL&&this.state!==t.STATUS_COMPLETED)return this.logger.warn("Rejecting incoming call. Simple only supports 1 call at a time"),void e.reject();this.session=e,this.setupSession(),this.emit("ringing",this.session)}.bind(this)),this.ua.on("message",function(e){this.emit("message",e)}.bind(this)),this}this.logger.error("At least one remote audio or video element is required for Simple.")};return i.prototype=Object.create(e.EventEmitter.prototype),i.C=t,i.prototype.call=function(e){if(this.ua&&this.ua.isRegistered()){if(this.state===t.STATUS_NULL||this.state===t.STATUS_COMPLETED)return this.options.media.remote.audio&&(this.options.media.remote.audio.autoplay=!0),this.options.media.remote.video&&(this.options.media.remote.video.autoplay=!0),this.options.media.local&&this.options.media.local.video&&(this.options.media.local.video.autoplay=!0,this.options.media.local.video.volume=0),this.session=this.ua.invite(e,{sessionDescriptionHandlerOptions:{constraints:{audio:this.audio,video:this.video}}}),this.setupSession(),this.session;this.logger.warn("Cannot make more than a single call with Simple")}else this.logger.warn("A registered UA is required for calling")},i.prototype.answer=function(){if(this.state===t.STATUS_NEW||this.state===t.STATUS_CONNECTING)return this.options.media.remote.audio&&(this.options.media.remote.audio.autoplay=!0),this.options.media.remote.video&&(this.options.media.remote.video.autoplay=!0),this.session.accept({sessionDescriptionHandlerOptions:{constraints:{audio:this.audio,video:this.video}}});this.logger.warn("No call to answer")},i.prototype.reject=function(){if(this.state===t.STATUS_NEW||this.state===t.STATUS_CONNECTING)return this.session.reject();this.logger.warn("Call is already answered")},i.prototype.hangup=function(){if(this.state===t.STATUS_CONNECTED||this.state===t.STATUS_CONNECTING||this.state===t.STATUS_NEW)return this.state!==t.STATUS_CONNECTED?this.session.cancel():this.session.bye();this.logger.warn("No active call to hang up on")},i.prototype.hold=function(){if(this.state===t.STATUS_CONNECTED&&!this.session.isOnHold().local)return this.mute(),this.logger.log("Placing session on hold"),this.session.hold();this.logger.warn("Cannot put call on hold")},i.prototype.unhold=function(){if(this.state===t.STATUS_CONNECTED&&this.session.isOnHold().local)return this.unmute(),this.logger.log("Placing call off hold"),this.session.unhold();this.logger.warn("Cannot unhold a call that is not on hold")},i.prototype.mute=function(){this.state===t.STATUS_CONNECTED?(this.logger.log("Muting Audio"),this.toggleMute(!0)):this.logger.warn("An acitve call is required to mute audio")},i.prototype.unmute=function(){this.state===t.STATUS_CONNECTED?(this.logger.log("Unmuting Audio"),this.toggleMute(!1)):this.logger.warn("An active call is required to unmute audio")},i.prototype.sendDTMF=function(e){this.state===t.STATUS_CONNECTED?(this.logger.log("Sending DTMF tone: "+e),this.session.dtmf(e)):this.logger.warn("An active call is required to send a DTMF tone")},i.prototype.message=function(e,t){this.ua&&this.ua.isRegistered()?e&&t?this.ua.message(e,t):this.logger.warn("A destination and message are required to send a message"):this.logger.warn("A registered UA is required to send a message")},i.prototype.setupRemoteMedia=function(){var e,t=this.session.sessionDescriptionHandler.peerConnection;t.getRemoteStreams?e=t.getRemoteStreams()[0]:(e=new global.window.MediaStream,t.getReceivers().forEach(function(t){var i=t.track;i&&e.addTrack(i)})),this.video?(this.options.media.remote.video.srcObject=e,this.options.media.remote.video.play().catch(function(){this.logger.log("play was rejected")}.bind(this))):this.audio&&(this.options.media.remote.audio.srcObject=e,this.options.media.remote.audio.play().catch(function(){this.logger.log("play was rejected")}.bind(this)))},i.prototype.setupLocalMedia=function(){if(this.video&&this.options.media.local&&this.options.media.local.video){var e,t=this.session.sessionDescriptionHandler.peerConnection;t.getSenders?(e=new global.window.MediaStream,t.getSenders().forEach(function(t){var i=t.track;i&&"video"===i.kind&&e.addTrack(i)})):e=t.getLocalStreams()[0],this.options.media.local.video.srcObject=e,this.options.media.local.video.volume=0,this.options.media.local.video.play()}},i.prototype.cleanupMedia=function(){this.video&&(this.options.media.remote.video.srcObject=null,this.options.media.remote.video.pause(),this.options.media.local&&this.options.media.local.video&&(this.options.media.local.video.srcObject=null,this.options.media.local.video.pause())),this.audio&&(this.options.media.remote.audio.srcObject=null,this.options.media.remote.audio.pause())},i.prototype.setupSession=function(){this.state=t.STATUS_NEW,this.emit("new",this.session),this.session.on("progress",this.onProgress.bind(this)),this.session.on("accepted",this.onAccepted.bind(this)),this.session.on("rejected",this.onEnded.bind(this)),this.session.on("failed",this.onFailed.bind(this)),this.session.on("terminated",this.onEnded.bind(this))},i.prototype.destroyMedia=function(){this.session.sessionDescriptionHandler.close()},i.prototype.toggleMute=function(e){var t=this.session.sessionDescriptionHandler.peerConnection;t.getSenders?t.getSenders().forEach(function(t){t.track&&(t.track.enabled=!e)}):t.getLocalStreams().forEach(function(t){t.getAudioTracks().forEach(function(t){t.enabled=!e}),t.getVideoTracks().forEach(function(t){t.enabled=!e})})},i.prototype.onAccepted=function(){this.state=t.STATUS_CONNECTED,this.emit("connected",this.session),this.setupLocalMedia(),this.setupRemoteMedia(),this.session.sessionDescriptionHandler.on("addTrack",function(){this.logger.log("A track has been added, triggering new remoteMedia setup"),this.setupRemoteMedia()}.bind(this)),this.session.sessionDescriptionHandler.on("addStream",function(){this.logger.log("A stream has been added, trigger new remoteMedia setup"),this.setupRemoteMedia()}.bind(this)),this.session.on("hold",function(){this.emit("hold",this.session)}.bind(this)),this.session.on("unhold",function(){this.emit("unhold",this.session)}.bind(this)),this.session.on("dtmf",function(e){this.emit("dtmf",e)}.bind(this)),this.session.on("bye",this.onEnded.bind(this))},i.prototype.onProgress=function(){this.state=t.STATUS_CONNECTING,this.emit("connecting",this.session)},i.prototype.onFailed=function(){this.onEnded()},i.prototype.onEnded=function(){this.state=t.STATUS_COMPLETED,this.emit("ended",this.session),this.cleanupMedia()},i}},function(e,t,i){"use strict";var s=i(0)._extend;s(t,i(46)),s(t,{WebSocket:i(48),Promise:t.Promise||i(62),console:i(63),timers:i(64)})},function(e,t,i){"use strict";function s(e,t){if(null!=e){var i=t.charAt(0).toUpperCase()+t.slice(1),s=[t,"webkit"+i,"moz"+i];for(var r in s){var n=e[s[r]];if(n)return n.bind(e)}}}var r=global.window||global;e.exports={WebSocket:r.WebSocket,Transport:i(47),open:r.open,Promise:r.Promise,timers:r,console:r.console||{debug:function(){},log:function(){},warn:function(){},error:function(){}},addEventListener:s(r,"addEventListener"),removeEventListener:s(r,"removeEventListener")}},function(e,t,i){"use strict";e.exports=function(e,t){function i(e){var t=.8*e;return 1e3*(Math.random()*(e-t)+t)}var s;return s=function(e,t){this.logger=e.getLogger("sip.transport"),this.ua=e,this.ws=null,this.server=t,this.reconnection_attempts=0,this.closed=!1,this.connected=!1,this.reconnectTimer=null,this.lastTransportError={},this.keepAliveInterval=e.configuration.keepAliveInterval,this.keepAliveTimeout=null,this.keepAliveTimer=null,this.ua.transport=this,this.connect()},s.prototype={send:function(e){var i=e.toString();return this.ws&&this.ws.readyState===t.OPEN?(!0===this.ua.configuration.traceSip&&this.logger.log("sending WebSocket message:\n\n"+i+"\n"),this.ws.send(i),!0):(this.logger.warn("unable to send message, WebSocket is not open"),!1)},sendKeepAlive:function(){if(!this.keepAliveTimeout)return this.keepAliveTimeout=e.Timers.setTimeout(function(){this.ua.emit("keepAliveTimeout")}.bind(this),1e4),this.send("\r\n\r\n")},startSendingKeepAlives:function(){this.keepAliveInterval&&!this.keepAliveTimer&&(this.keepAliveTimer=e.Timers.setTimeout(function(){this.sendKeepAlive(),this.keepAliveTimer=null,this.startSendingKeepAlives()}.bind(this),i(this.keepAliveInterval)))},stopSendingKeepAlives:function(){e.Timers.clearTimeout(this.keepAliveTimer),e.Timers.clearTimeout(this.keepAliveTimeout),this.keepAliveTimer=null,this.keepAliveTimeout=null},disconnect:function(){this.ws&&(e.Timers.clearTimeout(this.reconnectTimer),this.stopSendingKeepAlives(),this.closed=!0,this.logger.log("closing WebSocket "+this.server.ws_uri),this.ws.close(),this.ws=null),null!==this.reconnectTimer&&(e.Timers.clearTimeout(this.reconnectTimer),this.reconnectTimer=null,this.ua.emit("disconnected",{transport:this,code:this.lastTransportError.code,reason:this.lastTransportError.reason}))},connect:function(){var e=this;if(this.ws&&(this.ws.readyState===t.OPEN||this.ws.readyState===t.CONNECTING))return this.logger.log("WebSocket "+this.server.ws_uri+" is already connected"),!1;this.ws&&(this.ws.close(),this.ws=null),this.logger.log("connecting to WebSocket "+this.server.ws_uri),this.ua.onTransportConnecting(this,0===this.reconnection_attempts?1:this.reconnection_attempts);try{this.ws=new t(this.server.ws_uri,"sip")}catch(e){this.logger.warn("error connecting to WebSocket "+this.server.ws_uri+": "+e)}this.ws.binaryType="arraybuffer",this.ws.onopen=function(){e.onOpen()},this.ws.onclose=function(t){e.onClose(t),this.onopen=null,this.onclose=null,this.onmessage=null,this.onerror=null},this.ws.onmessage=function(t){e.onMessage(t)},this.ws.onerror=function(t){e.onError(t)}},onOpen:function(){this.connected=!0,this.logger.log("WebSocket "+this.server.ws_uri+" connected"),null!==this.reconnectTimer&&(e.Timers.clearTimeout(this.reconnectTimer),this.reconnectTimer=null),this.reconnection_attempts=0,this.closed=!1,this.ua.onTransportConnected(this),this.startSendingKeepAlives()},onClose:function(e){var t=this.connected;this.lastTransportError.code=e.code,this.lastTransportError.reason=e.reason,this.stopSendingKeepAlives(),this.reconnection_attempts>0?(this.logger.log("Reconnection attempt "+this.reconnection_attempts+" failed (code: "+e.code+(e.reason?"| reason: "+e.reason:"")+")"),this.reconnect()):(this.connected=!1,this.logger.log("WebSocket disconnected (code: "+e.code+(e.reason?"| reason: "+e.reason:"")+")"),!1===e.wasClean&&this.logger.warn("WebSocket abrupt disconnection"),!0===t?(this.ua.onTransportClosed(this),this.closed?this.ua.emit("disconnected",{transport:this,code:this.lastTransportError.code,reason:this.lastTransportError.reason}):this.reconnect()):this.ua.onTransportError(this))},onMessage:function(t){var i,s,r=t.data;if("\r\n"===r)return e.Timers.clearTimeout(this.keepAliveTimeout),this.keepAliveTimeout=null,void(!0===this.ua.configuration.traceSip&&this.logger.log("received WebSocket message with CRLF Keep Alive response"));if("string"!=typeof r){try{r=String.fromCharCode.apply(null,new Uint8Array(r))}catch(e){return void this.logger.warn("received WebSocket binary message failed to be converted into string, message discarded")}!0===this.ua.configuration.traceSip&&this.logger.log("received WebSocket binary message:\n\n"+r+"\n")}else!0===this.ua.configuration.traceSip&&this.logger.log("received WebSocket text message:\n\n"+r+"\n");if((i=e.Parser.parseMessage(r,this.ua))&&!(this.ua.status===e.UA.C.STATUS_USER_CLOSED&&i instanceof e.IncomingRequest)&&e.sanityCheck(i,this.ua,this))if(i instanceof e.IncomingRequest)i.transport=this,this.ua.receiveRequest(i);else if(i instanceof e.IncomingResponse)switch(i.method){case e.C.INVITE:(s=this.ua.transactions.ict[i.via_branch])&&s.receiveResponse(i);break;case e.C.ACK:break;default:(s=this.ua.transactions.nict[i.via_branch])&&s.receiveResponse(i)}},onError:function(e){this.logger.warn("WebSocket connection error: "),this.logger.warn(e)},reconnect:function(){var t=this;this.reconnection_attempts+=1,this.reconnection_attempts>this.ua.configuration.wsServerMaxReconnection?(this.logger.warn("maximum reconnection attempts for WebSocket "+this.server.ws_uri),this.ua.onTransportError(this)):1===this.reconnection_attempts?(this.logger.log("Connection to WebSocket "+this.server.ws_uri+" severed, attempting first reconnect"),t.connect()):(this.logger.log("trying to reconnect to WebSocket "+this.server.ws_uri+" (reconnection attempt "+this.reconnection_attempts+")"),this.reconnectTimer=e.Timers.setTimeout(function(){t.connect(),t.reconnectTimer=null},1e3*this.ua.configuration.wsServerReconnectionTimeout))}},s.C={STATUS_READY:0,STATUS_DISCONNECTED:1,STATUS_ERROR:2},s}},function(e,t,i){"use strict";/*!
 * ws: a node.js websocket client
 * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>
 * MIT Licensed
 */
var s=e.exports=i(4);s.Server=i(60),s.Sender=i(8),s.Receiver=i(11),s.createServer=function(e,t){var i=new s.Server(e);return"function"==typeof t&&i.on("connection",t),i},s.connect=s.createConnection=function(e,t){var i=new s(e);return"function"==typeof t&&i.on("open",t),i}},function(e,t){e.exports=require("https")},function(e,t){e.exports=require("stream")},function(e,t,i){"use strict";function s(e){if(!(this instanceof s))return new s(e);this.id=n++,this.ee=e}var r=Object.prototype.hasOwnProperty,n=0;s.prototype.on=function(e,t,i){return t.__ultron=this.id,this.ee.on(e,t,i),this},s.prototype.once=function(e,t,i){return t.__ultron=this.id,this.ee.once(e,t,i),this},s.prototype.remove=function(){var e,t=arguments;if(1===t.length&&"string"==typeof t[0])t=t[0].split(/[, ]+/);else if(!t.length){t=[];for(e in this.ee._events)r.call(this.ee._events,e)&&t.push(e)}for(var i=0;i<t.length;i++)for(var s=this.ee.listeners(t[i]),n=0;n<s.length;n++){if((e=s[n]).listener){if(e.listener.__ultron!==this.id)continue;delete e.listener.__ultron}else{if(e.__ultron!==this.id)continue;delete e.__ultron}this.ee.removeListener(t[i],e)}return this},s.prototype.destroy=function(){return!!this.ee&&(this.remove(),this.ee=null,!0)},e.exports=s},function(e,t){e.exports=require("fs")},function(e,t){/*!
 * ws: a node.js websocket client
 * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>
 * MIT Licensed
 */
t.BufferUtil={merge:function(e,t){for(var i=0,s=0,r=t.length;s<r;++s){var n=t[s];n.copy(e,i),i+=n.length}},mask:function(e,t,i,s,r){for(var n=t.readUInt32LE(0,!0),o=0;o<r-3;o+=4){var a=n^e.readUInt32LE(o,!0);a<0&&(a=4294967296+a),i.writeUInt32LE(a,s+o,!0)}switch(r%4){case 3:i[s+o+2]=e[o+2]^t[2];case 2:i[s+o+1]=e[o+1]^t[1];case 1:i[s+o]=e[o]^t[0]}},unmask:function(e,t){for(var i=t.readUInt32LE(0,!0),s=e.length,r=0;r<s-3;r+=4){var n=i^e.readUInt32LE(r,!0);n<0&&(n=4294967296+n),e.writeUInt32LE(n,r,!0)}switch(s%4){case 3:e[r+2]=e[r+2]^t[2];case 2:e[r+1]=e[r+1]^t[1];case 1:e[r]=e[r]^t[0]}}}},function(e,t){e.exports=require("zlib")},function(e,t,i){"use strict";/*!
 * ws: a node.js websocket client
 * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>
 * MIT Licensed
 */
var s;try{s=i(!function(){var e=new Error('Cannot find module "utf-8-validate"');throw e.code="MODULE_NOT_FOUND",e}())}catch(e){s=i(56)}e.exports="object"==typeof s?s.Validation.isValidUTF8:s},function(e,t){/*!
 * ws: a node.js websocket client
 * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>
 * MIT Licensed
 */
t.Validation={isValidUTF8:function(e){return!0}}},function(e,t,i){function s(e,t,i){if(this instanceof s==!1)throw new TypeError("Classes can't be function-called");"function"==typeof e?(i=t,t=e,e=0):void 0===e&&(e=0),this._growStrategy=(t||function(e,t){return e.used+t}).bind(null,this),this._shrinkStrategy=(i||function(t){return e}).bind(null,this),this._buffer=e?new Buffer(e):null,this._offset=0,this._used=0,this._changeFactor=0,this.__defineGetter__("size",function(){return null==this._buffer?0:this._buffer.length}),this.__defineGetter__("used",function(){return this._used})}/*!
 * ws: a node.js websocket client
 * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>
 * MIT Licensed
 */
i(0);s.prototype.get=function(e){if(null==this._buffer||this._offset+e>this._buffer.length){var t=new Buffer(this._growStrategy(e));this._buffer=t,this._offset=0}this._used+=e;var i=this._buffer.slice(this._offset,this._offset+e);return this._offset+=e,i},s.prototype.reset=function(e){var t=this._shrinkStrategy();t<this.size&&(this._changeFactor-=1),(e||this._changeFactor<-2)&&(this._changeFactor=0,this._buffer=t?new Buffer(t):null),this._offset=0,this._used=0},e.exports=s},function(e,t,i){function s(e){if(this instanceof s==!1)throw new TypeError("Classes can't be function-called");r.EventEmitter.call(this),this.socket=e,this.continuationFrame=!1,this.isClosed=!1}/*!
 * ws: a node.js websocket client
 * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>
 * MIT Licensed
 */
var r=i(1),n=i(0);r.EventEmitter;e.exports=s,n.inherits(s,r.EventEmitter),s.prototype.send=function(e,t,i){if(!this.isClosed){var s="string"==typeof e,r=s?Buffer.byteLength(e):e.length,n=r>127?2:1,o=0==this.continuationFrame,a=!t||!(void 0!==t.fin&&!t.fin),c=new Buffer((o?t&&t.binary?1+n:1:0)+r+(!a||t&&t.binary?0:1)),h=o?1:0;o&&(t&&t.binary?(c.write("\x80","binary"),n>1&&c.write(String.fromCharCode(128+r/128),h++,"binary"),c.write(String.fromCharCode(127&r),h++,"binary")):c.write("\0","binary")),s?c.write(e,h,"utf8"):e.copy(c,h,0),a?(t&&t.binary||c.write("\xff",h+r,"binary"),this.continuationFrame=!1):this.continuationFrame=!0;try{this.socket.write(c,"binary",i)}catch(e){this.error(e.toString())}}},s.prototype.close=function(e,t,i,s){if(!this.isClosed){this.isClosed=!0;try{this.continuationFrame&&this.socket.write(new Buffer([255],"binary")),this.socket.write(new Buffer([255,0]),"binary",s)}catch(e){this.error(e.toString())}}},s.prototype.ping=function(e,t){},s.prototype.pong=function(e,t){},s.prototype.error=function(e){return this.emit("error",e),this}},function(e,t,i){function s(){if(this instanceof s==!1)throw new TypeError("Classes can't be function-called");this.state=n,this.buffers=[],this.messageEnd=-1,this.spanLength=0,this.dead=!1,this.onerror=function(){},this.ontext=function(){},this.onbinary=function(){},this.onclose=function(){},this.onping=function(){},this.onpong=function(){}}function r(e,t){for(var i=0,s=e.length;i<s;++i)if(e[i]===t)return i;return-1}/*!
 * ws: a node.js websocket client
 * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>
 * MIT Licensed
 */
i(0);var n=0,o=1,a=2,c=3;e.exports=s,s.prototype.add=function(e){if(!this.dead)for(var t=this;e;)e=function(){if(t.state===n){if(2==e.length&&255==e[0]&&0==e[1])return t.reset(),void t.onclose();if(128===e[0])t.messageEnd=0,t.state=a,e=e.slice(1);else{if(0!==e[0])return void t.error("payload must start with 0x00 byte",!0);e=e.slice(1),t.state=o}}if(t.state===a){for(var i=0;i<e.length&&128&e[i];)t.messageEnd=128*t.messageEnd+(127&e[i]),++i;i<e.length&&(t.messageEnd=128*t.messageEnd+(127&e[i]),t.state=c,++i),i>0&&(e=e.slice(i))}if(t.state===c){var s=t.messageEnd-t.spanLength;return e.length>=s?(t.buffers.push(e),t.spanLength+=s,t.messageEnd=s,t.parse()):(t.buffers.push(e),void(t.spanLength+=e.length))}if(t.buffers.push(e),-1!=(t.messageEnd=r(e,255)))return t.spanLength+=t.messageEnd,t.parse();t.spanLength+=e.length}()},s.prototype.cleanup=function(){this.dead=!0,this.state=n,this.buffers=[]},s.prototype.parse=function(){for(var e=new Buffer(this.spanLength),t=0,i=0,s=this.buffers.length;i<s-1;++i){var r=this.buffers[i];r.copy(e,t),t+=r.length}var n=this.buffers[this.buffers.length-1];this.messageEnd>0&&n.copy(e,t,0,this.messageEnd),this.state!==o&&--this.messageEnd;var a=null;return this.messageEnd<n.length-1&&(a=n.slice(this.messageEnd+1)),this.reset(),this.ontext(e.toString("utf8")),a},s.prototype.error=function(e,t){if(!this.dead)return this.reset(),"string"==typeof e?this.onerror(new Error(e),t):e.constructor==Error?this.onerror(e,t):this.onerror(new Error("An error occured"),t),this},s.prototype.reset=function(e){this.dead||(this.state=n,this.buffers=[],this.messageEnd=-1,this.spanLength=0)}},function(e,t,i){function s(e,t){if(this instanceof s==!1)return new s(e,t);if(h.EventEmitter.call(this),!(e=new d({host:"0.0.0.0",port:null,server:null,verifyClient:null,handleProtocols:null,path:null,noServer:!1,disableHixie:!1,clientTracking:!0,perMessageDeflate:!0,maxPayload:104857600}).merge(e)).isDefinedAndNonNull("port")&&!e.isDefinedAndNonNull("server")&&!e.value.noServer)throw new TypeError("`port` or a `server` must be provided");var i=this;if(e.isDefinedAndNonNull("port"))this._server=u.createServer(function(e,t){var i=u.STATUS_CODES[426];t.writeHead(426,{"Content-Length":i.length,"Content-Type":"text/plain"}),t.end(i)}),this._server.allowHalfOpen=!1,this._server.listen(e.value.port,e.value.host,t),this._closeServer=function(){i._server&&i._server.close()};else if(e.value.server&&(this._server=e.value.server,e.value.path)){if(this._server._webSocketPaths&&e.value.server._webSocketPaths[e.value.path])throw new Error("two instances of WebSocketServer cannot listen on the same http server path");"object"!=typeof this._server._webSocketPaths&&(this._server._webSocketPaths={}),this._server._webSocketPaths[e.value.path]=1}this._server&&(this._onceServerListening=function(){i.emit("listening")},this._server.once("listening",this._onceServerListening)),void 0!==this._server&&(this._onServerError=function(e){i.emit("error",e)},this._server.on("error",this._onServerError),this._onServerUpgrade=function(e,t,s){var r=new Buffer(s.length);s.copy(r),i.handleUpgrade(e,t,r,function(t){i.emit("connection"+e.url,t),i.emit("connection",t)})},this._server.on("upgrade",this._onServerUpgrade)),this.options=e.value,this.path=e.value.path,this.clients=[]}function r(e,t,i,s){var r=function(){try{t.destroy()}catch(e){}};if(t.on("error",r),e.headers["sec-websocket-key"]){var n=parseInt(e.headers["sec-websocket-version"]);if(-1!==[8,13].indexOf(n)){var c=e.headers["sec-websocket-protocol"],h=n<13?e.headers["sec-websocket-origin"]:e.headers.origin,d=f.parse(e.headers["sec-websocket-extensions"]),g=this,m=function(c){var h=e.headers["sec-websocket-key"],u=l.createHash("sha1");u.update(h+"258EAFA5-E914-47DA-95CA-C5AB0DC85B11");var m=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade","Sec-WebSocket-Accept: "+(h=u.digest("base64"))];void 0!==c&&m.push("Sec-WebSocket-Protocol: "+c);var T={};try{T=o.call(g,d)}catch(e){return void a(t,400,"Bad Request")}if(Object.keys(T).length){var _={};Object.keys(T).forEach(function(e){_[e]=[T[e].params]}),m.push("Sec-WebSocket-Extensions: "+f.format(_))}g.emit("headers",m),t.setTimeout(0),t.setNoDelay(!0);try{t.write(m.concat("","").join("\r\n"))}catch(e){try{t.destroy()}catch(e){}return}var v=new p([e,t,i],{protocolVersion:n,protocol:c,extensions:T,maxPayload:g.options.maxPayload});g.options.clientTracking&&(g.clients.push(v),v.on("close",function(){var e=g.clients.indexOf(v);-1!=e&&g.clients.splice(e,1)})),t.removeListener("error",r),s(v)},T=function(){if("function"!=typeof g.options.handleProtocols)void 0!==c?m(c.split(/, */)[0]):m();else{var e=(c||"").split(/, */),i=!1;g.options.handleProtocols(e,function(e,s){i=!0,e?m(s):a(t,401,"Unauthorized")});i||a(t,501,"Could not process protocols")}};if("function"==typeof this.options.verifyClient){var _={origin:h,secure:void 0!==e.connection.authorized||void 0!==e.connection.encrypted,req:e};if(2==this.options.verifyClient.length)return void this.options.verifyClient(_,function(e,i,s){void 0===i&&(i=401),void 0===s&&(s=u.STATUS_CODES[i]),e?T():a(t,i,s)});if(!this.options.verifyClient(_))return void a(t,401,"Unauthorized")}T()}else a(t,400,"Bad Request")}else a(t,400,"Bad Request")}function n(e,t,i,s){var r=function(){try{t.destroy()}catch(e){}};if(t.on("error",r),this.options.disableHixie)a(t,401,"Hixie support disabled");else if(e.headers["sec-websocket-key2"]){var n=e.headers.origin,o=this,c=function(){var c;c=e.headers["x-forwarded-host"]?e.headers["x-forwarded-host"]:e.headers.host;var h=("https"===e.headers["x-forwarded-proto"]||t.encrypted?"wss":"ws")+"://"+c+e.url,u=e.headers["sec-websocket-protocol"],d=function(){var e=["HTTP/1.1 101 Switching Protocols","Upgrade: WebSocket","Connection: Upgrade","Sec-WebSocket-Location: "+h];return void 0!==u&&e.push("Sec-WebSocket-Protocol: "+u),void 0!==n&&e.push("Sec-WebSocket-Origin: "+n),new Buffer(e.concat("","").join("\r\n"))},f=function(i,n,c){var h=e.headers["sec-websocket-key1"],d=e.headers["sec-websocket-key2"],f=l.createHash("md5");[h,d].forEach(function(e){var i=parseInt(e.replace(/[^\d]/g,"")),s=e.replace(/[^ ]/g,"").length;0!==s&&i%s==0?(i/=s,f.update(String.fromCharCode(i>>24&255,i>>16&255,i>>8&255,255&i))):a(t,400,"Bad Request")}),f.update(i.toString("binary")),t.setTimeout(0),t.setNoDelay(!0);try{var g=new Buffer(f.digest("binary"),"binary"),m=new Buffer(c.length+g.length);c.copy(m,0),g.copy(m,c.length),t.write(m,"binary",function(i){if(!i){var a=new p([e,t,n],{protocolVersion:"hixie-76",protocol:u});o.options.clientTracking&&(o.clients.push(a),a.on("close",function(){var e=o.clients.indexOf(a);-1!=e&&o.clients.splice(e,1)})),t.removeListener("error",r),s(a)}})}catch(e){try{t.destroy()}catch(e){}return}};if(i&&i.length>=8){var g=i.slice(0,8),m=i.length>8?i.slice(8):null;f.call(o,g,m,d())}else{g=new Buffer(8);i.copy(g,0);var T=i.length,m=null,_=function(e){var i=Math.min(e.length,8-T);0!==i&&(e.copy(g,T,0,i),8==(T+=i)&&(t.removeListener("data",_),i<e.length&&(m=e.slice(i)),f.call(o,g,m,new Buffer(0))))};t.on("data",_),function(){t.setTimeout(0),t.setNoDelay(!0);var e=d();try{t.write(e,"binary",function(e){e&&t.removeListener("data",_)})}catch(e){try{t.destroy()}catch(e){}return}}()}};if("function"==typeof this.options.verifyClient){var h={origin:n,secure:void 0!==e.connection.authorized||void 0!==e.connection.encrypted,req:e};if(2==this.options.verifyClient.length){o=this;return void this.options.verifyClient(h,function(e,i,s){void 0===i&&(i=401),void 0===s&&(s=u.STATUS_CODES[i]),e?c.apply(o):a(t,i,s)})}if(!this.options.verifyClient(h))return void a(t,401,"Unauthorized")}c()}else a(t,400,"Bad Request")}function o(e){var t={},i=this.options.perMessageDeflate,s=this.options.maxPayload;if(i&&e[g.extensionName]){var r=new g(!0!==i?i:{},!0,s);r.accept(e[g.extensionName]),t[g.extensionName]=r}return t}function a(e,t,i){try{var s=["HTTP/1.1 "+t+" "+i,"Content-type: text/html"];e.write(s.concat("","").join("\r\n"))}catch(e){}finally{try{e.destroy()}catch(e){}}}/*!
 * ws: a node.js websocket client
 * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>
 * MIT Licensed
 */
var c=i(0),h=i(1),u=i(6),l=i(3),d=i(7),p=i(4),f=i(12),g=i(2),m=(i(61),i(5));c.inherits(s,h.EventEmitter),s.prototype.close=function(e){var t=null;try{for(var i=0,s=this.clients.length;i<s;++i)this.clients[i].terminate()}catch(e){t=e}this.path&&this._server._webSocketPaths&&(delete this._server._webSocketPaths[this.path],0==Object.keys(this._server._webSocketPaths).length&&delete this._server._webSocketPaths);try{void 0!==this._closeServer&&this._closeServer()}finally{this._server&&(this._server.removeListener("listening",this._onceServerListening),this._server.removeListener("error",this._onServerError),this._server.removeListener("upgrade",this._onServerUpgrade)),delete this._server}if(e)e(t);else if(t)throw t},s.prototype.handleUpgrade=function(e,t,i,s){if(this.options.path){var o=m.parse(e.url);if(o&&o.pathname!==this.options.path)return}void 0!==e.headers.upgrade&&"websocket"===e.headers.upgrade.toLowerCase()?e.headers["sec-websocket-key1"]?n.apply(this,arguments):r.apply(this,arguments):a(t,400,"Bad Request")},e.exports=s},function(e,t){e.exports=require("tls")},function(e,t){/**@license MIT-promiscuous-©Ruben Verborgh*/
!function(t,i){function s(e,t){return(typeof t)[0]==e}function r(e,o){return o=function a(c,h,u,l,d,p){if(l=a.q,c!=s)return r(function(e,t){l.push({p:this,r:e,j:t,1:c,0:h})});if(u&&s(t,u)|s(i,u))try{d=u.then}catch(e){h=0,u=e}if(s(t,d)){function f(e){return function(t){d&&(d=0,a(s,e,t))}}try{d.call(u,f(1),h=f(0))}catch(e){h(e)}}else for(o=function(i,o){return s(t,i=h?i:o)?r(function(e,t){n(this,e,t,u,i)}):e},p=0;p<l.length;)d=l[p++],s(t,c=d[h])?n(d.p,d.r,d.j,u,c):(h?d.r:d.j)(u)},o.q=[],e.call(e={then:function(e,t){return o(e,t)},catch:function(e){return o(0,e)}},function(e){o(s,1,e)},function(e){o(s,0,e)}),e}function n(e,r,n,o,a){setImmediate(function(){try{o=a(o),a=o&&s(i,o)|s(t,o)&&o.then,s(t,a)?o==e?n(TypeError()):a.call(o,r,n):r(o)}catch(e){n(e)}})}function o(e){return r(function(t){t(e)})}e.exports=r,r.resolve=o,r.reject=function(e){return r(function(t,i){i(e)})},r.all=function(e){return r(function(t,i,s,r){r=[],s=e.length||t(r),e.map(function(e,n){o(e).then(function(e){r[n]=e,--s||t(r)},i)})})}}("f","o")},function(e,t){e.exports=require("console")},function(e,t){e.exports=require("timers")}])});